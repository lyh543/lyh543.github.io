<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Django 3.1 学习笔记 | 小灰灰灰灰的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="后端,Python,Django">
    <meta name="description" content="Django 后端学习路线推荐从上往下看。  官方快速安装指南（3.1 版本），安装的教程 官方中文教程（3.1 版本），开发的教程 MDN 上的 Django 教程，和上面的教程有重叠，推荐只看会话和用户认证部分 Django REST Framework，这是一个基于 Django 的 RESTful 后端框架，为常见 RESTful 操作提供了模板，大大降低 REST API 开发量  Dj">
<meta property="og:type" content="article">
<meta property="og:title" content="Django 3.1 学习笔记">
<meta property="og:url" content="https://blog.lyh543.cn/python/django/index.html">
<meta property="og:site_name" content="小灰灰灰灰的博客">
<meta property="og:description" content="Django 后端学习路线推荐从上往下看。  官方快速安装指南（3.1 版本），安装的教程 官方中文教程（3.1 版本），开发的教程 MDN 上的 Django 教程，和上面的教程有重叠，推荐只看会话和用户认证部分 Django REST Framework，这是一个基于 Django 的 RESTful 后端框架，为常见 RESTful 操作提供了模板，大大降低 REST API 开发量  Dj">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-12-27T10:20:23.000Z">
<meta property="article:modified_time" content="2021-09-11T12:19:35.163Z">
<meta property="article:author" content="lyh543">
<meta property="article:tag" content="后端">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
    
        <link rel="alternate" type="application/atom+xml" title="小灰灰灰灰的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="mdi mdi-close icon-lg"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">lyh543</h5>
          <a href="mailto:lyh543@outlook.com" title="lyh543@outlook.com" class="mail">lyh543@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg mdi mdi-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg mdi mdi-archive"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg mdi mdi-tag-multiple"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg mdi mdi-format-list-bulleted-square"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/lyh543" target="_blank" >
                <i class="icon icon-lg mdi mdi-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg mdi mdi-menu"></i>
        </a>
        <div class="flex-col header-title ellipsis">Django 3.1 学习笔记</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg mdi mdi-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg mdi mdi-magnify"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg mdi mdi-share-variant"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Django 3.1 学习笔记</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-12-27T10:20:23.000Z" itemprop="datePublished" class="page-time">
  2020-12-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Python/">Python</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Django-后端学习路线"><span class="post-toc-text">Django 后端学习路线</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Django-官方教程-关键步骤"><span class="post-toc-text">Django 官方教程 关键步骤</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-创建项目、项目和一个视图"><span class="post-toc-text">1. 创建项目、项目和一个视图</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-数据库使用、管理员"><span class="post-toc-text">2. 数据库使用、管理员</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-配置数据库"><span class="post-toc-text">2.1 配置数据库</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-2-创建模型并迁移至数据库"><span class="post-toc-text">2.2 创建模型并迁移至数据库</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-3-数据库-API"><span class="post-toc-text">2.3 数据库 API</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-4-管理员相关"><span class="post-toc-text">2.4 管理员相关</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-视图和-urls"><span class="post-toc-text">3. 视图和 urls</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-添加更多视图，并用参数匹配-url"><span class="post-toc-text">3.1 添加更多视图，并用参数匹配 url</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-2-使用-HTML-模板"><span class="post-toc-text">3.2 使用 HTML 模板</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-抛出-404-错误码"><span class="post-toc-text">3.3 抛出 404 错误码</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-4-使用-name-替代-URL-中的硬编码、为-URL-名称添加命名空间-app-name"><span class="post-toc-text">3.4 使用 name 替代 URL 中的硬编码、为 URL 名称添加命名空间(app_name)</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-编写一个简单的表单"><span class="post-toc-text">4. 编写一个简单的表单</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-测试"><span class="post-toc-text">5. 测试</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-插入静态文件"><span class="post-toc-text">6. 插入静态文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-修改-Admin-页面"><span class="post-toc-text">7. 修改 Admin 页面</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Django-用户认证"><span class="post-toc-text">Django 用户认证</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Django-用户认证（后端篇）"><span class="post-toc-text">Django 用户认证（后端篇）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Django-用户认证（前端篇）"><span class="post-toc-text">Django 用户认证（前端篇）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用-JWT-进行身份验证"><span class="post-toc-text">使用 JWT 进行身份验证</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Django-定时任务"><span class="post-toc-text">Django 定时任务</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Django-REST-Framework"><span class="post-toc-text">Django REST Framework</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Django-项目部署-WSGI"><span class="post-toc-text">Django 项目部署 (WSGI)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gunicorn"><span class="post-toc-text">Gunicorn</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#处理静态文件"><span class="post-toc-text">处理静态文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gunicorn-日志-ip-总是显示-127-0-0-1"><span class="post-toc-text">Gunicorn 日志 ip 总是显示 127.0.0.1</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Django-项目部署-ASGI"><span class="post-toc-text">Django 项目部署 (ASGI)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#项目开源地址"><span class="post-toc-text">项目开源地址</span></a></li></ol>
        </nav>
    </aside>


<article id="post-python/django"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Django 3.1 学习笔记</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-12-27 18:20:23" datetime="2020-12-27T10:20:23.000Z"  itemprop="datePublished">2020-12-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Python/">Python</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Django-后端学习路线"><a href="#Django-后端学习路线" class="headerlink" title="Django 后端学习路线"></a>Django 后端学习路线</h2><p>推荐从上往下看。</p>
<ul>
<li><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/install/" target="_blank" rel="noopener">官方快速安装指南（3.1 版本）</a>，安装的教程</li>
<li><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial01/" target="_blank" rel="noopener">官方中文教程（3.1 版本）</a>，开发的教程</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/learn/Server-side/Django" target="_blank" rel="noopener">MDN 上的 Django 教程</a>，和上面的教程有重叠，推荐只看<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Django/Sessions" target="_blank" rel="noopener">会话</a>和<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Django/Authentication" target="_blank" rel="noopener">用户认证</a>部分</li>
<li><a href="https://q1mi.github.io/Django-REST-framework-documentation/" target="_blank" rel="noopener">Django REST Framework</a>，这是一个基于 Django 的 RESTful 后端框架，为常见 RESTful 操作提供了模板，大大降低 REST API 开发量</li>
</ul>
<h2 id="Django-官方教程-关键步骤"><a href="#Django-官方教程-关键步骤" class="headerlink" title="Django 官方教程 关键步骤"></a>Django 官方教程 关键步骤</h2><p>本小节记录了 <a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial01/" target="_blank" rel="noopener">官方中文教程（3.1 版本）</a> 中的关键步骤。</p>
<h3 id="1-创建项目、项目和一个视图"><a href="#1-创建项目、项目和一个视图" class="headerlink" title="1. 创建项目、项目和一个视图"></a>1. 创建项目、项目和一个视图</h3><ul>
<li>安装：<code>pip install Django</code></li>
<li>验证安装：<code>python -m django --version</code></li>
<li>创建并初始化项目文件夹：<code>django-admin startproject &lt;projectname&gt;</code></li>
<li>即时预览：在 <code>&lt;projectname&gt;</code> 目录下 <code>python manage.py runserver [port]</code></li>
<li>创建应用：<code>python manage.py startapp &lt;appname&gt;</code></li>
<li>编写视图：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># polls/views.py</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Hello, world. You're at the polls index."</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>在应用中添加写好的视图：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># polls/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>在站点中添加应用的视图：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysite/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include, path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'polls/'</span>, include(<span class="string">'polls.urls'</span>)),</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="2-数据库使用、管理员"><a href="#2-数据库使用、管理员" class="headerlink" title="2. 数据库使用、管理员"></a>2. 数据库使用、管理员</h3><h4 id="2-1-配置数据库"><a href="#2-1-配置数据库" class="headerlink" title="2.1 配置数据库"></a>2.1 配置数据库</h4><ul>
<li>安装 mysqlclient：<code>pip install mysqlclient</code></li>
<li>修改项目配置文件：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysite/settings.py</span></span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django_learn'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'yourpassword'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-创建模型并迁移至数据库"><a href="#2-2-创建模型并迁移至数据库" class="headerlink" title="2.2 创建模型并迁移至数据库"></a>2.2 创建模型并迁移至数据库</h4><p>一个 Django 模型对于一个 SQL 数据表。</p>
<ul>
<li>创建模型：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># polls/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.question_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question = models.ForeignKey(Question, on_delete=models.CASCADE)</span><br><span class="line">    choice_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    votes = models.IntegerField(default=<span class="number">0</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.choice_text</span><br></pre></td></tr></table></figure>

<ul>
<li>激活模型：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysite/settings.py</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'polls.apps.PollsConfig'</span> <span class="comment"># 添加这一项</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>将模型更改写入数据库：<ul>
<li>根据类的更改，生成一个 <code>迁移</code>（一个存储在 <code>&lt;app_lable&gt;/migrations</code> 下的 py 文件，存储了变化）：<code>python manage.py makemigrations [app_label]</code>（<a href="https://docs.djangoproject.com/zh-hans/3.1/ref/django-admin/#makemigrations" target="_blank" rel="noopener">文档</a>）</li>
<li>将一个 <code>迁移</code> 应用到数据库，并迁移数据：<code>python manage.py migrate [app_label] [migration_name]</code>（<a href="https://docs.djangoproject.com/zh-hans/3.1/ref/django-admin/#django-admin-migrate" target="_blank" rel="noopener">文档</a>）</li>
<li>查看一个 <code>迁移</code> 将对数据库造成的影响：<code>python manage.py sqlmigrate &lt;app_label&gt; &lt;migration_name&gt;</code>（<a href="https://docs.djangoproject.com/zh-hans/3.1/ref/django-admin/#django-admin-sqlmigrate" target="_blank" rel="noopener">文档</a>）</li>
<li>一般来说，类变更以后，需要：<code>python manage.py makemigrations &amp;&amp; python manage.py migrate</code></li>
<li>第一次部署的时候，需要 <code>python manage.py makemigrations &lt;app1&gt; &lt;app2&gt; &lt;...appn&gt; &amp;&amp; python manage.py migrate</code></li>
</ul>
</li>
</ul>
<p>对了，<code>migrations</code> 文件夹应当加入 <code>.gitignore</code>，否则不同开发者的 <code>migrations</code> 就要冲突啦。</p>
<h4 id="2-3-数据库-API"><a href="#2-3-数据库-API" class="headerlink" title="2.3 数据库 API"></a>2.3 数据库 API</h4><ul>
<li>进入 Python 命令行：<code>python manage.py shell</code></li>
<li>使用前先引入类：<code>from polls.models import Choice, Question</code></li>
</ul>
<hr>
<p>对于一个数据表：</p>
<ul>
<li>一个表的所有元素：<code>Question.objects.all()</code></li>
<li>以成员筛选记录：<code>Question.objects.filter(id=1)</code></li>
<li>以 <code>pub_date</code> 成员的 <code>year</code> 成员筛选（成员方法同理）：<code>pub_date.year</code>：<code>Question.objects.filter(pub_date__year)</code></li>
</ul>
<hr>
<p>对于一个记录：</p>
<ul>
<li>构造一个新记录：<code>q = Question(question_text=&quot;What&#39;s new?&quot;, pub_date=timezone.now())</code></li>
<li>将记录插入表：<code>q.save()</code></li>
<li>查询、修改记录的属性（同理可调用其方法）：<code>q.question_text</code></li>
<li>删除一个记录：<code>q.delete()</code></li>
</ul>
<hr>
<p>对于一个外键（<code>Choice</code> 存在外键，为 <code>Question</code>）：</p>
<ul>
<li>查询一个 Choice 对应的 Question：<code>c.qeustion</code></li>
<li>查询一个 Question 对应的 Choice：<code>q.choice_set.all()</code></li>
<li>为 Question 创建一个 Choice：<code>q.choice_set.create(choice_text=&#39;Not much&#39;, votes=0)</code></li>
</ul>
<h4 id="2-4-管理员相关"><a href="#2-4-管理员相关" class="headerlink" title="2.4 管理员相关"></a>2.4 管理员相关</h4><ul>
<li>创建管理员：<code>python manage.py createsuperuser</code></li>
<li>管理员登录界面：<code>http://127.0.0.1:8000/admin/</code></li>
<li>在管理员页面中添加 <code>Question</code> 模型：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># polls/admin.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line">admin.site.register(Question)</span><br></pre></td></tr></table></figure>

<h3 id="3-视图和-urls"><a href="#3-视图和-urls" class="headerlink" title="3. 视图和 urls"></a>3. 视图和 urls</h3><h4 id="3-1-添加更多视图，并用参数匹配-url"><a href="#3-1-添加更多视图，并用参数匹配-url" class="headerlink" title="3.1 添加更多视图，并用参数匹配 url"></a>3.1 添加更多视图，并用参数匹配 url</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /polls/views.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id: int)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"You're looking at question %s."</span> % question_id)</span><br><span class="line">    <span class="comment"># 这里可以做更多的事情，比如调用其他 Python 包</span></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /polls/url.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">        path(<span class="string">'&lt;int:question_id&gt;/'</span>, views.detail, name=<span class="string">'detail'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>访问 <code>/polls/34</code> 会返回 <code>You&#39;re looking at question 34.</code></p>
<h4 id="3-2-使用-HTML-模板"><a href="#3-2-使用-HTML-模板" class="headerlink" title="3.2 使用 HTML 模板"></a>3.2 使用 HTML 模板</h4><p>编写一个 HTML 模板：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- /polls/templates/polls/index.html --&gt;</span></span><br><span class="line">&#123;% if latest_question_list %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% for question in latest_question_list %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/polls/&#123;&#123; question.id &#125;&#125;/"</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>No polls are available.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>再在视图中：加载模板、用数据渲染、然后转为 HTTP Response，三步使用 <code>django.shortcuts.render()</code> 完成</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    context = &#123;<span class="string">'latest_question_list'</span>: latest_question_list&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/index.html'</span>, context)</span><br></pre></td></tr></table></figure>

<h4 id="3-3-抛出-404-错误码"><a href="#3-3-抛出-404-错误码" class="headerlink" title="3.3 抛出 404 错误码"></a>3.3 抛出 404 错误码</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> Http404</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        question = Question.objects.get(pk=question_id)</span><br><span class="line">    <span class="keyword">except</span> Question.DoesNotExist:</span><br><span class="line">        <span class="keyword">raise</span> Http404(<span class="string">"Question does not exist"</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br></pre></td></tr></table></figure>

<p>也可以使用 <code>django.shortcuts.get_object_or_404</code>。该函数在 <code>object</code> 不存在会 <code>raise Http404()</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> get_object_or_404, render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br></pre></td></tr></table></figure>

<p>也有 <code>get_list_or_404()</code> 函数，工作原理和 <code>get_object_or_404()</code> 一样，除了 <code>get()</code> 函数被换成了 <code>filter()</code> 函数。如果列表为空的话会抛出 <code>Http404</code> 异常。</p>
<h4 id="3-4-使用-name-替代-URL-中的硬编码、为-URL-名称添加命名空间-app-name"><a href="#3-4-使用-name-替代-URL-中的硬编码、为-URL-名称添加命名空间-app-name" class="headerlink" title="3.4 使用 name 替代 URL 中的硬编码、为 URL 名称添加命名空间(app_name)"></a>3.4 使用 name 替代 URL 中的硬编码、为 URL 名称添加命名空间(app_name)</h4><p><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial03/#removing-hardcoded-urls-in-templates" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial03/#removing-hardcoded-urls-in-templates</a></p>
<p><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial03/#namespacing-url-names" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial03/#namespacing-url-names</a></p>
<h3 id="4-编写一个简单的表单"><a href="#4-编写一个简单的表单" class="headerlink" title="4. 编写一个简单的表单"></a>4. 编写一个简单的表单</h3><p>因为我想用 Django 做纯 REST 后端，所以这部分略。</p>
<p><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial04/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial04/</a></p>
<h3 id="5-测试"><a href="#5-测试" class="headerlink" title="5. 测试"></a>5. 测试</h3><p><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial05/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial05/</a></p>
<p>关于测试还是值得单独拿一个章节出来的：<a href="/back-end/django-test/">测试</a></p>
<h3 id="6-插入静态文件"><a href="#6-插入静态文件" class="headerlink" title="6. 插入静态文件"></a>6. 插入静态文件</h3><p><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial06/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial06/</a></p>
<h3 id="7-修改-Admin-页面"><a href="#7-修改-Admin-页面" class="headerlink" title="7. 修改 Admin 页面"></a>7. 修改 Admin 页面</h3><p><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial07/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial07/</a></p>
<p>如果想要修改某元素对应外键的信息（而不是修改其外键），可以参考 <a href="https://docs.djangoproject.com/en/3.1/ref/contrib/admin/#django.contrib.admin.StackedInline" target="_blank" rel="noopener"><code>django.contrib.admin.StackedInline</code></a></p>
<p>如果想要汉化 Admin 页面，可以参考：<a href="https://blog.csdn.net/aaazz47/article/details/78666099" target="_blank" rel="noopener">https://blog.csdn.net/aaazz47/article/details/78666099</a></p>
<h2 id="Django-用户认证"><a href="#Django-用户认证" class="headerlink" title="Django 用户认证"></a>Django 用户认证</h2><h3 id="Django-用户认证（后端篇）"><a href="#Django-用户认证（后端篇）" class="headerlink" title="Django 用户认证（后端篇）"></a>Django 用户认证（后端篇）</h3><blockquote>
<p>MDN 教程：<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Django/Authentication" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Django/Authentication</a><br>文档：<a href="https://docs.djangoproject.com/zh-hans/3.1/topics/auth/default/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.1/topics/auth/default/</a></p>
</blockquote>
<ul>
<li>创建用户：<code>user = User.objects.create_user(&#39;john&#39;, &#39;lennon@thebeatles.com&#39;, &#39;johnpassword&#39;)</code></li>
<li>创建超级用户：在命令行中 <code>python manage.py createsuperuser</code></li>
<li>登录：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate, login</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    username = request.POST[<span class="string">'username'</span>]</span><br><span class="line">    password = request.POST[<span class="string">'password'</span>]</span><br><span class="line">    user = authenticate(request, username=username, password=password)</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        login(request, user)</span><br><span class="line">        <span class="comment"># Redirect to a success page.</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># Return an 'invalid login' error message.</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<ul>
<li>判断用户身份：可以通过 <code>request.user.is_authenticated==False</code> 表示为匿名者；否则 <code>request.user</code> 会被设置为 <code>User</code> 实例。</li>
<li>更改密码：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line">u = User.objects.get(username=<span class="string">'john'</span>)</span><br><span class="line">u.set_password(<span class="string">'new password'</span>)</span><br><span class="line">u.save()</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://docs.djangoproject.com/zh-hans/3.1/topics/auth/default/#the-login-required-decorator" target="_blank" rel="noopener"><code>login_required</code></a> 装饰器：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br></pre></td></tr></table></figure>

<ul>
<li>登出：<code>django.contrib.auth.logout(request)</code></li>
</ul>
<h3 id="Django-用户认证（前端篇）"><a href="#Django-用户认证（前端篇）" class="headerlink" title="Django 用户认证（前端篇）"></a>Django 用户认证（前端篇）</h3><p>Django 的用户认证是用 Session 实现的，和其他的 Session 应该是类似的。但对于零基础前后端开发的我，不清楚这之中究竟发生了什么。于是我简单测试了一下。</p>
<p>在登录成功后，应答的 headers 中就会出现 <code>Set-Cookies</code> 字段：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ http POST http:<span class="comment">//127.0.0.1:8000/api/accounts/login/ &lt;&lt;&lt; '&#123;"username":"lyh543@outlook.com", "password":"xxxxxxxx"&#125;'</span></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Allow: OPTIONS, POST</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: <span class="number">493</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Tue, <span class="number">09</span> Feb <span class="number">2021</span> <span class="number">05</span>:<span class="number">34</span>:<span class="number">41</span> GMT</span><br><span class="line">Referrer-Policy: same-origin</span><br><span class="line">Server: WSGIServer/<span class="number">0.2</span> CPython/<span class="number">3.9</span><span class="number">.1</span></span><br><span class="line">Set-Cookie: csrftoken=sJQyvoxpJ7nIwFpbgXSKKiBIoo7GxogKKTmsFwJshfyFMBIEyPlhQrvl8OK6FlQR; expires=Tue, <span class="number">08</span> Feb <span class="number">2022</span> <span class="number">05</span>:<span class="number">34</span>:<span class="number">40</span> GMT; Max-Age=<span class="number">31449600</span>; Path=/; SameSite=Lax</span><br><span class="line">Set-Cookie: sessionid=kmst16goqdwof54ycuynbz7wzk1scboc; expires=Tue, <span class="number">23</span> Feb <span class="number">2021</span> <span class="number">05</span>:<span class="number">34</span>:<span class="number">40</span> GMT; HttpOnly; Max-Age=<span class="number">1209600</span>; Path=/; SameSite=Lax</span><br><span class="line">Vary: Accept, Cookie, Origin</span><br><span class="line">X-Content-Type-Options: nosniff</span><br><span class="line">X-Frame-Options: DENY</span><br></pre></td></tr></table></figure>

<p>前一个 <code>csrftoken</code> 是防止跨站请求的，如果项目是前后端分离的话，就需要进行配置（关于 CSRF，可以看 <a href="../handle-cors-and-csrf">和 CSRF 与 CORS 斗智斗勇</a>）；<br>后一个 <code>sessionid</code> 就是登录成功后的 <code>sessionid</code> 了。如果我们在下次请求中的 headers 中加入了这个 <code>sessionid</code>，服务器就能识别到我们。对于 Django 来说，就是 <code>request.user</code> 为登录的这个用户。</p>
<p>对于浏览器、<code>requests.sessions.Session</code> 等，会自动设置 Cookie。下面是利用 <code>requests.sessions.Session</code> 完成登录、查询管理员字段的过程：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: s = requests.Session()</span><br><span class="line"></span><br><span class="line">In [<span class="number">20</span>]: r1 = s.post(<span class="string">"http://localhost:8000/api/accounts/login/"</span>, data=&#123;<span class="string">"username"</span>:<span class="string">"lyh543@outlook.com"</span>, <span class="string">"password"</span>:<span class="string">"xxxxxxxx"</span>&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">21</span>]: r1</span><br><span class="line">Out[<span class="number">21</span>]: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: dict(s.cookies)</span><br><span class="line">Out[<span class="number">22</span>]:</span><br><span class="line">&#123;<span class="string">'csrftoken'</span>: <span class="string">'s1aepuw0A08k9PsFtTWn6CbCkLU24MU6tTuk3DieW4uj1b6PAXwSjrfHqfCvufz3'</span>,</span><br><span class="line"> <span class="string">'sessionid'</span>: <span class="string">'f9ofrqwar9rs0phbg4p89647pwryowrs'</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: r1.request.headers</span><br><span class="line">Out[<span class="number">23</span>]: &#123;<span class="string">'User-Agent'</span>: <span class="string">'python-requests/2.18.4'</span>, <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>, <span class="string">'Accept'</span>: <span class="string">'*/*'</span>, <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>, <span class="string">'Content-Length'</span>: <span class="string">'47'</span>, <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: r1.headers</span><br><span class="line">Out[<span class="number">25</span>]: &#123;<span class="string">'Date'</span>: <span class="string">'Tue, 09 Feb 2021 03:48:32 GMT'</span>, <span class="string">'Server'</span>: <span class="string">'WSGIServer/0.2 CPython/3.9.1'</span>, <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>, <span class="string">'Vary'</span>: <span class="string">'Accept, Cookie, Origin'</span>, <span class="string">'Allow'</span>: <span class="string">'OPTIONS, POST'</span>, <span class="string">'X-Frame-Options'</span>: <span class="string">'DENY'</span>, <span class="string">'Content-Length'</span>: <span class="string">'493'</span>, <span class="string">'X-Content-Type-Options'</span>: <span class="string">'nosniff'</span>, <span class="string">'Referrer-Policy'</span>: <span class="string">'same-origin'</span>, <span class="string">'Set-Cookie'</span>: <span class="string">'csrftoken=s1aepuw0A08k9PsFtTWn6CbCkLU24MU6tTuk3DieW4uj1b6PAXwSjrfHqfCvufz3; expires=Tue, 08 Feb 2022 03:48:32 GMT; Max-Age=31449600; Path=/; SameSite=Lax, sessionid=f9ofrqwar9rs0phbg4p89647pwryowrs; expires=Tue, 23 Feb 2021 03:48:32 GMT; HttpOnly; Max-Age=1209600; Path=/; SameSite=Lax'</span>, <span class="string">'Connection'</span>: <span class="string">'close'</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: r1 = s.get(<span class="string">"http://localhost:8000/api/activities/1/admin/"</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">27</span>]: r1</span><br><span class="line">Out[<span class="number">27</span>]: &lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>而对于非登录操作、或登录失败，应答中的字段就不会有 <code>Set-Cookies</code> 字段，<code>requests.sessions.Session</code> 也不会设置 <code>Cookies</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: s = requests.Session()</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: r1 = s.get(<span class="string">"http://localhost:8000/api/activities/1/admin/"</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: r1</span><br><span class="line">Out[<span class="number">8</span>]: &lt;Response [<span class="number">403</span>]&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: s.cookies</span><br><span class="line">Out[<span class="number">9</span>]: &lt;RequestsCookieJar[]&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: list(s.cookies)</span><br><span class="line">Out[<span class="number">10</span>]: []</span><br></pre></td></tr></table></figure>

<p>Django Session 的过期时间也是可以通过修改 <a href="https://docs.djangoproject.com/zh-hans/3.1/ref/settings/#session-cookie-age" target="_blank" rel="noopener"><code>SESSION_COOKIE_AGE</code></a> 来修改的。</p>
<h3 id="使用-JWT-进行身份验证"><a href="#使用-JWT-进行身份验证" class="headerlink" title="使用 JWT 进行身份验证"></a>使用 JWT 进行身份验证</h3><p>Django 自带的 Session 对于很多项目已经够用了。如果想要更高级一点的安全验证，如 Json Web Token，可以尝试 <a href="https://django-rest-framework-simplejwt.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">Simple JWT</a> 配合 Django REST Framework 食用。文档给的示例代码很详细，有需要也可以仿照源码编写自己的 API。</p>
<h2 id="Django-定时任务"><a href="#Django-定时任务" class="headerlink" title="Django 定时任务"></a>Django 定时任务</h2><p>可参考 <a href="https://pypi.org/project/django-crontab/" target="_blank" rel="noopener">Django-crontab</a>。</p>
<h2 id="Django-REST-Framework"><a href="#Django-REST-Framework" class="headerlink" title="Django REST Framework"></a>Django REST Framework</h2><p>这部分就<a href="../django-rest-framework-study-notes">另开一篇博文</a>来写了。</p>
<h2 id="Django-项目部署-WSGI"><a href="#Django-项目部署-WSGI" class="headerlink" title="Django 项目部署 (WSGI)"></a>Django 项目部署 (WSGI)</h2><p>Django 部署可以采用 WSGI，也可以使用 ASGI。WSGI 是为同步 Web Server 编写的，而 ASGI 是为异步 Web Server 编写的。虽然可以混用，但是同步函数和异步函数可以混用，但是会有约 1ms 的用于线程切换的性能损失。</p>
<p>。如果你主要使用的是异步函数，你可以快进到下一章，进行 ASGI 的部署。看完以后，再回来看看如何 <a href="#%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6">处理静态文件</a>。</p>
<h3 id="Gunicorn"><a href="#Gunicorn" class="headerlink" title="Gunicorn"></a>Gunicorn</h3><p>诚然，<code>python manage.py runserver 8000</code> 然后将 8000 端口交给 Nginx / Apache / Caddy 反向代理到 80(http) / 443(https)，是最简单且最直接的方法。但是，其替代方案有多线程、占用内存小等优势。</p>
<blockquote>
<p>Django 的管理命令 <code>startproject</code> 生成了一个最小化的默认 WSGI 配置，你可以按照自己项目的需要去调整这个配置，任何兼容 WSGI 的应用程序服务器都可以直接使用。</p>
</blockquote>
<p>而其中一个 WSGI 应用程序服务器的方案，就是使用 Gunicorn。由于细节比较多，各位先不要急着实践，建议先通读这部分，再决定是否采用这种方式还是直接 <code>startproject</code>。</p>
<p>安装 Gunicorn：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install gunicorn</span><br></pre></td></tr></table></figure>

<p>在项目文件夹下运行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunicorn -b <span class="string">"127.0.0.1:8000"</span> &lt;projectname&gt;.wsgi</span><br></pre></td></tr></table></figure>

<p>其中 <code>&lt;projectname&gt;.wsgi</code> 也是 Python 的模块的表示方法，其表示 <code>./&lt;projectname&gt;/wsgi.py</code> 这个模块。</p>
<p>可以将执行这条命令的过程写为 Systemd 服务，并实现 2 进程、每进程 3 线程，以及自动重启等：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># djangoproject.service</span></span><br><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Django Project</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"><span class="attr">StartLimitIntervalSec</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">WorkingDirectory</span>=/path/to/&lt;projectname&gt;/</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/gunicorn -b <span class="string">"127.0.0.1:8000"</span> \</span><br><span class="line">    --workers=2 \</span><br><span class="line">    --threads=3 \</span><br><span class="line">    --access-logfile - \</span><br><span class="line">    &lt;projectname&gt;.wsgi</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<p>命令的 <code>--access-logfile -</code> 表示将 log 输出在控制台，在 Systemd 中即表示可以通过 <code>systemctl status djangoproject</code> 查询日志。</p>
<p>然后就是将这项服务复制到 <code>/etc/systemd/system/</code>，然后 enable 和 start 了：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo cp ./djangoproject.service /etc/systemd/system/</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> djangoproject <span class="comment"># 激活</span></span><br><span class="line">sudo systemctl start djangoproject  <span class="comment"># 启动</span></span><br><span class="line">sudo systemctl status djangoproject <span class="comment"># 查询状态</span></span><br></pre></td></tr></table></figure>

<h3 id="处理静态文件"><a href="#处理静态文件" class="headerlink" title="处理静态文件"></a>处理静态文件</h3><p>但是！这并没有完成部署。访问 <code>localhost:8000</code> 时，可以看到 Django 有正常响应，但是所有静态文件全部失效，Swagger 文档生成也失效了。</p>
<p>为了解决这个问题，需要配置静态文件。</p>
<p>在 <code>&lt;projectname&gt;/settings.py</code> 中配置以下几个参数</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">'.static'</span>)</span><br><span class="line">STATIC_URL = <span class="string">'/api/static/'</span></span><br><span class="line"></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">'static'</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>三个参数的意义如下：</p>
<ul>
<li><code>BASE_DIR/static</code> 是开发中静态文件所在文件夹</li>
<li><code>BASE_DIR/.static</code> 是项目生成后静态文件所在文件夹，应当加入 <code>.gitignore</code></li>
<li><code>/api/static/</code> 是在网页中访问静态文件的路径</li>
</ul>
<p>整个过程是这样的：</p>
<ol>
<li>开发者将所需的静态文件放入 <code>BASE_DIR/static</code></li>
<li>开发者运行 <code>python3 manage.py collectstatic</code>，Django 将开发者提供的 <code>BASE_DIR/static</code> 文件，和 Swagger 等 APP 提供的静态文件，一并复制进 <code>BASE_DIR/.static</code></li>
<li>用户在浏览器中访问 <code>/api/static/</code> 路径，表示用户想访问的文件夹是 <code>BASE_DIR/.static</code></li>
</ol>
<p>所以还需要进行以下两步：</p>
<ol>
<li>运行 <code>python3 manage.py collectstatic</code></li>
<li>通过 Nginx / Apache / Caddy 等将静态文件提供给用户</li>
</ol>
<p>Gunicorn 提供了一个 <a href="https://docs.gunicorn.org/en/latest/deploy.html#id5" target="_blank" rel="noopener">Nginx.conf 配置模板</a>，我也提供一份 Caddy 的配置模板：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">example.com</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">handle</span> <span class="string">/api/static/* &#123;</span></span><br><span class="line">        <span class="attr">uri</span> <span class="string">strip_prefix /api/static</span></span><br><span class="line">        <span class="attr">root</span> <span class="string">* /etc/uestcmsc_webapp/backend/.static</span></span><br><span class="line">        <span class="attr">file_server</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">handle</span> <span class="string">/api/* &#123;</span></span><br><span class="line">        <span class="attr">reverse_proxy</span> <span class="string">localhost:8000</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">handle</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="attr">root</span> <span class="string">* /etc/uestcmsc_webapp/frontend</span></span><br><span class="line">        <span class="attr">try_files</span> <span class="string">&#123;path&#125; /index.html</span></span><br><span class="line">        <span class="attr">file_server</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，这种配置的前提是所有 REST API 放在了 <code>/api/</code> 下，这种方法使用的 <code>&lt;projectname&gt;/urls.py</code> 如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">api_urlpatterns = [</span><br><span class="line">    url(<span class="string">r'^docs(?P&lt;format&gt;\.json|\.yaml)$'</span>, schema_view.without_ui(cache_timeout=<span class="number">0</span>), name=<span class="string">'schema-json'</span>),</span><br><span class="line">    url(<span class="string">r'^docs/$'</span>, schema_view.with_ui(<span class="string">'swagger'</span>, cache_timeout=<span class="number">0</span>), name=<span class="string">'schema-swagger-ui'</span>),</span><br><span class="line">    url(<span class="string">r'^redoc/$'</span>, schema_view.with_ui(<span class="string">'redoc'</span>, cache_timeout=<span class="number">0</span>), name=<span class="string">'schema-redoc'</span>),</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">'api/'</span>, include(api_urlpatterns))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="Gunicorn-日志-ip-总是显示-127-0-0-1"><a href="#Gunicorn-日志-ip-总是显示-127-0-0-1" class="headerlink" title="Gunicorn 日志 ip 总是显示 127.0.0.1"></a>Gunicorn 日志 ip 总是显示 127.0.0.1</h3><p>出现这个问题，我第一反应是 Caddy 反代的锅，第二反应是 Django 的锅，最后查了一下才发现是 Gunicorn 的锅。</p>
<p><a href="https://stackoverflow.com/questions/25737589/gunicorn-doesnt-log-real-ip-from-nginx" target="_blank" rel="noopener">Gunicorn doesn’t log real ip from nginx - Stack Overflow</a></p>
<p>回答也说的很清楚，只需要按照格式修改好后追加到 <code>--access-logformat</code> 参数即可。</p>
<p>我把时间、两个 <code>-</code>和 127.0.0.1 去掉以后的配置如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/gunicorn -b <span class="string">"127.0.0.1:8000"</span> \</span><br><span class="line">    --workers=2 \</span><br><span class="line">    --threads=3 \</span><br><span class="line">    --access-logfile - \</span><br><span class="line">    --access-logformat "%(&#123;X-Real-IP&#125;i)s \"%(r)s\" %(s)s %(b)s \"%(f)s\" \"%(a)s\"" \</span><br><span class="line">    &lt;projectname&gt;.wsgi</span><br></pre></td></tr></table></figure>

<h2 id="Django-项目部署-ASGI"><a href="#Django-项目部署-ASGI" class="headerlink" title="Django 项目部署 (ASGI)"></a>Django 项目部署 (ASGI)</h2><p>Django 主推的 ASGI 部署方式，应该是它自己维护的 <a href="https://github.com/django/daphne" target="_blank" rel="noopener">Daphne</a>。</p>
<p>安装 Daphne</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install daphne</span><br></pre></td></tr></table></figure>

<p>在项目文件夹下运行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daphne &lt;projectname&gt;.asgi:application</span><br></pre></td></tr></table></figure>


<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/daphne -p <span class="number">8000</span> &lt;projectname&gt;.asgi:application</span><br></pre></td></tr></table></figure>

<p>目前 Daphne 还不支持多进程，如需多进程，请使用 <code>uvicorn</code>。</p>
<h2 id="项目开源地址"><a href="#项目开源地址" class="headerlink" title="项目开源地址"></a>项目开源地址</h2><p>上面提到的项目开源在 <a href="https://github.com/uestc-msc/uestcmsc_webapp_backend/tree/e1f3208664770ccf0b50522a2620d3ccf766024b" target="_blank" rel="noopener">GitHub</a>。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2021-09-11T12:19:35.163Z" itemprop="dateUpdated">2021-09-11 20:19:35</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://blog.lyh543.cn">
            <img src="/img/avatar.png" alt="lyh543">
            lyh543
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag">后端</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.lyh543.cn/python/django/&title=《Django 3.1 学习笔记》 — 小灰灰灰灰的博客&pic=https://blog.lyh543.cn/img/avatar.png" data-title="微博">
          <i class="icon mdi mdi-sina-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.lyh543.cn/python/django/&title=《Django 3.1 学习笔记》 — 小灰灰灰灰的博客&source=" data-title=" QQ">
          <i class="icon mdi mdi-qqchat"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.lyh543.cn/python/django/" data-title=" Facebook">
          <i class="icon mdi mdi-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Django 3.1 学习笔记》 — 小灰灰灰灰的博客&url=https://blog.lyh543.cn/python/django/&via=https://blog.lyh543.cn" data-title=" Twitter">
          <i class="icon mdi mdi-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.lyh543.cn/python/django/" data-title=" Google+">
          <i class="icon mdi mdi-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-lg mdi mdi-share-variant"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/sql/error-cant-connect-to-local-mysql-server-through-socket/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon mdi mdi-chevron-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Linux 连接 Docker MySQL 报错：error:&#34;Can&#39;t connect to local MySQL server through socket &#39;/var/run/mysqld/mysqld.sock&#39; (2)&#34;</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/go/go-tips/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-lg icon-pl mdi mdi-chevron-right"></i></div>
        <h4 class="title">Go 开发的 tips</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'ec7daa4e047c3c30570d',
          clientSecret: '025a9e40a1d101f28fd1a945d286a819e9fa1c3d',
          repo: 'lyh543.github.io',
          owner: 'lyh543',
          admin: ['lyh543'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg mdi mdi-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>lyh543 &copy; 2019 - 2021</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">蜀ICP备19034464号</a><br>
                
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg mdi mdi-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.lyh543.cn/python/django/&title=《Django 3.1 学习笔记》 — 小灰灰灰灰的博客&pic=https://blog.lyh543.cn/img/avatar.png" data-title="微博">
          <i class="icon mdi mdi-sina-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.lyh543.cn/python/django/&title=《Django 3.1 学习笔记》 — 小灰灰灰灰的博客&source=" data-title=" QQ">
          <i class="icon mdi mdi-qqchat"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.lyh543.cn/python/django/" data-title=" Facebook">
          <i class="icon mdi mdi-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Django 3.1 学习笔记》 — 小灰灰灰灰的博客&url=https://blog.lyh543.cn/python/django/&via=https://blog.lyh543.cn" data-title=" Twitter">
          <i class="icon mdi mdi-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.lyh543.cn/python/django/" data-title=" Google+">
          <i class="icon mdi mdi-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABy0lEQVR42u3aQW6EMAwF0Ln/padSV5VmgO8YDKpeVghQ8mBhxXZer3i8f8fW9dadv/c/Z9t6esLAxcVtc9+7Y5+bUPLrfQMuLu48Nwlen29eQT+YHxcX92Hc/JMSKC4u7v/grm16qgEOFxf3OdwkDCUbmiSoDeVquLi4DW6/YNq/Hq3v4uLiNroS/eLp/malvDouLu4Id3+iJJJUZ0haswcz4OLiDnJzYh6Sqh8QHeDAxcUd4fYbonlgWmvbRP8YFxf3VG5y7DJPh6q/oFpmxcXFneRWtzvVzdBa4+SgLIKLi3sBN0k5qmXTtRJqIeHBxcW9mLsWpJIUJV++WkDBxcWd5FZbodXwlB/mOKELhIuL2+DmG5pk+byAkpdUcHFx7+LmwWUtpVlLor7MiYuLO8KtNkSrRc/OzAf1XVxc3Mu4+WLVN9cKsri4uM/h7qcxaw3U10kDFxf3Lm4+8nQoQbcaq7i4uJdxqwElCVt566XassXFxZ3k5sGrExCrgeygD4yLizvCrR6kSBZYa8lE9V1cXNzHcE8obRTj0penuLi4j+TmIayaGkVbK1xc3EFup43ab64UZsDFxR3hVguma0crqse2cHFxb+L+AFFLlYx/jPWnAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>










</body>
</html>
