<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Go 学习笔记 | 小灰灰灰灰的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/theme/favicon.png">
    <link rel="alternate" type="application/rss+xml" href="https://blog.lyh543.cn/rss.xml" title="小灰灰灰灰的博客 RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://blog.lyh543.cn/feed.atom" title="小灰灰灰灰的博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://blog.lyh543.cn/feed.json" title="小灰灰灰灰的博客 JSON Feed">
    <meta name="description" content="函数和方法：
  定义函数：func split(sum int) (x, y int) {
  定义结构体的方法：func (v Vertex) Abs() float64 {

教程

A Tour of Go

变量声明

var x int       // x is int
var p *i ...">
    
    <link rel="preload" href="/assets/css/0.styles.0eda1ac1.css" as="style"><link rel="preload" href="/assets/js/app.bb8cc200.js" as="script"><link rel="preload" href="/assets/js/83.e40db432.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.0eda1ac1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-app="true" id="app" class="v-application v-application--is-ltr theme--light"><div class="v-application--wrap"><!----> <main id="main-content" class="v-main" style="padding-top:0px;padding-right:0px;padding-bottom:0px;padding-left:0px;"><div class="v-main__wrap"><div><div class="container"><div class="row justify-center"><div class="col-sm-9 col-12"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><div class="v-card v-sheet theme--light"><div class="container"><div itemprop="articleBody" class="markdown-body content__default"><ul><li>函数和方法：
<ul><li>定义函数：<code>func split(sum int) (x, y int) {</code></li> <li>定义结构体的方法：<code>func (v Vertex) Abs() float64 {</code></li></ul></li></ul> <h2 id="教程"><a href="#教程" class="header-anchor">#</a> 教程</h2> <p><a href="https://tour.go-zh.org/" target="_blank" rel="noopener noreferrer">A Tour of Go<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="变量声明"><a href="#变量声明" class="header-anchor">#</a> 变量声明</h2> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> x <span class="token builtin">int</span>       <span class="token comment">// x is int</span>
<span class="token keyword">var</span> p <span class="token operator">*</span><span class="token builtin">int</span>      <span class="token comment">// p is pointer of int</span>
<span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span>    <span class="token comment">// a is array[3] of int</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
    x <span class="token builtin">int</span>       <span class="token comment">// x is int</span>
    p <span class="token operator">*</span><span class="token builtin">int</span>      <span class="token comment">// p is pointer of int</span>
    a <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span>    <span class="token comment">// a is array[3] of int</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> x <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">var</span> p <span class="token operator">*</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>x

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>x

x <span class="token operator">:=</span> <span class="token number">1</span>
p <span class="token operator">:=</span> <span class="token operator">&amp;</span>x

<span class="token keyword">const</span> Pi <span class="token operator">=</span> <span class="token number">3.14</span>
</code></pre></div><h3 id="go-奇异的变量声明方式"><a href="#go-奇异的变量声明方式" class="header-anchor">#</a> Go 奇异的变量声明方式</h3> <p>第一眼看到，觉得很怪异。不过看了这篇 <a href="https://blog.go-zh.org/gos-declaration-syntax" target="_blank" rel="noopener noreferrer">关于 Go 语法声明的文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，觉得挺有意思。</p> <p>Go 的声明语句是为了和自然语言（英语）保持一致：</p> <div class="language-go extra-class"><pre class="language-go"><code>x <span class="token builtin">int</span>       <span class="token comment">// x is int</span>
p <span class="token operator">*</span><span class="token builtin">int</span>      <span class="token comment">// p is pointer of int</span>
a <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span>    <span class="token comment">// a is array[3] of int</span>
</code></pre></div><p>这主要针对的是 C 的指针，特别是加入了函数指针，一切都复杂起来：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>fp<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span>
</code></pre></div><p>这段代码定义了一个函数指针 <code>fp</code>，其接收两个参数，第一个是一个函数指针（类型是 <code>int (*)(int, int)</code>，接收两个 int 并返回 int），第二个参数是 <code>int</code>。<code>fp</code> 返回一个函数指针，类型是最外层的 <code>int (*(...))(int, int)</code>，表示接收两个 int 并返回 int）。</p> <p>如果用 Go 改写，将会变成：</p> <div class="language-go extra-class"><pre class="language-go"><code>f <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span>
</code></pre></div><p>按照从左往右以 <code>函数接收 xx 参数，返回 xx</code> 的形式解读，可以知道：<code>f</code> 是一个函数，其接收两个参数，第一个参数是一个函数（<code>func (int, int) int</code>，接收。两个 int 并返回 int），第二个参数是一个 int。返回类型是一个函数 <code>func(int, int) int</code>，表示接收两个 int 并返回一个 int。</p> <p>这里仅对文章核心作出解释，英文原文有更循序渐进的解释。</p> <h2 id="流程控制"><a href="#流程控制" class="header-anchor">#</a> 流程控制</h2> <h3 id="for"><a href="#for" class="header-anchor">#</a> for</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">for</span> i<span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> i
<span class="token punctuation">}</span>

nums <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span>
sum <span class="token operator">:=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> num <span class="token operator">:=</span> <span class="token keyword">range</span> nums <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
    sum <span class="token operator">+=</span> num
<span class="token punctuation">}</span>

<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> nums <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> num <span class="token operator">:=</span> <span class="token keyword">range</span> nums <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="while"><a href="#while" class="header-anchor">#</a> while</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// while</span>
<span class="token keyword">for</span> i <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">{</span>
    sim <span class="token operator">+=</span> i
    i<span class="token operator">++</span>
<span class="token punctuation">}</span>

<span class="token comment">// while true</span>
<span class="token keyword">for</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="if"><a href="#if" class="header-anchor">#</a> if</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">if</span> v <span class="token operator">&lt;</span> lim <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">if</span> v <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> v <span class="token operator">&lt;</span> lim <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="defer"><a href="#defer" class="header-anchor">#</a> defer</h2> <p>defer 语句会将函数推迟到外层函数返回之后执行。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;world!&quot;</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// hello, world!</span>
</code></pre></div><p>也可以写一个匿名函数然后调用它：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;world!&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello, &quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="更多类型-指针、结构体、切片和映射"><a href="#更多类型-指针、结构体、切片和映射" class="header-anchor">#</a> 更多类型：指针、结构体、切片和映射</h2> <h3 id="指针-pointer"><a href="#指针-pointer" class="header-anchor">#</a> 指针 pointer</h3> <div class="language-go extra-class"><pre class="language-go"><code>i <span class="token operator">:=</span> <span class="token number">42</span>
p <span class="token operator">=</span> <span class="token operator">&amp;</span>i

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span> <span class="token comment">// 通过指针 p 读取 i</span>
<span class="token operator">*</span>p <span class="token operator">=</span> <span class="token number">21</span> <span class="token comment">// 通过指针 p 设置 i</span>
</code></pre></div><h3 id="结构体-struct"><a href="#结构体-struct" class="header-anchor">#</a> 结构体 struct</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 结构体</span>
<span class="token keyword">type</span> Vertex <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    X<span class="token punctuation">,</span> Y <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
    v1 <span class="token operator">=</span> Vertex<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>  <span class="token comment">// 创建一个 Vertex 类型的结构体</span>
    v2 <span class="token operator">=</span> Vertex<span class="token punctuation">{</span>X<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>  <span class="token comment">// Y:0 被隐式地赋予</span>
    p <span class="token operator">=</span> <span class="token operator">&amp;</span>v1
<span class="token punctuation">)</span>

v1<span class="token punctuation">.</span>X
<span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span>X
p<span class="token punctuation">.</span>X        <span class="token comment">// 等价于 (*p).X</span>
<span class="token comment">// 硬是把指针玩成了引用</span>
</code></pre></div><h3 id="数组-array-和切片-slice"><a href="#数组-array-和切片-slice" class="header-anchor">#</a> 数组 array 和切片 slice</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 数组</span>
<span class="token comment">// 数组的长度是其类型的一部分，因此数组不能改变大小</span>
<span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span>
<span class="token comment">// 切片</span>
<span class="token keyword">var</span> s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>


<span class="token comment">// [low: high], 左闭右开</span>
primes <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> primes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>    <span class="token comment">// [3 5 7]</span>
<span class="token comment">// 默认 low = 0, high = length</span>
<span class="token keyword">var</span> s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> primes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token comment">// [2 3 5 7 11 13]</span>


<span class="token comment">// 数组</span>
<span class="token comment">// `类型{}` 可以理解成 Go 的构造函数，后面是构造函数的参数。被称为复合字面量 (Composite literals) </span>
a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">bool</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">bool</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
<span class="token comment">// 创建一个和上面相同的数组，然后构建一个引用了它的切片</span>
s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">bool</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span>


<span class="token comment">// 切片的长度是 ... 就是它的长度</span>
<span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token comment">// 切片的容量是从它的第一个元素开始数，到其底层数组元素末尾的个数</span>
<span class="token comment">// 可能是为了方便的检查 append 操作是否越界</span>
<span class="token function">cap</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
</code></pre></div><p><code>make</code> 用于创建切片/动态数组：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">// cap(s) = len(s) = 3</span>
</code></pre></div><p><code>append</code> 用于在切片后增加元素。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">append</span><span class="token punctuation">(</span>s <span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">,</span> vs <span class="token operator">...</span>T<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>T
</code></pre></div><ol><li><code>append</code> 不会改变原来的切片，所以需要再赋值给 <code>s</code>：<code>s = append(s, 1)</code></li> <li>如果 <code>s</code> 的底层数组大小足够，<code>append</code> 会直接修改底层数组；否则，会重新分配一个更大的数组，返回的切片会指向这个新数组，原数组不变</li></ol> <p><a href="https://blog.go-zh.org/go-slices-usage-and-internals" target="_blank" rel="noopener noreferrer">Go 切片：用法和本质 - Go 语言博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>Go的数组是值语义。一个数组变量表示整个数组，它不是指向第一个元素的指针（不像 C 语言的数组）。当一个数组变量被赋值或者被传递的时候，实际上会复制整个数组。（为了避免复制数组，你可以传递一个指向数组的指针，但是数组指针并不是数组）<br>
一个切片可以看作一个结构体，包含三个元素：指向数组的指针、片段的长度和容量。</p></blockquote> <h3 id="make"><a href="#make" class="header-anchor">#</a> make</h3> <p><a href="https://golang.org/ref/spec#Making_slices_maps_and_channels" target="_blank" rel="noopener noreferrer">Making slices, maps and channels<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>个人认为 make 是一个非常神奇的存在。</p> <blockquote><p>内置函数 <code>make</code> 接受的第一个参数是类型 <code>T</code>（仅限于 <code>slice</code>、<code>map</code> 或 <code>channel</code>）。第二个（可选）参数是一个表达式列表，因 <code>T</code> 而异。<code>make</code> 返回一个 <code>T</code> 的值（而非指针）。</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Call             Type T     Result

make(T, n)       slice      slice of type T with length n and capacity n
make(T, n, m)    slice      slice of type T with length n and capacity m

make(T)          map        map of type T
make(T, n)       map        map of type T with initial space for approximately n elements

make(T)          channel    unbuffered channel of type T
make(T, n)       channel    buffered channel of type T, buffer size n
</code></pre></div><p>可以理解成 <code>make</code> 是一个初始化的工具函数。</p> <h3 id="映射-map"><a href="#映射-map" class="header-anchor">#</a> 映射 map</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 一个 string -&gt; Vertex 的映射</span>
<span class="token comment">// 未初始化，不能直接使用</span>
<span class="token keyword">var</span> m  <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Vertex

<span class="token comment">// make 初始化和复合字面量初始化</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Vertex<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Vertex<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Vertex<span class="token punctuation">{</span>
    <span class="token string">&quot;Bell Labs&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">40.68433</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.39967</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Google&quot;</span><span class="token punctuation">:</span>    <span class="token punctuation">{</span><span class="token number">37.42202</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">122.08408</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 初始化以后就可以用了</span>
m<span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> Vertex<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>                              <span class="token comment">// 增</span>
<span class="token function">delete</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span>                                  <span class="token comment">// 删</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token string">&quot;Bell Labs&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                     <span class="token comment">// 查</span>
m<span class="token punctuation">[</span><span class="token string">&quot;Bell Labs&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> Vertex<span class="token punctuation">{</span><span class="token number">40.68433</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.39968</span><span class="token punctuation">}</span>    <span class="token comment">// 改</span>
</code></pre></div><h2 id="函数和方法"><a href="#函数和方法" class="header-anchor">#</a> 函数和方法</h2> <p>函数：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 接受两个参数，返回一个参数</span>
<span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>

<span class="token comment">// 相同类型可以简写</span>
<span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 可以返回多个值</span>
<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> y<span class="token punctuation">,</span> x
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">,</span> b <span class="token operator">:=</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 返回值可以被命名，赋值后直接 return</span>
<span class="token keyword">func</span> <span class="token function">split</span><span class="token punctuation">(</span>sum <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x <span class="token operator">=</span> sum <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">/</span> <span class="token number">9</span>
    y <span class="token operator">=</span> sum <span class="token operator">-</span> x
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方法：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Vertex <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    X<span class="token punctuation">,</span> Y <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token comment">// go 的方法是写在类外的，所属的类（被称为接收者）需要在函数前指明</span>
<span class="token comment">// 但也不是哪里都可以定义方法：类型定义和方法声明必须在同一包内</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>v Vertex<span class="token punctuation">)</span> <span class="token function">Abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>X<span class="token operator">*</span>v<span class="token punctuation">.</span>X <span class="token operator">+</span> v<span class="token punctuation">.</span>Y<span class="token operator">*</span>v<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 指针接收者的用法和普通接收者完全一样</span>
<span class="token comment">// 但可以进行引用传递而不是值传递，这很像 C++ 的引用</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>v <span class="token operator">*</span>Vertex<span class="token punctuation">)</span> <span class="token function">Scale</span><span class="token punctuation">(</span>f <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v<span class="token punctuation">.</span>X <span class="token operator">=</span> v<span class="token punctuation">.</span>X <span class="token operator">*</span> f
    v<span class="token punctuation">.</span>Y <span class="token operator">=</span> v<span class="token punctuation">.</span>Y <span class="token operator">*</span> f
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Scale</span><span class="token punctuation">(</span>v <span class="token operator">*</span>Vertex<span class="token punctuation">,</span> f <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v<span class="token punctuation">.</span>X <span class="token operator">=</span> v<span class="token punctuation">.</span>X <span class="token operator">*</span> f
    v<span class="token punctuation">.</span>Y <span class="token operator">=</span> v<span class="token punctuation">.</span>Y <span class="token operator">*</span> f
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v <span class="token operator">:=</span> Vertex<span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span>
    <span class="token comment">/*
     * 调用方法不需要考虑传指针还是传变量，直接调用就行
     * 编译器会自动根据方法签名，将代码解释为 (*v).Scale() 或 (&amp;v).Scale()
     */</span>
    v<span class="token punctuation">.</span><span class="token function">Scale</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token function">Scale</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>   <span class="token comment">//而普通函数传参就需要写 &amp;v</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="接口"><a href="#接口" class="header-anchor">#</a> 接口</h2> <p>没学过 Java 的我看 <a href="https://tour.go-zh.org/methods/9" target="_blank" rel="noopener noreferrer">Go 的官方教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的接口部分看得我一脸懵，于是找了其他的教程，看到<a href="https://www.runoob.com/go/go-interfaces.html" target="_blank" rel="noopener noreferrer">菜鸟教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的示例不错。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Phone <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> NokiaPhone <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>nokiaPhone NokiaPhone<span class="token punctuation">)</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;I am Nokia, I can call you!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> IPhone <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>iPhone IPhone<span class="token punctuation">)</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;I am iPhone, I can call you!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> phone Phone

    phone <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>NokiaPhone<span class="token punctuation">)</span>
    phone<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    phone <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>IPhone<span class="token punctuation">)</span>
    phone<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>C++ 没有接口的概念，Java 有，可参考 <a href="https://www.runoob.com/java/java-interfaces.html" target="_blank" rel="noopener noreferrer">Java 接口<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>如果用 C++ 的方式理解，<code>interface</code> 可以裂解为一个“父类”，它声明了很多“虚函数”，由“子类”靠重载进行实现嘛！所以也就出现 <code>interface</code> “接口类型可以被赋值”这种听起来匪夷所思的事情，其实也就是把子类值赋给了父类变量，之后便可以调用父类的成员函数了。</p> <p>这也是 Go 为了弥补没有类而产生的语法吧。</p> <p>顺便一提，main 函数不使用 interface 写法也是可以的：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    phone1 <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>NokiaPhone<span class="token punctuation">)</span>
    phone1<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    phone2 <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>IPhone<span class="token punctuation">)</span>
    phone2<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="空接口-empty-interface"><a href="#空接口-empty-interface" class="header-anchor">#</a> 空接口 empty interface</h3> <p>接口还不止于此：一个不包含任何方法的接口被称为空接口 empty interface。</p> <p>空接口可保存任何类型的值（因为每个类型都至少实现了零个方法）。</p> <p>空接口被用来处理未知类型的值。例如，<code>fmt.Print</code> 可接受类型为 <code>interface{}</code> 的任意数量的参数。</p> <h3 id="类型断言和类型选择-type-assertion-and-switch"><a href="#类型断言和类型选择-type-assertion-and-switch" class="header-anchor">#</a> 类型断言和类型选择 type assertion and switch</h3> <p>所以又接着产生了类型断言 <code>type assertion</code> 和类型选择 <code>type switch</code>。</p> <p>类型断言用于断言这个 <code>interface</code> 里到底是什么东西。其语法及对应输出如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span>

    s <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token comment">// hello</span>

    s<span class="token punctuation">,</span> ok <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> ok<span class="token punctuation">)</span>
    <span class="token comment">// hello true</span>

    f<span class="token punctuation">,</span> ok <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">float64</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> ok<span class="token punctuation">)</span>
    <span class="token comment">// 0 false</span>

    f <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">float64</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token comment">/*
    panic: interface conversion: interface {} is string, not float64

    goroutine 1 [running]:
    main.main()
        /tmp/sandbox906950040/prog.go:17 +0x1fe
    */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>类型选择就是综合了类型断言和 <code>switch</code>：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">switch</span> v <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token comment">// v 的类型为 int</span>
<span class="token keyword">case</span> <span class="token builtin">float64</span><span class="token punctuation">:</span>
    <span class="token comment">// v 的类型为 float64</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token comment">// 没有匹配，v 与 i 的类型相同</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="常用接口-stringer"><a href="#常用接口-stringer" class="header-anchor">#</a> 常用接口 Stringer</h3> <p><a href="https://go-zh.org/pkg/fmt/" target="_blank" rel="noopener noreferrer"><code>fmt</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 包中定义的 <a href="https://go-zh.org/pkg/fmt/#Stringer" target="_blank" rel="noopener noreferrer"><code>Stringer</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是最普遍的接口之一。</p> <p>type Stringer interface {
String() string
}
<a href="https://go-zh.org/pkg/fmt/#Stringer" target="_blank" rel="noopener noreferrer"><code>Stringer</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个可以用字符串描述自己的类型。<a href="https://go-zh.org/pkg/fmt/" target="_blank" rel="noopener noreferrer"><code>fmt</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 包（还有很多包）都通过此接口来打印值。</p> <p>类似于 Java 的 <code>toString()</code>，定义了这个函数以后就可以调用 <code>fmt</code> 输出了。</p> <h2 id="go-包"><a href="#go-包" class="header-anchor">#</a> Go 包</h2> <p>导入包：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;math&quot;</span>

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;math&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>大写开头的变量和函数会被自动导出，小写的则不能被导出。</p> <p>所以，Go 的命名方法是，需要导出的东西使用 PascalCase，而内部的东西使用 camelCase。看起来很怪异，因为这和 C++/Java 的类使用 PascalCase、对象使用 camelCase 不同。</p> <h2 id="go-语言代码风格"><a href="#go-语言代码风格" class="header-anchor">#</a> Go 语言代码风格</h2> <p><code>go fmt &lt;filename&gt;.go</code> 永远滴神！</p> <p>虽然 <code>go fmt</code> 的风格是用 tab，还是八个空格的 tab，但至少有一个官方排版方案，所以比 C++、Java、Python 各种民间规范更能让人接受。</p> <h2 id="go-的指针"><a href="#go-的指针" class="header-anchor">#</a> Go 的指针</h2> <p>指针和引用的功能是类似的，所以很多语言语言只实现了指针（如 C、Go），或只实现了引用（如 Java、Python）。如果二者都实现了，可能开发者也偏向于使用单一的一种（如 C++ STL中基本都是使用指针）。</p> <p>Go 只实现了指针。但是不同的是，它的指针结构体有点意思：<code>(*p).X</code> 可以简写为 <code>p.X</code>！</p> <p>这种写法，使得结构体指针访问成员可以写成 <code>p.X</code>，这种写法反而更像是引用。所以，Go 虽然使用的是指针，但其语法也借鉴了引用的优点。</p> <h2 id="go-并发"><a href="#go-并发" class="header-anchor">#</a> Go 并发</h2> <h3 id="go-多线程"><a href="#go-多线程" class="header-anchor">#</a> Go 多线程</h3> <p>Go 开多线程也太香了吧，直接 <code>go &lt;function&gt;</code> 就可以了。</p> <h3 id="go-线程同步-信道"><a href="#go-线程同步-信道" class="header-anchor">#</a> Go 线程同步：信道</h3> <p>Go 的线程同步使用的是信道 <code>channel</code>，类似于《操作系统——精髓与设计原理》里进程同步的 <a href="/notes/computer-science/classnotes/operating-system-classnote.html#消息传递">消息传递</a> 方法。</p> <h4 id="无缓冲区信道"><a href="#无缓冲区信道" class="header-anchor">#</a> 无缓冲区信道</h4> <p>默认的信道是<strong>无缓冲区</strong>的，这种情况下采用的是“<strong>阻塞发送、阻塞接收</strong>”的方式：发送方和接收方先准备好的一方会被阻塞，直至另一方也准备好了。</p> <p>创建一个无缓冲区的 <code>int</code> 信道可以使用 <code>c := make(chan int)</code>。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 将求数组和问题分配到两个进程完成（分别计算前 3 个和、后 3 个和）</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">sum</span><span class="token punctuation">(</span>a <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> c <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> a <span class="token punctuation">{</span>
        s <span class="token operator">+=</span> v
    <span class="token punctuation">}</span>
    c <span class="token operator">&lt;-</span> s <span class="token comment">// 将和送入 c</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span>

    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
    <span class="token keyword">go</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
    <span class="token keyword">go</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
    x<span class="token punctuation">,</span> y <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c<span class="token punctuation">,</span> <span class="token operator">&lt;-</span>c <span class="token comment">// 从 c 中接收</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x<span class="token operator">+</span>y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>c</code> 无缓冲区，因此在主线程执行 <code>x, y := &lt;-c, &lt;-c</code> 之前就准备好的 <code>c&lt;-s</code>  的 <code>sum</code> 会被阻塞。</p> <p>对于无缓冲区的信道，这么写会报死锁：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
    ch <span class="token operator">&lt;-</span> <span class="token number">1</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
fatal error: all goroutines are asleep - deadlock!

goroutine 1 [chan send]:
main.main()
    /tmp/sandbox780334017/prog.go:7 +0x59

Program exited.
*/</span>
</code></pre></div><h4 id="有缓冲区信道"><a href="#有缓冲区信道" class="header-anchor">#</a> 有缓冲区信道</h4> <p>下面这种使用缓冲区信道，则是：当缓冲区满时阻塞发送方、当缓冲区空时阻塞接收方。又像是生产者、消费者问题模型了。</p> <p>缓冲区大小为 n 的 <code>int</code> 信道定义方法为 <code>ch := make(chan int, n)</code>。顺便一提，无缓冲区的代码也可以用 <code>ch := make(chan int, 0)</code> 定义。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    ch <span class="token operator">&lt;-</span> <span class="token number">1</span>
    ch <span class="token operator">&lt;-</span> <span class="token number">2</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>有意思的是，如果加两行，也会报死锁：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    ch <span class="token operator">&lt;-</span> <span class="token number">1</span>
    ch <span class="token operator">&lt;-</span> <span class="token number">2</span>
    ch <span class="token operator">&lt;-</span> <span class="token number">3</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
fatal error: all goroutines are asleep - deadlock!

goroutine 1 [chan send]:
main.main()
    /tmp/sandbox780334017/prog.go:7 +0x59

Program exited.
*/</span>
</code></pre></div><h4 id="源源不断从信道接收值"><a href="#源源不断从信道接收值" class="header-anchor">#</a> 源源不断从信道接收值</h4> <p>发送者可通过 <code>close(c)</code> 关闭一个信道，表示没有需要发送的值了。</p> <p>接收者可以使用 <code>v, ok := &lt;-ch</code> 判断信道是否被关闭：若没有值可以接收且信道已被关闭，那么执行后 <code>ok</code> 会被设置为 <code>false</code>。</p> <p>循环 <code>for i := range c</code> 会不断从信道接收值，直到它被关闭。</p> <p>注意：</p> <ol><li>信道关闭后，之前传进缓冲区的值仍可被接收；</li> <li>信道关闭并没有值可以接收后，再次接收会接收到零值（如果信道没有关闭，该线程会被阻塞）；</li> <li>只有发送者才能关闭信道，而接收者不能。因为向一个已经关闭的信道发送数据会引发程序恐慌 (panic)。</li> <li>关闭信道不是必需操作。只有在需要终止一个 <code>range</code> 循环等情况下需要关闭。</li></ol> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 万能的斐波那契数列</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> c <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">,</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        c <span class="token operator">&lt;-</span> x
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> y<span class="token punctuation">,</span> x<span class="token operator">+</span>y
    <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">go</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token function">cap</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> c <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="select-选择最先就绪的执行"><a href="#select-选择最先就绪的执行" class="header-anchor">#</a> select 选择最先就绪的执行</h4> <p><code>select</code> 会阻塞当前线程，直至某个分支可以继续执行，这时就会执行该分支。当多个分支都准备好时会随机选择一个执行。</p> <p>也可以添加 <code>default</code>，如果当前没有分支可以执行，就不会阻塞当前线程而是执行 <code>default</code> 语句。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tick <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
    boom <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token number">500</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token keyword">select</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token operator">&lt;-</span>tick<span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;tick.&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token operator">&lt;-</span>boom<span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;BOOM!&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;    .&quot;</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">50</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>输出：</p> <div class="language- extra-class"><pre class="language-text"><code>    .
    .
tick.
    .
    .
tick.
    .
    .
tick.
    .
    .
tick.
    .
    .
BOOM!
</code></pre></div><h4 id="互斥锁"><a href="#互斥锁" class="header-anchor">#</a> 互斥锁</h4> <p>互斥方案就类似于《操作系统——精髓与设计原理》里进程同步的<a href="/notes/computer-science/classnotes/operating-system-classnote.html#信号量">信号量</a>了。</p> <div class="language- extra-class"><pre class="language-text"><code>package main

import (
    &quot;fmt&quot;
    &quot;sync&quot;
    &quot;time&quot;
)

// SafeCounter 的并发使用是安全的。
type SafeCounter struct {
    v   map[string]int
    mux sync.Mutex
}

// Inc 增加给定 key 的计数器的值。
func (c *SafeCounter) Inc(key string) {
    c.mux.Lock()
    // Lock 之后同一时刻只有一个 goroutine 能访问 c.v
    c.v[key]++
    c.mux.Unlock()
}

// Value 返回给定 key 的计数器的当前值。
func (c *SafeCounter) Value(key string) int {
    c.mux.Lock()
    // Lock 之后同一时刻只有一个 goroutine 能访问 c.v
    defer c.mux.Unlock()
    return c.v[key]
}

func main() {
    c := SafeCounter{v: make(map[string]int)}
    for i := 0; i &lt; 1000; i++ {
        go c.Inc(&quot;somekey&quot;)
    }

    time.Sleep(time.Second)
    fmt.Println(c.Value(&quot;somekey&quot;))
}
</code></pre></div></div> <hr role="separator" aria-orientation="horizontal" class="ma-4 v-divider theme--light"> <div data-v-43fd1027><script src="https://giscus.app/client.js" async="async" service="giscus" data-repo="lyh543/blog-comments" data-repo-id="R_kgDOHIb2Zg" data-category="Announcements" data-category-id="DIC_kwDOHIb2Zs4COh2z" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" data-v-43fd1027></script></div></div></div></article></div> <!----></div></div> <div role="dialog" class="v-dialog__container"><button type="button" role="button" aria-haspopup="true" aria-expanded="false" class="v-btn v-btn--bottom v-btn--is-elevated v-btn--fab v-btn--fixed v-btn--has-bg v-btn--right v-btn--round theme--dark v-size--default primary"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-information-variant theme--dark"></i></span></button><!----></div></div></div></main> <footer id="footer" class="v-footer v-sheet theme--light v-footer--absolute v-footer--padless v-footer--inset" style="left:0px;right:0px;bottom:0px;"><div class="lighten-1 text-center v-card v-sheet theme--light rounded-0" style="width:100%;"><div class="v-card__text"><a href="https://github.com/lyh543/vuepress-theme-blog-material/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-github theme--light" style="font-size:24px;"></i></span></a><a href="https://blog.lyh543.cn/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-web theme--light" style="font-size:24px;"></i></span></a><a href="mailto:lyh543@outlook.com" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-email theme--light" style="font-size:24px;"></i></span></a><a href="https://weibo.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-sina-weibo theme--light" style="font-size:24px;"></i></span></a><a href="https://weixin.qq.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-wechat theme--light" style="font-size:24px;"></i></span></a><a href="https://qq.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-qqchat theme--light" style="font-size:24px;"></i></span></a><a href="https://bilibili.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><div class="v-image v-responsive theme--light" style="max-width:24px;"><div class="v-image__image v-image__image--preload v-image__image--cover" style="background-image:;background-position:center center;"></div><div class="v-responsive__content"></div></div></span></a></div> <hr role="separator" aria-orientation="horizontal" class="v-divider theme--light"> <div class="v-card__text"><span class="footer-text">lyh543 © 2019 - 2022</span>
        |
      <a href="https://beian.miit.gov.cn/" target="_blank" class="footer-link">蜀ICP备19034464号</a>
        |
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" class="footer-link">署名 - 非商业性 - 相同方式共享 4.0 国际协议</a>
        |
       <span class="footer-text">
        Theme
        <a href="https://github.com/lyh543/vuepress-theme-blog-material/" target="_blank" class="footer-link">
          vuepress-theme-blog-material
        </a></span></div></div></footer></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bb8cc200.js" defer></script><script src="/assets/js/83.e40db432.js" defer></script>
  </body>
</html>
