<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>将 npm 项目迁移到 pnpm + monorepo | 小灰灰灰灰的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/theme/favicon.png">
    <link rel="alternate" type="application/rss+xml" href="https://blog.lyh543.cn/rss.xml" title="小灰灰灰灰的博客 RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://blog.lyh543.cn/feed.atom" title="小灰灰灰灰的博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://blog.lyh543.cn/feed.json" title="小灰灰灰灰的博客 JSON Feed">
    <meta name="description" content="

最近学习了 monorepo 这个东西，发现非常适合我们公司的前端架构，于是跟大家讨论了以后，用周末两天的时间将原来的“每个包一个 repo” 的 multirepo 架构重构成“一个 repo 里放所有包”的 monorepo 架构。目前前端大佬还有一些顾虑，所以还没有马上将开发工作迁移过去，不过我个人在测试 monorepo 的各个包是否正常工作的时候，用着感觉是非常爽的。

当然，改架构 ...">
    
    <link rel="preload" href="/assets/css/0.styles.832ac33f.css" as="style"><link rel="preload" href="/assets/js/app.0ffc50bc.js" as="script"><link rel="preload" href="/assets/js/204.ebe1e4e0.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.832ac33f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-app="true" id="app" class="v-application v-application--is-ltr theme--light"><div class="v-application--wrap"><!----> <main id="main-content" class="v-main" style="padding-top:0px;padding-right:0px;padding-bottom:0px;padding-left:0px;"><div class="v-main__wrap"><div><container class="article-column-container"><div class="article-column"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><div class="v-card v-sheet theme--light"><div class="container"><div itemprop="articleBody" class="markdown-body content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>最近学习了 monorepo 这个东西，发现非常适合我们公司的前端架构，于是跟大家讨论了以后，用周末两天的时间将原来的“每个包一个 repo” 的 multirepo 架构重构成“一个 repo 里放所有包”的 monorepo 架构。目前前端大佬还有一些顾虑，所以还没有马上将开发工作迁移过去，不过我个人在测试 monorepo 的各个包是否正常工作的时候，用着感觉是非常爽的。</p> <p>当然，改架构是非常麻烦的事情，周末两天我一直在 pnpm 官方文档、GitHub 开源仓库、GitLab CI 手册，还有 Stack Overflow 里来回跳转，大头的时间都花在了调试 CI 上。</p> <p>另外，multirepo 合并到 monorepo 会比较容易，但是再拆开就会很麻烦了，任何东西都是如此，合的时候至少还可以 ctrl+cv，但是分的时候就得把每个部分盘综错节的地方捋顺，才能一步步拆开。所以，如果想要把旧项目合并为 monorepo，还是需要三思。</p> <h2 id="为什么要换成-pnpm-和-monorepo"><a href="#为什么要换成-pnpm-和-monorepo" class="header-anchor">#</a> 为什么要换成 pnpm 和 monorepo</h2> <p>我们小公司目前前端 5 个人，维护了 8 个 npm 库。其中三个是微信小程序，剩下的 5 个都是为三个微信小程序服务，按功能拆分为 UI 组件、API、i18n 等独立成包。在开发 UI 组件库（以及其他包）的时候难免需要微信小程序从本地 link 到这些包，然后在本地边写边预览。</p> <p>更麻烦的地方在于，React 17 的 Hooks 要求全局只有一个 <code>react</code> 实例，所以 link 回来 link 过来，所有 link 的包的 react 还需要 link 到同一个，不然就是经典 <a href="https://reactjs.org/docs/error-decoder.html?invariant=321" target="_blank" rel="noopener noreferrer">React Error 321<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>而 pnpm 和为处理 monorepo 架构而生的 <a href="https://pnpm.io/zh/workspaces" target="_blank" rel="noopener noreferrer">pnpm workspace<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以完美解决上面这两个问题。在一个 pnpm workspace 中敲下 <code>pnpm install</code>，会发生：</p> <ol><li>workspace 里的所有包的外部依赖都会被下载到 workspace 的根目录的 <code>node_modules</code> 下。</li> <li>所有包的外部依赖都会在包的 <code>node_modules</code> 下，以软链接的形式 link 到 workspace 的根目录的 <code>node_modules</code> 下。</li> <li>workspace 内部的相互依赖，会按照 <code>package.json</code> 中版本号的写法，完成从 registry 安装（就是步骤 1），或是本地 link。</li></ol> <p>总结来说，就是整个 workspace 相同版本的外部依赖只会安装一份；但每个包访问 node_modules 的结果是和非 workspace 模式下的 node_modules 相同的。并且，所有包的 <code>react</code> 都会指向同一份 <code>react</code>，也就是 workspace 根目录下的那一份。</p> <p>pnpm 作为 npm 和 yarn 之后的新起之秀，除了上面所说的好处，还有通过硬链接（而非 <code>cache</code>）增加安装速度、节约硬盘空间，解决 npm@3 和 yarn 以来的幽灵依赖问题，无脑推荐大家使用。如果老的项目依赖存在幽灵依赖导致无法正常运行，可以毫不羞耻的在项目 <code>.npmrc</code> 里写一行 <code>shamefully-hoist=true</code>。</p> <p>pnpm 我是无脑推荐的，不过对于 monorepo，还是要看业务、看项目规模和项目交叉情况而定。</p> <p>monospace 的好处还有配置的地方，比如 devDependencies、tsconfig、eslint、prettier、CI 不用 ctrl+cv，开新的包的心智负担也会小很多。</p> <p>monorepo 最大的坏处是，所有包都在一个 repo 里。如果是一个大体量的团队共用一个 monorepo，一个问题是<strong>权限管理</strong>，用 Git 不能阻止一个人读某个文件夹（写权限倒是可以通过 Code Review）。另一个问题是<strong>仓库过大</strong>的时候，每个人都要拉取所有包，但可能只会改某几个包的内容。当然，小体量的团队就没有这些问题了。</p> <h2 id="最麻烦的-ci-和-semantic-release"><a href="#最麻烦的-ci-和-semantic-release" class="header-anchor">#</a> 最麻烦的：CI 和 semantic-release</h2> <p>下面就是复盘重构的过程了。这里我没有按照重构步骤的顺序开展，而是选择先讲麻烦的步骤，再讲简单的步骤。重构这件事情，在工具不足的情况下，完全有可能完成了 99% 的部分的时候，发现工具不支持/支持不完善等等原因，不得不放弃重构。所以周末两天里，我的第一天是 all in CI，最后一天也是一直在调试 CI，最后才基本搞定。</p> <p>我们目前所有包都是使用 <a href="https://github.com/semantic-release/semantic-release" target="_blank" rel="noopener noreferrer">semantic-release<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来发布，配置好以后，只需要往 beta 和 main 上发 MR，就可以自动发版了。</p> <p>如果要切换到 pnpm + monorepo，会发现这两个东西都还没有得到 <code>semantic-release</code> 的官方支持 2333。</p> <p>对于 pnpm 来说，semantic-release 需要支持使用 pnpm 发版，或者也可以支持 pnpm 的 <code>workspace:</code> 协议。在 pnpm workspace 中，如果用这个表示法替换掉 <code>package.json</code> 里的版本号，<code>pnpm i</code> 时会自动 link 本地的包。而 <code>pnpm publish</code> 发版时，打包里的 <code>package.json</code> 就是替换后的当前 monorepo 里最新的版本号。</p> <p>而对于 monorepo 来说，<code>semantic-release</code> 最大的问题是通过在 repo 上打 <code>v1.0.0</code> 这样的 tag 判断每个包的版本号。而 monorepo 下会有多个包，显然不能继续用这个方法打 tag、根据 tag 判断包的版本。其他还有一些小问题，比如同时发版几个包，相互依赖的包的版本号也需要同时更新。Vue 3 使用的就是 pnpm + monorepo，想参考一下他们怎么发版的，发现是尤大<a href="https://github.com/vuejs/core/blob/4a3237ad9300693e465f82a6be3552565a1c4be3/scripts/release.js" target="_blank" rel="noopener noreferrer">手搓的脚本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>所以我第一天做的事情，就是在本地和 CI 的环境里测了一下目前市面上声称支持 monorepo 的 semantic-release 插件是否由于有支持 pnpm 的 <code>workspace:</code> 协议。最后发现 <a href="https://github.com/dhoulb/multi-semantic-release" target="_blank" rel="noopener noreferrer">dhoulb/multi-semantic-release<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 通过发版前手动替换版本，实现了这一点。不过还是有个小 bug，它会将 <code>workspace:^</code> 也替换为 <code>1.5.0</code> 这样的单版本号，而不是 <code>^1.5.0</code>。不过我的要求不高，能用就行。</p> <p>pnpm 相关的 CI 也很好写：</p> <ol><li>先按<a href="https://pnpm.io/zh/continuous-integration" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置 pnpm 以及 cache</li> <li>然后 <code>pnpm i</code> 安装 workspace 内所有依赖</li> <li>接着 <code>pnpm run -r build</code>，同时调用所有带 <code>build</code> 指令的包进行构建。如果想降低任务并发度，可以加 <code>--workspace-concurrency=&lt;count&gt;</code></li> <li>最后 <code>pnpm run -r test</code>，同时调用所有带 <code>build</code> 指令的包进行测试</li></ol> <p>总之 CI 调好了，正式迁移的速度会很快。</p> <h2 id="次麻烦的-历史记录"><a href="#次麻烦的-历史记录" class="header-anchor">#</a> 次麻烦的：历史记录</h2> <p>将 8 个 repo 的历史记录合并在一起，也是一件麻烦事。而且，由于 <code>multi-semantic-release</code> 依靠 tag 判断版本号，所以最好也能保留 tag，并改为 <code>multi-semantic-release</code> 的 <code>package@1.0.0</code> 形式。不保留 tag 也是可以的，只要最后手动给分支打上最新版本的 tag，semantic-release 发版的时候就能算出下一个版本号了。</p> <p>稍微 Google 了一下，就能找到<a href="https://stackoverflow.com/a/10548919/12208030" target="_blank" rel="noopener noreferrer">合并 git 历史记录<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和<a href="https://stackoverflow.com/a/5719854/12208030" target="_blank" rel="noopener noreferrer">重命名 tag<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的方法。</p> <p>麻烦的是，我们有 8 个 repo，迁移每个 repo 的历史记录都要 5 行 git 命令，稍微错一点就会炸掉。</p> <p>解决办法是，写成脚本，这样就可以反复执行了，出错了重新 clone 下来再跑一遍就行。为了进一步加速，可以先把所有仓库 clone 到一个 <code>origin</code> 的文件夹，每次重跑脚本就直接复制一份到 <code>local</code> 文件夹，在这个文件夹里执行迁移代码。</p> <p>在脚本语言的选择上，我选择了 Python 而不是 shell，Python 我更熟一点，另外 shell 的只有字符串类型、纯字符串拼接着实有点用不惯。最关键的一点，<s>我在 Windows 上开发，要用也是 Powershell</s></p> <p>完整代码就不放全了，影响博客观感。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">rename_tags</span><span class="token punctuation">(</span>project_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># https://stackoverflow.com/a/16251698/12208030</span>
    os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>LOCAL_DIR <span class="token operator">/</span> project_name<span class="token punctuation">)</span>
    tags <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'git tag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> old <span class="token keyword">in</span> tags<span class="token punctuation">:</span>
        new <span class="token operator">=</span> old<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'@bitme/</span><span class="token interpolation"><span class="token punctuation">{</span>project_name<span class="token punctuation">}</span></span><span class="token string">@'</span></span><span class="token punctuation">)</span>
        commit_hash <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git rev-list -n 1 </span><span class="token interpolation"><span class="token punctuation">{</span>old<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git tag -d </span><span class="token interpolation"><span class="token punctuation">{</span>old<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git tag </span><span class="token interpolation"><span class="token punctuation">{</span>new<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>commit_hash<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>


<span class="token comment"># https://stackoverflow.com/a/10548919/12208030</span>
<span class="token keyword">def</span> <span class="token function">migrate_commits</span><span class="token punctuation">(</span>project_name<span class="token punctuation">,</span> branch<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>LOCAL_DIR <span class="token operator">/</span> project_name<span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git checkout -b </span><span class="token interpolation"><span class="token punctuation">{</span>project_name<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git pull origin </span><span class="token interpolation"><span class="token punctuation">{</span>branch<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git filter-repo --to-subdirectory-filter </span><span class="token interpolation"><span class="token punctuation">{</span>subdir<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>project_name<span class="token punctuation">}</span></span><span class="token string"> --force'</span></span><span class="token punctuation">)</span>

    os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>LOCAL_DIR <span class="token operator">/</span> get_project_name<span class="token punctuation">(</span>dest<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git remote add </span><span class="token interpolation"><span class="token punctuation">{</span>project_name<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>LOCAL_DIR <span class="token operator">/</span> project_name<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git fetch </span><span class="token interpolation"><span class="token punctuation">{</span>project_name<span class="token punctuation">}</span></span><span class="token string"> --tags'</span></span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git merge --allow-unrelated-histories </span><span class="token interpolation"><span class="token punctuation">{</span>project_name<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>project_name<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'git remote remove </span><span class="token interpolation"><span class="token punctuation">{</span>project_name<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><h2 id="剩下的细枝末节"><a href="#剩下的细枝末节" class="header-anchor">#</a> 剩下的细枝末节</h2> <p>剩下的细枝末节，就是调整某些配置了。大概有以下几点：</p> <ol><li>删掉 npm 创的 <code>package-lock.json</code>，完全迁移到 pnpm</li> <li>将 <code>.gitignore</code> <code>.prettierrc</code>, <code>.releaserc.json</code> <code>.npmrc</code> 的公共配置提升到 monorepo 根目录</li> <li>将 devDepencies 提升到 monorepo 根目录（<code>@types/*</code> 除外，提升了会报错）</li> <li>在本地测试每个包是否功能正常。如果报错找不到依赖，可能要考虑 <code>shamefully-hoist</code>，或者在报错的包的 <code>package.json</code> 补一下缺少的依赖，看看能不能救。</li></ol> <p>最后的最后就是调 CI 了，GitHub 和 GitLab 都没有太方便的本地测试方法，很多地方就是本地不挂 CI 挂，然后改一个地方又要重跑 CI 测 3 分钟，着实麻烦。不过 CI 这玩意，配好了就是一直用一直爽。</p></div> <hr role="separator" aria-orientation="horizontal" class="ma-4 v-divider theme--light"> <div data-v-54a1e472><script src="https://giscus.app/client.js" async="async" service="giscus" data-repo="lyh543/blog-comments" data-repo-id="R_kgDOHIb2Zg" data-category="Announcements" data-category-id="DIC_kwDOHIb2Zs4COh2z" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" data-v-54a1e472></script></div></div></div></article></div> <!----></container> <div class="v-dialog__container"><button type="button" role="button" aria-haspopup="true" aria-expanded="false" class="v-btn v-btn--bottom v-btn--is-elevated v-btn--fab v-btn--fixed v-btn--has-bg v-btn--right v-btn--round theme--dark v-size--default primary"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-information-variant theme--dark"></i></span></button><!----></div></div></div></main> <footer id="footer" class="v-footer v-sheet theme--light v-footer--absolute v-footer--padless v-footer--inset" style="left:0px;right:0px;bottom:0px;"><div class="lighten-1 text-center v-card v-sheet theme--light rounded-0" style="width:100%;"><div class="v-card__text"><a href="https://github.com/lyh543/vuepress-theme-blog-material/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-github theme--light" style="font-size:24px;"></i></span></a><a href="https://blog.lyh543.cn/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-web theme--light" style="font-size:24px;"></i></span></a><a href="mailto:lyh543@outlook.com" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-email theme--light" style="font-size:24px;"></i></span></a><a href="https://weibo.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-sina-weibo theme--light" style="font-size:24px;"></i></span></a><a href="https://weixin.qq.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-wechat theme--light" style="font-size:24px;"></i></span></a><a href="https://qq.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-qqchat theme--light" style="font-size:24px;"></i></span></a><a href="https://bilibili.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><div class="v-image v-responsive theme--light" style="max-width:24px;"><div class="v-image__image v-image__image--preload v-image__image--cover" style="background-image:;background-position:center center;"></div><div class="v-responsive__content"></div></div></span></a></div> <hr role="separator" aria-orientation="horizontal" class="v-divider theme--light"> <div class="v-card__text"><span class="footer-text">lyh543 © 2019 - 2024</span>
        |
      <a href="https://beian.miit.gov.cn/" target="_blank" class="footer-link">蜀ICP备19034464号</a>
        |
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" class="footer-link">署名 - 非商业性 - 相同方式共享 4.0 国际协议</a>
        |
       <span class="footer-text">
        Theme
        <a href="https://github.com/lyh543/vuepress-theme-blog-material/" target="_blank" class="footer-link">
          vuepress-theme-blog-material
        </a></span></div></div></footer></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ffc50bc.js" defer></script><script src="/assets/js/204.ebe1e4e0.js" defer></script>
  </body>
</html>
