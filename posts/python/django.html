<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Django 3.1 学习笔记 | 小灰灰灰灰的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/theme/favicon.png">
    <link rel="alternate" type="application/rss+xml" href="https://blog.lyh543.cn/rss.xml" title="小灰灰灰灰的博客 RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://blog.lyh543.cn/feed.atom" title="小灰灰灰灰的博客 Atom Feed">
    <link rel="alternate" type="application/json" href="https://blog.lyh543.cn/feed.json" title="小灰灰灰灰的博客 JSON Feed">
    <meta name="description" content="

推荐从上往下看。

[官方快速安装指南（3.1 版本）]，安装的教程
[官方中文教程（3.1 版本）]，开发的教程
[MDN 上的 Django 教程]，和上面的教程有重叠，推荐只看[会话]和[用户认证]部分
[Django REST Framework]，这是一个基于 Django 的 RESTful 后端框架，为常见 RESTful 操作提供了模板，大大降低 REST AP ...">
    
    <link rel="preload" href="/assets/css/0.styles.05080bcb.css" as="style"><link rel="preload" href="/assets/js/app.9b5b26a6.js" as="script"><link rel="preload" href="/assets/js/242.b0b139fe.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.05080bcb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-app="true" id="app" class="v-application v-application--is-ltr theme--light"><div class="v-application--wrap"><!----> <main id="main-content" class="v-main" style="padding-top:0px;padding-right:0px;padding-bottom:0px;padding-left:0px;"><div class="v-main__wrap"><div><div class="container"><div class="row justify-center"><div class="col-sm-9 col-12"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><div class="v-card v-sheet theme--light"><div class="container"><div itemprop="articleBody" class="markdown-body content__default"><h2 id="django-后端学习路线"><a href="#django-后端学习路线" class="header-anchor">#</a> Django 后端学习路线</h2> <p>推荐从上往下看。</p> <ul><li><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/install/" target="_blank" rel="noopener noreferrer">官方快速安装指南（3.1 版本）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，安装的教程</li> <li><a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial01/" target="_blank" rel="noopener noreferrer">官方中文教程（3.1 版本）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，开发的教程</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/learn/Server-side/Django" target="_blank" rel="noopener noreferrer">MDN 上的 Django 教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，和上面的教程有重叠，推荐只看<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Django/Sessions" target="_blank" rel="noopener noreferrer">会话<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Django/Authentication" target="_blank" rel="noopener noreferrer">用户认证<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>部分</li> <li><a href="https://q1mi.github.io/Django-REST-framework-documentation/" target="_blank" rel="noopener noreferrer">Django REST Framework<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这是一个基于 Django 的 RESTful 后端框架，为常见 RESTful 操作提供了模板，大大降低 REST API 开发量</li></ul> <h2 id="django-官方教程-关键步骤"><a href="#django-官方教程-关键步骤" class="header-anchor">#</a> Django 官方教程 关键步骤</h2> <p>本小节记录了 <a href="https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial01/" target="_blank" rel="noopener noreferrer">官方中文教程（3.1 版本）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中的关键步骤。</p> <h3 id="_1-创建项目、项目和一个视图"><a href="#_1-创建项目、项目和一个视图" class="header-anchor">#</a> 1. 创建项目、项目和一个视图</h3> <ul><li>安装：<code>pip install Django</code></li> <li>验证安装：<code>python -m django --version</code></li> <li>创建并初始化项目文件夹：<code>django-admin startproject &lt;projectname&gt;</code></li> <li>即时预览：在 <code>&lt;projectname&gt;</code> 目录下 <code>python manage.py runserver [port]</code></li> <li>创建应用：<code>python manage.py startapp &lt;appname&gt;</code></li> <li>编写视图：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># polls/views.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;Hello, world. You're at the polls index.&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>在应用中添加写好的视图：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># polls/urls.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li>在站点中添加应用的视图：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># mysite/urls.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> include<span class="token punctuation">,</span> path

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'polls/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'polls.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="_2-数据库使用、管理员"><a href="#_2-数据库使用、管理员" class="header-anchor">#</a> 2. 数据库使用、管理员</h3> <h4 id="_2-1-配置数据库"><a href="#_2-1-配置数据库" class="header-anchor">#</a> 2.1 配置数据库</h4> <ul><li>安装 mysqlclient：<code>pip install mysqlclient</code></li> <li>修改项目配置文件：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># mysite/settings.py</span>

DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'django_learn'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'yourpassword'</span><span class="token punctuation">,</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token string">'3306'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-2-创建模型并迁移至数据库"><a href="#_2-2-创建模型并迁移至数据库" class="header-anchor">#</a> 2.2 创建模型并迁移至数据库</h4> <p>一个 Django 模型对于一个 SQL 数据表。</p> <ul><li>创建模型：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># polls/models.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models


<span class="token keyword">class</span> <span class="token class-name">Question</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token string">'date published'</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>question_text


<span class="token keyword">class</span> <span class="token class-name">Choice</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    choice_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    votes <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>choice_text
</code></pre></div><ul><li>激活模型：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># mysite/settings.py</span>
INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'polls.apps.PollsConfig'</span> <span class="token comment"># 添加这一项</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li>将模型更改写入数据库：
<ul><li>根据类的更改，生成一个 <code>迁移</code>（一个存储在 <code>&lt;app_lable&gt;/migrations</code> 下的 py 文件，存储了变化）：<code>python manage.py makemigrations [app_label]</code>（<a href="https://docs.djangoproject.com/zh-hans/3.1/ref/django-admin/#makemigrations" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</li> <li>将一个 <code>迁移</code> 应用到数据库，并迁移数据：<code>python manage.py migrate [app_label] [migration_name]</code>（<a href="https://docs.djangoproject.com/zh-hans/3.1/ref/django-admin/#django-admin-migrate" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</li> <li>查看一个 <code>迁移</code> 将对数据库造成的影响：<code>python manage.py sqlmigrate &lt;app_label&gt; &lt;migration_name&gt;</code>（<a href="https://docs.djangoproject.com/zh-hans/3.1/ref/django-admin/#django-admin-sqlmigrate" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</li> <li>一般来说，类变更以后，需要：<code>python manage.py makemigrations &amp;&amp; python manage.py migrate</code></li> <li>第一次部署的时候，需要 <code>python manage.py makemigrations &lt;app1&gt; &lt;app2&gt; &lt;...appn&gt; &amp;&amp; python manage.py migrate</code></li></ul></li></ul> <p>对了，<code>migrations</code> 文件夹应当加入 <code>.gitignore</code>，否则不同开发者的 <code>migrations</code> 就要冲突啦。</p> <h4 id="_2-3-数据库-api"><a href="#_2-3-数据库-api" class="header-anchor">#</a> 2.3 数据库 API</h4> <ul><li>进入 Python 命令行：<code>python manage.py shell</code></li> <li>使用前先引入类：<code>from polls.models import Choice, Question</code></li></ul> <hr> <p>对于一个数据表：</p> <ul><li>一个表的所有元素：<code>Question.objects.all()</code></li> <li>以成员筛选记录：<code>Question.objects.filter(id=1)</code></li> <li>以 <code>pub_date</code> 成员的 <code>year</code> 成员筛选（成员方法同理）：<code>pub_date.year</code>：<code>Question.objects.filter(pub_date__year)</code></li></ul> <hr> <p>对于一个记录：</p> <ul><li>构造一个新记录：<code>q = Question(question_text=&quot;What's new?&quot;, pub_date=timezone.now())</code></li> <li>将记录插入表：<code>q.save()</code></li> <li>查询、修改记录的属性（同理可调用其方法）：<code>q.question_text</code></li> <li>删除一个记录：<code>q.delete()</code></li></ul> <hr> <p>对于一个外键（<code>Choice</code> 存在外键，为 <code>Question</code>）：</p> <ul><li>查询一个 Choice 对应的 Question：<code>c.qeustion</code></li> <li>查询一个 Question 对应的 Choice：<code>q.choice_set.all()</code></li> <li>为 Question 创建一个 Choice：<code>q.choice_set.create(choice_text='Not much', votes=0)</code></li></ul> <h4 id="_2-4-管理员相关"><a href="#_2-4-管理员相关" class="header-anchor">#</a> 2.4 管理员相关</h4> <ul><li>创建管理员：<code>python manage.py createsuperuser</code></li> <li>管理员登录界面：<code>http://127.0.0.1:8000/admin/</code></li> <li>在管理员页面中添加 <code>Question</code> 模型：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># polls/admin.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Question

admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Question<span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-视图和-urls"><a href="#_3-视图和-urls" class="header-anchor">#</a> 3. 视图和 urls</h3> <h4 id="_3-1-添加更多视图-并用参数匹配-url"><a href="#_3-1-添加更多视图-并用参数匹配-url" class="header-anchor">#</a> 3.1 添加更多视图，并用参数匹配 url</h4> <div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># /polls/views.py</span>
<span class="token keyword">def</span> <span class="token function">detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&quot;You're looking at question %s.&quot;</span> <span class="token operator">%</span> question_id<span class="token punctuation">)</span>
    <span class="token comment"># 这里可以做更多的事情，比如调用其他 Python 包</span>
</code></pre></div><div class="language-py extra-class"><pre class="language-py"><code><span class="token comment"># /polls/url.py</span>
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
        path<span class="token punctuation">(</span><span class="token string">'&lt;int:question_id&gt;/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>detail<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><p>访问 <code>/polls/34</code> 会返回 <code>You're looking at question 34.</code></p> <h4 id="_3-2-使用-html-模板"><a href="#_3-2-使用-html-模板" class="header-anchor">#</a> 3.2 使用 HTML 模板</h4> <p>编写一个 HTML 模板：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- /polls/templates/polls/index.html --&gt;</span>
{% if latest_question_list %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    {% for question in latest_question_list %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/polls/{{ question.id }}/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ question.question_text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    {% endfor %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
{% else %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>No polls are available.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
{% endif %}
</code></pre></div><p>再在视图中：加载模板、用数据渲染、然后转为 HTTP Response，三步使用 <code>django.shortcuts.render()</code> 完成</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    latest_question_list <span class="token operator">=</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-pub_date'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>
    context <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'latest_question_list'</span><span class="token punctuation">:</span> latest_question_list<span class="token punctuation">}</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/index.html'</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
</code></pre></div><h4 id="_3-3-抛出-404-错误码"><a href="#_3-3-抛出-404-错误码" class="header-anchor">#</a> 3.3 抛出 404 错误码</h4> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> Http404

<span class="token keyword">def</span> <span class="token function">detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        question <span class="token operator">=</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>question_id<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Question<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Http404<span class="token punctuation">(</span><span class="token string">&quot;Question does not exist&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/detail.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'question'</span><span class="token punctuation">:</span> question<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>也可以使用 <code>django.shortcuts.get_object_or_404</code>。该函数在 <code>object</code> 不存在会 <code>raise Http404()</code>：</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> get_object_or_404<span class="token punctuation">,</span> render

<span class="token keyword">def</span> <span class="token function">detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> pk<span class="token operator">=</span>question_id<span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/detail.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'question'</span><span class="token punctuation">:</span> question<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>也有 <code>get_list_or_404()</code> 函数，工作原理和 <code>get_object_or_404()</code> 一样，除了 <code>get()</code> 函数被换成了 <code>filter()</code> 函数。如果列表为空的话会抛出 <code>Http404</code> 异常。</p> <h4 id="_3-4-使用-name-替代-url-中的硬编码、为-url-名称添加命名空间-app-name"><a href="#_3-4-使用-name-替代-url-中的硬编码、为-url-名称添加命名空间-app-name" class="header-anchor">#</a> 3.4 使用 name 替代 URL 中的硬编码、为 URL 名称添加命名空间(app_name)</h4> <p>https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial03/#removing-hardcoded-urls-in-templates</p> <p>https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial03/#namespacing-url-names</p> <h3 id="_4-编写一个简单的表单"><a href="#_4-编写一个简单的表单" class="header-anchor">#</a> 4. 编写一个简单的表单</h3> <p>因为我想用 Django 做纯 REST 后端，所以这部分略。</p> <p>https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial04/</p> <h3 id="_5-测试"><a href="#_5-测试" class="header-anchor">#</a> 5. 测试</h3> <p>https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial05/</p> <p>关于测试还是值得单独拿一个章节出来的：<a href="/back-end/django-test/">测试</a></p> <h3 id="_6-插入静态文件"><a href="#_6-插入静态文件" class="header-anchor">#</a> 6. 插入静态文件</h3> <p>https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial06/</p> <h3 id="_7-修改-admin-页面"><a href="#_7-修改-admin-页面" class="header-anchor">#</a> 7. 修改 Admin 页面</h3> <p>https://docs.djangoproject.com/zh-hans/3.1/intro/tutorial07/</p> <p>如果想要修改某元素对应外键的信息（而不是修改其外键），可以参考 <a href="https://docs.djangoproject.com/en/3.1/ref/contrib/admin/#django.contrib.admin.StackedInline" target="_blank" rel="noopener noreferrer"><code>django.contrib.admin.StackedInline</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>如果想要汉化 Admin 页面，可以参考：https://blog.csdn.net/aaazz47/article/details/78666099</p> <h2 id="django-用户认证"><a href="#django-用户认证" class="header-anchor">#</a> Django 用户认证</h2> <h3 id="django-用户认证-后端篇"><a href="#django-用户认证-后端篇" class="header-anchor">#</a> Django 用户认证（后端篇）</h3> <blockquote><p>MDN 教程：https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Django/Authentication<br>
文档：https://docs.djangoproject.com/zh-hans/3.1/topics/auth/default/</p></blockquote> <ul><li>创建用户：<code>user = User.objects.create_user('john', 'lennon@thebeatles.com', 'johnpassword')</code></li> <li>创建超级用户：在命令行中 <code>python manage.py createsuperuser</code></li> <li>登录：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> authenticate<span class="token punctuation">,</span> login

<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
    password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>
    user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>request<span class="token punctuation">,</span> username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">)</span>
    <span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        login<span class="token punctuation">(</span>request<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
        <span class="token comment"># Redirect to a success page.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># Return an 'invalid login' error message.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><ul><li>判断用户身份：可以通过 <code>request.user.is_authenticated==False</code> 表示为匿名者；否则 <code>request.user</code> 会被设置为 <code>User</code> 实例。</li> <li>更改密码：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User

u <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'john'</span><span class="token punctuation">)</span>
u<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span><span class="token string">'new password'</span><span class="token punctuation">)</span>
u<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><a href="https://docs.djangoproject.com/zh-hans/3.1/topics/auth/default/#the-login-required-decorator" target="_blank" rel="noopener noreferrer"><code>login_required</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 装饰器：</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required

<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre></div><ul><li>登出：<code>django.contrib.auth.logout(request)</code></li></ul> <h3 id="django-用户认证-前端篇"><a href="#django-用户认证-前端篇" class="header-anchor">#</a> Django 用户认证（前端篇）</h3> <p>Django 的用户认证是用 Session 实现的，和其他的 Session 应该是类似的。但对于零基础前后端开发的我，不清楚这之中究竟发生了什么。于是我简单测试了一下。</p> <p>在登录成功后，应答的 headers 中就会出现 <code>Set-Cookies</code> 字段：</p> <div class="language- extra-class"><pre class="language-text"><code>$ http POST http://127.0.0.1:8000/api/accounts/login/ &lt;&lt;&lt; '{&quot;username&quot;:&quot;lyh543@outlook.com&quot;, &quot;password&quot;:&quot;xxxxxxxx&quot;}'
HTTP/1.1 200 OK
Allow: OPTIONS, POST
Connection: close
Content-Length: 493
Content-Type: application/json
Date: Tue, 09 Feb 2021 05:34:41 GMT
Referrer-Policy: same-origin
Server: WSGIServer/0.2 CPython/3.9.1
Set-Cookie: csrftoken=sJQyvoxpJ7nIwFpbgXSKKiBIoo7GxogKKTmsFwJshfyFMBIEyPlhQrvl8OK6FlQR; expires=Tue, 08 Feb 2022 05:34:40 GMT; Max-Age=31449600; Path=/; SameSite=Lax
Set-Cookie: sessionid=kmst16goqdwof54ycuynbz7wzk1scboc; expires=Tue, 23 Feb 2021 05:34:40 GMT; HttpOnly; Max-Age=1209600; Path=/; SameSite=Lax
Vary: Accept, Cookie, Origin
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
</code></pre></div><p>前一个 <code>csrftoken</code> 是防止跨站请求的，如果项目是前后端分离的话，就需要进行配置（关于 CSRF，可以看 <a href="../handle-cors-and-csrf">和 CSRF 与 CORS 斗智斗勇</a>）；<br>
后一个 <code>sessionid</code> 就是登录成功后的 <code>sessionid</code> 了。如果我们在下次请求中的 headers 中加入了这个 <code>sessionid</code>，服务器就能识别到我们。对于 Django 来说，就是 <code>request.user</code> 为登录的这个用户。</p> <p>对于浏览器、<code>requests.sessions.Session</code> 等，会自动设置 Cookie。下面是利用 <code>requests.sessions.Session</code> 完成登录、查询管理员字段的过程：</p> <div class="language-py extra-class"><pre class="language-py"><code>In <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">import</span> requests

In <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span> s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r1 <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8000/api/accounts/login/&quot;</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;lyh543@outlook.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;xxxxxxxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r1
Out<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>Response <span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

In <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token string">'csrftoken'</span><span class="token punctuation">:</span> <span class="token string">'s1aepuw0A08k9PsFtTWn6CbCkLU24MU6tTuk3DieW4uj1b6PAXwSjrfHqfCvufz3'</span><span class="token punctuation">,</span>
 <span class="token string">'sessionid'</span><span class="token punctuation">:</span> <span class="token string">'f9ofrqwar9rs0phbg4p89647pwryowrs'</span><span class="token punctuation">}</span>

In <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r1<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers
Out<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'python-requests/2.18.4'</span><span class="token punctuation">,</span> <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span> <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span> <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span> <span class="token string">'Content-Length'</span><span class="token punctuation">:</span> <span class="token string">'47'</span><span class="token punctuation">,</span> <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">}</span>

In <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r1<span class="token punctuation">.</span>headers
Out<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'Date'</span><span class="token punctuation">:</span> <span class="token string">'Tue, 09 Feb 2021 03:48:32 GMT'</span><span class="token punctuation">,</span> <span class="token string">'Server'</span><span class="token punctuation">:</span> <span class="token string">'WSGIServer/0.2 CPython/3.9.1'</span><span class="token punctuation">,</span> <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span> <span class="token string">'Vary'</span><span class="token punctuation">:</span> <span class="token string">'Accept, Cookie, Origin'</span><span class="token punctuation">,</span> <span class="token string">'Allow'</span><span class="token punctuation">:</span> <span class="token string">'OPTIONS, POST'</span><span class="token punctuation">,</span> <span class="token string">'X-Frame-Options'</span><span class="token punctuation">:</span> <span class="token string">'DENY'</span><span class="token punctuation">,</span> <span class="token string">'Content-Length'</span><span class="token punctuation">:</span> <span class="token string">'493'</span><span class="token punctuation">,</span> <span class="token string">'X-Content-Type-Options'</span><span class="token punctuation">:</span> <span class="token string">'nosniff'</span><span class="token punctuation">,</span> <span class="token string">'Referrer-Policy'</span><span class="token punctuation">:</span> <span class="token string">'same-origin'</span><span class="token punctuation">,</span> <span class="token string">'Set-Cookie'</span><span class="token punctuation">:</span> <span class="token string">'csrftoken=s1aepuw0A08k9PsFtTWn6CbCkLU24MU6tTuk3DieW4uj1b6PAXwSjrfHqfCvufz3; expires=Tue, 08 Feb 2022 03:48:32 GMT; Max-Age=31449600; Path=/; SameSite=Lax, sessionid=f9ofrqwar9rs0phbg4p89647pwryowrs; expires=Tue, 23 Feb 2021 03:48:32 GMT; HttpOnly; Max-Age=1209600; Path=/; SameSite=Lax'</span><span class="token punctuation">,</span> <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'close'</span><span class="token punctuation">}</span>

In <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r1 <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8000/api/activities/1/admin/&quot;</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r1
Out<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>Response <span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><p>而对于非登录操作、或登录失败，应答中的字段就不会有 <code>Set-Cookies</code> 字段，<code>requests.sessions.Session</code> 也不会设置 <code>Cookies</code>：</p> <div class="language-py extra-class"><pre class="language-py"><code>In <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">import</span> requests

In <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span> s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r1 <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8000/api/activities/1/admin/&quot;</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r1
Out<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>Response <span class="token punctuation">[</span><span class="token number">403</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

In <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">:</span> s<span class="token punctuation">.</span>cookies
Out<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>RequestsCookieJar<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

In <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre></div><p>Django Session 的过期时间也是可以通过修改 <a href="https://docs.djangoproject.com/zh-hans/3.1/ref/settings/#session-cookie-age" target="_blank" rel="noopener noreferrer"><code>SESSION_COOKIE_AGE</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来修改的。</p> <h3 id="使用-jwt-进行身份验证"><a href="#使用-jwt-进行身份验证" class="header-anchor">#</a> 使用 JWT 进行身份验证</h3> <p>Django 自带的 Session 对于很多项目已经够用了。如果想要更高级一点的安全验证，如 Json Web Token，可以尝试 <a href="https://django-rest-framework-simplejwt.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">Simple JWT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配合 Django REST Framework 食用。文档给的示例代码很详细，有需要也可以仿照源码编写自己的 API。</p> <h2 id="django-定时任务"><a href="#django-定时任务" class="header-anchor">#</a> Django 定时任务</h2> <p>可参考 <a href="https://pypi.org/project/django-crontab/" target="_blank" rel="noopener noreferrer">Django-crontab<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="django-rest-framework"><a href="#django-rest-framework" class="header-anchor">#</a> Django REST Framework</h2> <p>这部分就<a href="../django-rest-framework-study-notes">另开一篇博文</a>来写了。</p> <h2 id="django-项目部署-wsgi"><a href="#django-项目部署-wsgi" class="header-anchor">#</a> Django 项目部署 (WSGI)</h2> <p>Django 部署可以采用 WSGI，也可以使用 ASGI。WSGI 是为同步 Web Server 编写的，而 ASGI 是为异步 Web Server 编写的。虽然可以混用，但是同步函数和异步函数可以混用，但是会有约 1ms 的用于线程切换的性能损失。</p> <p>。如果你主要使用的是异步函数，你可以快进到下一章，进行 ASGI 的部署。看完以后，再回来看看如何 <a href="#%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6">处理静态文件</a>。</p> <h3 id="gunicorn"><a href="#gunicorn" class="header-anchor">#</a> Gunicorn</h3> <p>诚然，<code>python manage.py runserver 8000</code> 然后将 8000 端口交给 Nginx / Apache / Caddy 反向代理到 80(http) / 443(https)，是最简单且最直接的方法。但是，其替代方案有多线程、占用内存小等优势。</p> <blockquote><p>Django 的管理命令 <code>startproject</code> 生成了一个最小化的默认 WSGI 配置，你可以按照自己项目的需要去调整这个配置，任何兼容 WSGI 的应用程序服务器都可以直接使用。</p></blockquote> <p>而其中一个 WSGI 应用程序服务器的方案，就是使用 Gunicorn。由于细节比较多，各位先不要急着实践，建议先通读这部分，再决定是否采用这种方式还是直接 <code>startproject</code>。</p> <p>安装 Gunicorn：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>python -m pip <span class="token function">install</span> gunicorn
</code></pre></div><p>在项目文件夹下运行：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>gunicorn -b <span class="token string">&quot;127.0.0.1:8000&quot;</span> <span class="token operator">&lt;</span>projectname<span class="token operator">&gt;</span>.wsgi
</code></pre></div><p>其中 <code>&lt;projectname&gt;.wsgi</code> 也是 Python 的模块的表示方法，其表示 <code>./&lt;projectname&gt;/wsgi.py</code> 这个模块。</p> <p>可以将执行这条命令的过程写为 Systemd 服务，并实现 2 进程、每进程 3 线程，以及自动重启等：</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment"># djangoproject.service</span>
<span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Django Project</span>
<span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span>
<span class="token key attr-name">StartLimitIntervalSec</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>

<span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">simple</span>
<span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">always</span>
<span class="token key attr-name">RestartSec</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">WorkingDirectory</span><span class="token punctuation">=</span><span class="token value attr-value">/path/to/&lt;projectname&gt;/</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/gunicorn -b &quot;127.0.0.1:8000&quot; \</span>
    <span class="token key attr-name">--workers</span><span class="token punctuation">=</span><span class="token value attr-value">2 \</span>
    <span class="token key attr-name">--threads</span><span class="token punctuation">=</span><span class="token value attr-value">3 \</span>
    --access-logfile - \
    &lt;projectname&gt;.wsgi

<span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span>
</code></pre></div><p>命令的 <code>--access-logfile -</code> 表示将 log 输出在控制台，在 Systemd 中即表示可以通过 <code>systemctl status djangoproject</code> 查询日志。</p> <p>然后就是将这项服务复制到 <code>/etc/systemd/system/</code>，然后 enable 和 start 了：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">cp</span> ./djangoproject.service /etc/systemd/system/
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> djangoproject <span class="token comment"># 激活</span>
<span class="token function">sudo</span> systemctl start djangoproject  <span class="token comment"># 启动</span>
<span class="token function">sudo</span> systemctl status djangoproject <span class="token comment"># 查询状态</span>
</code></pre></div><h3 id="处理静态文件"><a href="#处理静态文件" class="header-anchor">#</a> 处理静态文件</h3> <p>但是！这并没有完成部署。访问 <code>localhost:8000</code> 时，可以看到 Django 有正常响应，但是所有静态文件全部失效，Swagger 文档生成也失效了。</p> <p>为了解决这个问题，需要配置静态文件。</p> <p>在 <code>&lt;projectname&gt;/settings.py</code> 中配置以下几个参数</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> os
STATIC_ROOT <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'.static'</span><span class="token punctuation">)</span>
STATIC_URL <span class="token operator">=</span> <span class="token string">'/api/static/'</span>

STATICFILES_DIRS <span class="token operator">=</span> <span class="token punctuation">[</span>
    os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'static'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>三个参数的意义如下：</p> <ul><li><code>BASE_DIR/static</code> 是开发中静态文件所在文件夹</li> <li><code>BASE_DIR/.static</code> 是项目生成后静态文件所在文件夹，应当加入 <code>.gitignore</code></li> <li><code>/api/static/</code> 是在网页中访问静态文件的路径</li></ul> <p>整个过程是这样的：</p> <ol><li>开发者将所需的静态文件放入 <code>BASE_DIR/static</code></li> <li>开发者运行 <code>python3 manage.py collectstatic</code>，Django 将开发者提供的 <code>BASE_DIR/static</code> 文件，和 Swagger 等 APP 提供的静态文件，一并复制进 <code>BASE_DIR/.static</code></li> <li>用户在浏览器中访问 <code>/api/static/</code> 路径，表示用户想访问的文件夹是 <code>BASE_DIR/.static</code></li></ol> <p>所以还需要进行以下两步：</p> <ol><li>运行 <code>python3 manage.py collectstatic</code></li> <li>通过 Nginx / Apache / Caddy 等将静态文件提供给用户</li></ol> <p>Gunicorn 提供了一个 <a href="https://docs.gunicorn.org/en/latest/deploy.html#id5" target="_blank" rel="noopener noreferrer">Nginx.conf 配置模板<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，我也提供一份 Caddy 的配置模板：</p> <div class="language- extra-class"><pre class="language-text"><code>example.com {
    handle /api/static/* {
        uri strip_prefix /api/static
        root * /etc/uestcmsc_webapp/backend/.static
        file_server
    }

    handle /api/* {
        reverse_proxy localhost:8000
    }
    
    handle {
        root * /etc/uestcmsc_webapp/frontend
        try_files {path} /index.html
        file_server
    }
}
</code></pre></div><p>需要注意的是，这种配置的前提是所有 REST API 放在了 <code>/api/</code> 下，这种方法使用的 <code>&lt;projectname&gt;/urls.py</code> 如下：</p> <div class="language-py extra-class"><pre class="language-py"><code>api_urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">r'^docs(?P&lt;format&gt;\.json|\.yaml)$'</span><span class="token punctuation">,</span> schema_view<span class="token punctuation">.</span>without_ui<span class="token punctuation">(</span>cache_timeout<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'schema-json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^docs/$'</span><span class="token punctuation">,</span> schema_view<span class="token punctuation">.</span>with_ui<span class="token punctuation">(</span><span class="token string">'swagger'</span><span class="token punctuation">,</span> cache_timeout<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'schema-swagger-ui'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^redoc/$'</span><span class="token punctuation">,</span> schema_view<span class="token punctuation">.</span>with_ui<span class="token punctuation">(</span><span class="token string">'redoc'</span><span class="token punctuation">,</span> cache_timeout<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'schema-redoc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># ...</span>
<span class="token punctuation">]</span>

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span><span class="token string">'api/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>api_urlpatterns<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="gunicorn-日志-ip-总是显示-127-0-0-1"><a href="#gunicorn-日志-ip-总是显示-127-0-0-1" class="header-anchor">#</a> Gunicorn 日志 ip 总是显示 127.0.0.1</h3> <p>出现这个问题，我第一反应是 Caddy 反代的锅，第二反应是 Django 的锅，最后查了一下才发现是 Gunicorn 的锅。</p> <p><a href="https://stackoverflow.com/questions/25737589/gunicorn-doesnt-log-real-ip-from-nginx" target="_blank" rel="noopener noreferrer">Gunicorn doesn't log real ip from nginx - Stack Overflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>回答也说的很清楚，只需要按照格式修改好后追加到 <code>--access-logformat</code> 参数即可。</p> <p>我把时间、两个 <code>-</code>和 127.0.0.1 去掉以后的配置如下：</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/gunicorn -b &quot;127.0.0.1:8000&quot; \</span>
    <span class="token key attr-name">--workers</span><span class="token punctuation">=</span><span class="token value attr-value">2 \</span>
    <span class="token key attr-name">--threads</span><span class="token punctuation">=</span><span class="token value attr-value">3 \</span>
    --access-logfile - \
    --access-logformat &quot;%({X-Real-IP}i)s \&quot;%(r)s\&quot; %(s)s %(b)s \&quot;%(f)s\&quot; \&quot;%(a)s\&quot;&quot; \
    &lt;projectname&gt;.wsgi
</code></pre></div><h2 id="django-项目部署-asgi"><a href="#django-项目部署-asgi" class="header-anchor">#</a> Django 项目部署 (ASGI)</h2> <p>Django 主推的 ASGI 部署方式，应该是它自己维护的 <a href="https://github.com/django/daphne" target="_blank" rel="noopener noreferrer">Daphne<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>安装 Daphne</p> <div class="language-py extra-class"><pre class="language-py"><code>python <span class="token operator">-</span>m pip install daphne
</code></pre></div><p>在项目文件夹下运行：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>daphne <span class="token operator">&lt;</span>projectname<span class="token operator">&gt;</span>.asgi:application
</code></pre></div><div class="language-ini extra-class"><pre class="language-ini"><code><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/daphne -p 8000 &lt;projectname&gt;.asgi:application</span>
</code></pre></div><p>目前 Daphne 还不支持多进程，如需多进程，请使用 <code>uvicorn</code>。</p> <h2 id="项目开源地址"><a href="#项目开源地址" class="header-anchor">#</a> 项目开源地址</h2> <p>上面提到的项目开源在 <a href="https://github.com/uestc-msc/uestcmsc_webapp_backend/tree/e1f3208664770ccf0b50522a2620d3ccf766024b" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></div> <hr role="separator" aria-orientation="horizontal" class="ma-4 v-divider theme--light"> <!----></div></div></article></div> <!----></div></div> <div role="dialog" class="v-dialog__container"><button type="button" role="button" aria-haspopup="true" aria-expanded="false" class="v-btn v-btn--bottom v-btn--is-elevated v-btn--fab v-btn--fixed v-btn--has-bg v-btn--right v-btn--round theme--dark v-size--default primary"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-information-variant theme--dark"></i></span></button><!----></div></div></div></main> <footer id="footer" class="v-footer v-sheet theme--light v-footer--absolute v-footer--padless v-footer--inset" style="left:0px;right:0px;bottom:0px;"><div class="lighten-1 text-center v-card v-sheet theme--light rounded-0" style="width:100%;"><div class="v-card__text"><a href="https://github.com/lyh543/vuepress-theme-blog-material/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-github theme--light" style="font-size:24px;"></i></span></a><a href="https://blog.lyh543.cn/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-web theme--light" style="font-size:24px;"></i></span></a><a href="mailto:lyh543@outlook.com" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-email theme--light" style="font-size:24px;"></i></span></a><a href="https://weibo.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-sina-weibo theme--light" style="font-size:24px;"></i></span></a><a href="https://weixin.qq.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-wechat theme--light" style="font-size:24px;"></i></span></a><a href="https://qq.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><i aria-hidden="true" class="v-icon notranslate mdi mdi-qqchat theme--light" style="font-size:24px;"></i></span></a><a href="https://bilibili.com/" target="_blank" class="mx-4 v-btn v-btn--icon v-btn--round theme--light v-size--default"><span class="v-btn__content"><div class="v-image v-responsive theme--light" style="max-width:24px;"><div class="v-image__image v-image__image--preload v-image__image--cover" style="background-image:;background-position:center center;"></div><div class="v-responsive__content"></div></div></span></a></div> <hr role="separator" aria-orientation="horizontal" class="v-divider theme--light"> <div class="v-card__text"><span class="footer-text">lyh543 © 2019 - 2022</span>
        |
      <a href="https://beian.miit.gov.cn/" target="_blank" class="footer-link">蜀ICP备19034464号</a>
        |
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" class="footer-link">署名 - 非商业性 - 相同方式共享 4.0 国际协议</a>
        |
       <span class="footer-text">
        Theme
        <a href="https://github.com/lyh543/vuepress-theme-blog-material/" target="_blank" class="footer-link">
          vuepress-theme-blog-material
        </a></span></div></div></footer></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9b5b26a6.js" defer></script><script src="/assets/js/242.b0b139fe.js" defer></script>
  </body>
</html>
