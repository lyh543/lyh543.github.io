<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>C++ I/O 输入输出 | 小灰灰灰灰的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="C++,C++语法">
    <meta name="description" content="C 语言风格 I&#x2F;O 请见C I&#x2F;O。 流：从某种 IO 设备上读入或写出的字符序列。 标准库中的 IO 对象，除了 cin、cout，还有：  cerr：用来输出警告、错误给程序的使用者（可以理解为第二块屏幕）   clog：用于产生 log。  cin, cout123int ch;cin &gt;&gt; ch; &#x2F;&#x2F;ignore endline when readingcout &lt;&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="C++ I&#x2F;O 输入输出">
<meta property="og:url" content="https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/index.html">
<meta property="og:site_name" content="小灰灰灰灰的博客">
<meta property="og:description" content="C 语言风格 I&#x2F;O 请见C I&#x2F;O。 流：从某种 IO 设备上读入或写出的字符序列。 标准库中的 IO 对象，除了 cin、cout，还有：  cerr：用来输出警告、错误给程序的使用者（可以理解为第二块屏幕）   clog：用于产生 log。  cin, cout123int ch;cin &gt;&gt; ch; &#x2F;&#x2F;ignore endline when readingcout &lt;&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-09-04T02:34:08.000Z">
<meta property="article:modified_time" content="2021-09-11T12:19:35.103Z">
<meta property="article:author" content="lyh543">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="C++语法">
<meta name="twitter:card" content="summary">
    
        <link rel="alternate" type="application/atom+xml" title="小灰灰灰灰的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="mdi mdi-close icon-lg"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">lyh543</h5>
          <a href="mailto:lyh543@outlook.com" title="lyh543@outlook.com" class="mail">lyh543@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg mdi mdi-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg mdi mdi-archive"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg mdi mdi-tag-multiple"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg mdi mdi-format-list-bulleted-square"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/lyh543" target="_blank" >
                <i class="icon icon-lg mdi mdi-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg mdi mdi-menu"></i>
        </a>
        <div class="flex-col header-title ellipsis">C++ I/O 输入输出</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg mdi mdi-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg mdi mdi-magnify"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg mdi mdi-share-variant"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">C++ I/O 输入输出</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-09-04T02:34:08.000Z" itemprop="datePublished" class="page-time">
  2019-09-04
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/C/">C++</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/C/C-%E8%AF%AD%E6%B3%95/">C++语法</a></li></ul></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#cin-cout"><span class="post-toc-text">cin, cout</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#istream-getline"><span class="post-toc-text">istream::getline()</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#istream-get"><span class="post-toc-text">istream::get()</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#错误示范1"><span class="post-toc-text">错误示范1</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#错误示范2"><span class="post-toc-text">错误示范2</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设置输出格式"><span class="post-toc-text">设置输出格式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二进制输出"><span class="post-toc-text">二进制输出</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#从文件输入、输出"><span class="post-toc-text">从文件输入、输出</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#fstream-的成员函数"><span class="post-toc-text">fstream 的成员函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#open"><span class="post-toc-text">open()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件指针位置相关操作"><span class="post-toc-text">文件指针位置相关操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#string-和-iostream-的关系"><span class="post-toc-text">string 和 iostream 的关系</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#重载-iostream"><span class="post-toc-text">重载 iostream</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-输出操作符-ostream-重载"><span class="post-toc-text">1. 输出操作符(ostream)重载</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-输入操作符-istream-重载"><span class="post-toc-text">2. 输入操作符(istream)重载</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#刷新输入缓冲区"><span class="post-toc-text">刷新输入缓冲区</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#命令行程序控制输入"><span class="post-toc-text">命令行程序控制输入</span></a></li></ol>
        </nav>
    </aside>


<article id="post-cpp/cpp-grammar/cpp-io"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">C++ I/O 输入输出</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-09-04 10:34:08" datetime="2019-09-04T02:34:08.000Z"  itemprop="datePublished">2019-09-04</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/C/">C++</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/C/C-%E8%AF%AD%E6%B3%95/">C++语法</a></li></ul></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>C 语言风格 I/O 请见<a href="../c-io/">C I/O</a>。</p>
<p>流：从某种 IO 设备上读入或写出的字符序列。</p>
<p>标准库中的 IO 对象，除了 <code>cin</code>、<code>cout</code>，还有：</p>
<ol>
<li><code>cerr</code>：用来输出警告、错误给程序的使用者（可以理解为第二块屏幕）  </li>
<li><code>clog</code>：用于产生 log。</li>
</ol>
<h2 id="cin-cout"><a href="#cin-cout" class="headerlink" title="cin, cout"></a>cin, cout</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ch;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; ch; <span class="comment">//ignore endline when reading</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>

<h2 id="istream-getline"><a href="#istream-getline" class="headerlink" title="istream::getline()"></a>istream::getline()</h2><p><code>getline()</code> 会吃掉回车。</p>
<p>下面这种方法只能用于读 <code>char *</code>。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> <span class="keyword">word</span>[<span class="number">50</span>];</span><br><span class="line"><span class="built_in">cin</span>.getline(<span class="keyword">word</span>, <span class="number">50</span>); <span class="comment">//ignore endline when storing</span></span><br></pre></td></tr></table></figure>

<p>而下面这种方法，把 <code>cin</code> 作为参数则只能用于读取 <code>string</code>。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> str;</span><br><span class="line">getline(<span class="built_in">cin</span>,str);</span><br></pre></td></tr></table></figure>

<p>需要注意，<code>cin.getline</code> 是属于 <code>iostream</code> 的，而 <code>getline(cin,str)</code> 是属于 <code>string</code> 的。</p>
<h2 id="istream-get"><a href="#istream-get" class="headerlink" title="istream::get()"></a>istream::get()</h2><p><code>get()</code> 有两个重载函数：</p>
<ol>
<li>读一个字符</li>
<li>读一个字符串。</li>
</ol>
<p>如果无参数，则是读字符，类似于 <code>getchar()</code>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch = <span class="built_in">cin</span>.<span class="built_in">get</span>();</span><br></pre></td></tr></table></figure>

<p>上面两个都是读取一个字符，若可用则返回它，不可用时会对 <code>cin</code> 设置 <code>failbit</code> 和 <code>eofbit</code>。</p>
<p>如果带参数，可以读 <code>char</code> `char *‘。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> str1[n];</span><br><span class="line"><span class="built_in">cin</span>.<span class="built_in">get</span>(str1, n, <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>

<p>这是读一个字符串，并且可以指定分隔符（最后分隔符会被吃掉）。</p>
<h3 id="错误示范1"><a href="#错误示范1" class="headerlink" title="错误示范1"></a>错误示范1</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a; <span class="keyword">char</span> s[<span class="number">10</span>];</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; a;</span><br><span class="line"><span class="built_in">cin</span>.getline(s);</span><br></pre></td></tr></table></figure>

<p><code>istream&amp; operator&gt;&gt;</code> 不会吃掉最后的空格！！！ </p>
<p>紧接在读取数字等类型的 <code>cin</code> 语句后，<code>getline</code> 会读取其前一条语句留在输入法中的 <code>&quot;\n&quot;</code>而结束。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cin</span> &gt;&gt; a &gt;&gt; s;</span><br></pre></td></tr></table></figure>

<p>而上面这个方法则没有问题。</p>
<p><strong>cin会过滤空白字符，而cin.getline()不会。</strong></p>
<h3 id="错误示范2"><a href="#错误示范2" class="headerlink" title="错误示范2"></a>错误示范2</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a, b, c;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; a &gt;&gt; b;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; c;</span><br></pre></td></tr></table></figure>

<p>输入”1a2”时，当’a’不能输入到b时，输入流将关闭。<br>需要<code>cout.flush()</code></p>
<h2 id="设置输出格式"><a href="#设置输出格式" class="headerlink" title="设置输出格式"></a>设置输出格式</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; fixed; <span class="comment">//一定先 cout &lt;&lt;fixed, 某 OJ 上不写会出错</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; setprecision(n); <span class="comment">//设置有效位数，四舍五入</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; setw(n); <span class="comment">//设置对齐位数</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; setiosflags(ios::left); <span class="comment">//设置对齐方向</span></span><br><span class="line">resetiosflags(ios::left);</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; hex &lt;&lt; setiosflags(ios::showbase) &lt;&lt;  <span class="number">17</span> &lt;&lt; <span class="number">18</span>; <span class="comment">//hex十六进制，oct八进制，dec十进制</span></span><br></pre></td></tr></table></figure>

<h2 id="二进制输出"><a href="#二进制输出" class="headerlink" title="二进制输出"></a>二进制输出</h2><p>函数|作用<br><code>basic_istream&amp; read(char_type* s, std::streamsize count)</code>|以二进制形式输入（不看是不是字符，直接莽输入）<br><code>basic_ostream&amp; write(const char_type* s, std::streamsize count)</code>|以二进制形式输出（失败时调用 <code>setstate(badbit)</code>）</p>
<h2 id="从文件输入、输出"><a href="#从文件输入、输出" class="headerlink" title="从文件输入、输出"></a>从文件输入、输出</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i;</span><br><span class="line">ofstream output;</span><br><span class="line">ifstream input;</span><br><span class="line">output.<span class="built_in">open</span>(<span class="string">"output.txt"</span>);</span><br><span class="line">input.<span class="built_in">open</span>(<span class="string">"input.txt"</span>);</span><br><span class="line">input &gt;&gt; i;</span><br><span class="line">output &lt;&lt; i;</span><br></pre></td></tr></table></figure>

<h3 id="fstream-的成员函数"><a href="#fstream-的成员函数" class="headerlink" title="fstream 的成员函数"></a>fstream 的成员函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>void open(filename, mode)</code></td>
<td>打开文件，详见 <a href="#open">open()</a></td>
</tr>
<tr>
<td><code>bool is_open() const</code></td>
<td>判断是否打开</td>
</tr>
<tr>
<td><code>void close()</code></td>
<td>关闭文件</td>
</tr>
<tr>
<td><code>get()</code></td>
<td>读取一个字符或一行，详见 <a href="#istreamget">get()</a></td>
</tr>
<tr>
<td><code>getline()</code></td>
<td>读取一行（不读回车），详见 <a href="#istreamgetline">getline()</a></td>
</tr>
<tr>
<td><code>basic_istream&amp; read(str, std::streamsize count)</code></td>
<td>以二进制形式输入（不看是不是字符，直接莽输入）</td>
</tr>
<tr>
<td><code>basic_ostream&amp; write(str, std::streamsize count)</code></td>
<td>以二进制形式输出（失败时调用 <code>setstate(badbit)</code></td>
</tr>
<tr>
<td><code>bool eof()</code></td>
<td>判断文件是否结束</td>
</tr>
</tbody></table>
<h3 id="open"><a href="#open" class="headerlink" title="open()"></a>open()</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fstream::open</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> * filename, ios_base::openmode mode)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fstream::open</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp; filename, ios_base::openmode mode)</span></span></span><br></pre></td></tr></table></figure>

<p>其中 mode 是位掩码类型（即可以用 <code>|</code> 进行叠加）：</p>
<table>
<thead>
<tr>
<th>常量</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td><code>app</code></td>
<td>每次写入前寻位到流结尾（输出补充在文末）</td>
</tr>
<tr>
<td><code>binary</code></td>
<td>以二进制模式打开</td>
</tr>
<tr>
<td><code>in</code></td>
<td>为读打开</td>
</tr>
<tr>
<td><code>out</code></td>
<td>为写打开</td>
</tr>
<tr>
<td><code>trunc</code></td>
<td>在打开时舍弃流的内容（若存在文件则覆盖）</td>
</tr>
<tr>
<td><code>ate</code></td>
<td>打开后立即寻位到流结尾（初始位置：文件末）</td>
</tr>
</tbody></table>
<p>mode 的默认参数：<br>fstream：<code>ios_base::in | ios_base::out</code><br>ifstream：<code>ios_base::in | ios_base::trunc</code><br>ofstream：<code>ios_base::out</code></p>
<h3 id="文件指针位置相关操作"><a href="#文件指针位置相关操作" class="headerlink" title="文件指针位置相关操作"></a>文件指针位置相关操作</h3><p>以下 <code>p</code> 代表 <code>put</code>，对输出流操作；<code>g</code> 代表 <code>get</code>，对输入流操作。</p>
<p>文件指针实际上就是一个标记字节的数字，起始为 <code>0</code>。</p>
<p>用成员函数 <code>tellg()/tellp()</code> 获取当前位置，返回 <code>streampos</code>（实际上是一个整型，在 VS 2017 x86/x64 上范围和 <code>signed long long</code> 相同）。</p>
<p>修改的成员函数有绝对和相对的。下仅以 <code>seekp()</code> 作示范，<code>seekg()</code> 用法相同。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">istream&amp; <span class="title">seekg</span> <span class="params">(streampos pos)</span></span>; <span class="comment">//(1)</span></span><br><span class="line"><span class="function">istream&amp; <span class="title">seekg</span> <span class="params">(streamoff off, ios_base::seekdir way)</span></span>; <span class="comment">//(2)</span></span><br></pre></td></tr></table></figure>

<p>(1) 修改到绝对指针，(2) 修改到相对指针，<code>off</code> (offset) 为位移量（可以为负），<code>way</code> 为位移的正负（<code>way &gt; 0</code> 时往流的末尾，<code>way == 0</code> 时往流的开头，建议用 <code>true/false</code>，但既然 <code>off</code> 可以为负，感觉就很鸡肋了）。</p>
<h2 id="string-和-iostream-的关系"><a href="#string-和-iostream-的关系" class="headerlink" title="string 和 iostream 的关系"></a>string 和 iostream 的关系</h2><p>参见这篇<a href="../string/#string-%E5%92%8C-iostream-%E7%9A%84%E5%85%B3%E7%B3%BB">博客</a>。</p>
<h3 id="重载-iostream"><a href="#重载-iostream" class="headerlink" title="重载 iostream"></a>重载 iostream</h3><blockquote>
<p>参考博客: <a href="http://blog.csdn.net/caroline_wendy/article/details/15336063" target="_blank" rel="noopener">http://blog.csdn.net/caroline_wendy/article/details/15336063</a></p>
</blockquote>
<h3 id="1-输出操作符-ostream-重载"><a href="#1-输出操作符-ostream-重载" class="headerlink" title="1. 输出操作符(ostream)重载"></a>1. 输出操作符(ostream)重载</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span>&lt;&lt; (<span class="built_in">std</span>::ostream&amp; os, <span class="keyword">const</span> ClassA&amp; ca);</span><br></pre></td></tr></table></figure>

<p>ostream需要修改，不能复制，所以应该为**非常量引用类型(nonconst &amp;)<strong>；输出类不需要修改, 应该为</strong>常量引用类型(const &amp;)**；</p>
<p>函数有可能使用内部的私有成员，需要定义为**友元(friend)**；</p>
<p>重载操作符应该为非类成员函数(nonmember function)。如果为类成员函数，则也必须为标准库成员函数，显然无法完成。</p>
<p>注意函数不要有格式信息(minimal formatting)，为了和标准输入操作符进行统一。</p>
<h3 id="2-输入操作符-istream-重载"><a href="#2-输入操作符-istream-重载" class="headerlink" title="2. 输入操作符(istream)重载"></a>2. 输入操作符(istream)重载</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::istream &amp;<span class="keyword">operator</span>&gt;&gt; (<span class="built_in">std</span>::istream&amp; is, ClassA&amp; ca);</span><br></pre></td></tr></table></figure>

<p>基本同输出操作符；</p>
<p>参数都为 <code>non-const</code>（都需要修改)；</p>
<p>操作符函数应该包括错误恢复(error recovery)，保证输入错误时，不会产生未知错误；</p>
<p>可以增加 I/O 条件状态(condition state)进行判断，输入错误原因。</p>
<h2 id="刷新输入缓冲区"><a href="#刷新输入缓冲区" class="headerlink" title="刷新输入缓冲区"></a>刷新输入缓冲区</h2><p>在读 <code>int</code> 的时候如果读到了非数字字符，输入流就会被关闭（输入流会变成错误状态），无法继续读入。</p>
<p>解决的办法就是重新打开输入流（将错误状态更改为有效状态），顺便可能需要忽略掉一些字符。</p>
<blockquote>
<p><code>cin.clear()</code> 是将错误状态更改为有效状态<br><code>cin.sync()</code> 是清除缓冲区中的未读信息<br><code>cin.ignore()</code> 是忽略缓冲区中指定个数的字符，还可以指定忽略的结束符</p>
</blockquote>
<p>也就是说，当我们想要刷新输入流并忽略掉已经在缓冲区的字符时，我们可以使用以下方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cin</span>.clear();</span><br><span class="line"><span class="built_in">cin</span>.sync();</span><br></pre></td></tr></table></figure>

<p>但是，在 Visual Studio 2019 上，他貌似并没有清楚缓冲区的未读信息。</p>
<p>在 <a href="https://stackoverflow.com/a/10585440/12208030" target="_blank" rel="noopener">Stack Overflow</a> 上提到了这么一句，</p>
<blockquote>
<p><code>cin.sync</code> discards all unread characters from the input buffer. <strong>However, it is not guaranteed to do so in each implementation.</strong> Therefore, <code>ignore</code> is a better choice if you want consistency.</p>
</blockquote>
<p>大意是， <code>cin.sync</code> 在各个平台上实现的方法可能不一样，比如这里在 Visual Studio 2019 上就不能用 <code>sync</code> 来清楚缓冲区的未读信息。可以改为如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cin</span>.clear();</span><br><span class="line"><span class="built_in">cin</span>.ignore(<span class="number">10000</span>, <span class="string">'\n'</span>);</span><br></pre></td></tr></table></figure>

<p>这样可以忽略掉缓冲区的一行字符。</p>
<p>注意 <code>ignore</code> 还可以忽略还没有输入的字符，如以下程序：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> ch;</span><br><span class="line"><span class="built_in">cin</span>.igore(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">cin</span> &gt;&gt; ch)</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ch;</span><br></pre></td></tr></table></figure>

<p>运行程序，输入 <code>qwertyuiopasdf</code>，会输出 <code>asdf</code>。</p>
<h2 id="命令行程序控制输入"><a href="#命令行程序控制输入" class="headerlink" title="命令行程序控制输入"></a>命令行程序控制输入</h2><p>命令行防止错误的输入真是令人头疼的问题了。一般有两个方案：</p>
<ol>
<li>只使用 <code>cin.getline()</code> 读入，一行一行的读</li>
<li>读错了以后马上刷新，按上面一个标题的办法</li>
</ol>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2021-09-11T12:19:35.103Z" itemprop="dateUpdated">2021-09-11 20:19:35</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://blog.lyh543.cn">
            <img src="/img/avatar.png" alt="lyh543">
            lyh543
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-%E8%AF%AD%E6%B3%95/" rel="tag">C++语法</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/&title=《C++ I/O 输入输出》 — 小灰灰灰灰的博客&pic=https://blog.lyh543.cn/img/avatar.png" data-title="微博">
          <i class="icon mdi mdi-sina-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/&title=《C++ I/O 输入输出》 — 小灰灰灰灰的博客&source=" data-title=" QQ">
          <i class="icon mdi mdi-qqchat"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/" data-title=" Facebook">
          <i class="icon mdi mdi-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《C++ I/O 输入输出》 — 小灰灰灰灰的博客&url=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/&via=https://blog.lyh543.cn" data-title=" Twitter">
          <i class="icon mdi mdi-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/" data-title=" Google+">
          <i class="icon mdi mdi-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-lg mdi mdi-share-variant"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/cpp/cpp-grammar/gdb/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon mdi mdi-chevron-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">gdb 简易调试</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/computer-science/tail-call-optimization/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-lg icon-pl mdi mdi-chevron-right"></i></div>
        <h4 class="title">尾递归优化</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'ec7daa4e047c3c30570d',
          clientSecret: '025a9e40a1d101f28fd1a945d286a819e9fa1c3d',
          repo: 'lyh543.github.io',
          owner: 'lyh543',
          admin: ['lyh543'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg mdi mdi-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>lyh543 &copy; 2019 - 2021</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">蜀ICP备19034464号</a><br>
                
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg mdi mdi-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/&title=《C++ I/O 输入输出》 — 小灰灰灰灰的博客&pic=https://blog.lyh543.cn/img/avatar.png" data-title="微博">
          <i class="icon mdi mdi-sina-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/&title=《C++ I/O 输入输出》 — 小灰灰灰灰的博客&source=" data-title=" QQ">
          <i class="icon mdi mdi-qqchat"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/" data-title=" Facebook">
          <i class="icon mdi mdi-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《C++ I/O 输入输出》 — 小灰灰灰灰的博客&url=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/&via=https://blog.lyh543.cn" data-title=" Twitter">
          <i class="icon mdi mdi-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.lyh543.cn/cpp/cpp-grammar/cpp-io/" data-title=" Google+">
          <i class="icon mdi mdi-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACK0lEQVR42u3aS3LCMBAFQO5/aXIAEvPeCFJlqb2ijLHVXoj5PR7x8Xw5Xs+/Xp/f8/puHzswMDBuy3heHsk1fz34eon55+iJGBgYBzCSRVxfs/KrhPrmDhgYGBgL4eBKWImBgYHxqQ33eqHt9RgYGBgrSWwb2M2+/XoujoGBcUNGXnX//89f6W9gYGDcivEsj5V2wuxMtCoMDIytGbPBiDZxTULA9UENDAyMXRlJQpinji1s1hb95QwGBsbWjLwclpDyluSn2plvaocYGBjbMfJHJrvcrJTfDnAU1UEMDIybM9aHLfJSWvKrdrwDAwPjNMZKA6Ct87Xs+r8CAwNjO0abQObsZLRiNuwV1Q4xMDC2YMwCxCRxnRXy2peFgYGxN6NtN+bfJhtuAivSVwwMjAMY+QjpCni9kTm8HQYGxm0Zs2LZ+uhqksoOZ9wwMDCOZOTp5Ww4o20wDDdcDAyM2zJmQVgeUK6U/ot2BQYGxtaMNvhrt8v1wda6zYCBgbEpI791nViOeqrD9WBgYBzDmAVzSZMgbwYMXxYGBsYxjOvC/WxE47Mvq4htMTAwtmA8yyMpeM2anXnZrohtMTAwtmC0XcL2x+uBYBsyYmBg7MqYbbJtEDkLAYviHQYGxgGMJAXNxyDaDbcdwqhrfhgYGIcx2gmHleZofh4DAwMjD/6SpScvpUZiYGAcwMhHIvJNtq3ttQNhGBgY5zBWUsc8KV0J/vJWKAYGxnaMH4lEA/FiOqW9AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>










</body>
</html>
