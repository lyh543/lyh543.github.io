(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{518:function(t,s,a){"use strict";a.r(s);var n=a(3),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("转载自："),a("a",{attrs:{href:"https://juejin.im/post/6844903961435045902",target:"_blank",rel:"noopener noreferrer"}},[t._v("用GitHub Actions 自动化发布Hexo网站到GitHub Pages - 掘金"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("之前我已经习惯了自己在本地部署 Hexo 并 push，也写过一个一键 push 到博客部署仓库和博客仓库的 shell 脚本，如下：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" pushing to lyh543/lyh543.github.io.backup\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" --all\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"update on '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" +%c"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push origin\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当存在任意参数，如调用时使用 `./hexop 1` 时，则不会 push 到博客部署仓库")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" -z "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" pushing to lyh543/lyh543.github.io\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("\n\n    hexo d -g\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])]),a("p",[t._v("一直这么用着，也没有觉得比 GitHub Actions 麻烦很多，直到当我有同时在笔记本和台式上写博客的需求。deploy 到 GitHub 过程中，如果此次部署的电脑和上次不同，会导致博客部署仓库的 Git 提交记录冲突，必须使用 "),a("code",[t._v("forced update")]),t._v("，导致每次都需要把所有文件重新传一份。")]),t._v(" "),a("p",[t._v("于是开始学习了 GitHub Actions。发现还不错。而且网上也有现有的部署 Hexo 的中文教程可用。下面转载这篇文章，并加入自己的理解。")]),t._v(" "),a("h2",{attrs:{id:"准备-hexo-网站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备-hexo-网站"}},[t._v("#")]),t._v(" 准备 Hexo 网站")]),t._v(" "),a("p",[t._v("在本地建立一个 Hexo 站点，可以参考官方快速开始文档。")]),t._v(" "),a("p",[t._v("建立两个 GitHub 仓库，分别叫 "),a("code",[t._v("blog")]),t._v("（私有的，名字可自取）和 "),a("code",[t._v("your_github_username.github.io")]),t._v("（公有的）。前者用来存储博客源文件，后者用于存储博客部署文件。这里我选择 "),a("code",[t._v("lyh543.github.io.backup")]),t._v(" 存储博客源文件，"),a("code",[t._v("lyh543.github.io")]),t._v(" 存放博客部署文件。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/images/04d0daf452702bd99d8efc0a193d0b21aef1c6b8a8a5207752429e5fb1d65e01.png",alt:"两个仓库最终的效果"}})]),t._v(" "),a("p",[t._v("然后将本地的博客源文件推送到 "),a("code",[t._v("lyh543.github.io.backup")]),t._v(" 仓库。")]),t._v(" "),a("h2",{attrs:{id:"准备-ssh-秘钥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备-ssh-秘钥"}},[t._v("#")]),t._v(" 准备 SSH 秘钥")]),t._v(" "),a("p",[t._v("为了方便运行 GitHub Actions 时登录 GitHub 账号，我们使用 SSH 方式登录。")]),t._v(" "),a("p",[t._v("在本地使用 "),a("code",[t._v("ssh-keygen")]),t._v(" 生成一组公私秘钥对：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("ssh-keygen -t rsa -b "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" -f ~/.ssh/github-actions-deploy\n")])])]),a("p",[t._v("生成了公钥 "),a("code",[t._v("~/.ssh/github-actions-deploy.pub")]),t._v(" 和私钥 "),a("code",[t._v("~/.ssh/github-actions-deploy")]),t._v("。")]),t._v(" "),a("p",[t._v("在 GitHub 的 "),a("code",[t._v("Settings->SSH and GPG keys")]),t._v(" 添加刚刚生成的公钥，名称随意。")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("lyh543.github.io")]),t._v(" 仓库的 "),a("code",[t._v("Settings->Secrets")]),t._v(" 里添加刚刚生成的私钥，名称为 "),a("code",[t._v("ACTION_DEPLOY_KEY")]),t._v("。")]),t._v(" "),a("p",[t._v("如果在 Hexo deploy 过程中还需要 "),a("code",[t._v("sftp")]),t._v(" 部署到服务器，则还需要在服务器添加私钥：在本地执行 "),a("code",[t._v("ssh-copy-id -i ~/.ssh/github-actions-deploy.pub root@you-server-ip.com")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"设置-hexo-的部署配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-hexo-的部署配置"}},[t._v("#")]),t._v(" 设置 Hexo 的部署配置")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("_config.yml")]),t._v(" 添加部署配置：")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Deployment")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Docs: https://hexo.io/docs/deployment.html")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" git\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("repo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("github")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" git@github.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("lyh543/lyh543.github.io.git\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果有 sftp 部署到服务器的需求，则可将下面的部分取消注释")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - type: sftp")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   host: your-server-ip.com")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   user: root")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   # pass: <password>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   remotePath: /var/www/html/blog")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   port: 22")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   privateKey: /home/runner/.ssh/id_rsa # runner 是 GitHub Actions 的 username（这里不能使用 ~ 代替 /home/runner）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   # passphrase: [passphrase]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   # agent: [path/to/agent/socket]")]),t._v("\n")])])]),a("h2",{attrs:{id:"配置-github-actions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-github-actions"}},[t._v("#")]),t._v(" 配置 GitHub Actions")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("lyh543.github.io.backup")]),t._v(" 仓库的 Actions 选项卡下点击新建 workflow，编写如下配置。")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy Blog\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("push"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当有新push时运行")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 一项叫做build的任务")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在最新版的Ubuntu系统下运行")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Checkout "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将仓库内master分支的内容下载到工作目录")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 脚本来自 https://github.com/actions/checkout")]),t._v("\n      \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Use Node.js 10.x "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置Node环境")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置脚本来自 https://github.com/actions/setup-node")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.x"')]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Setup Hexo env\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ACTION_DEPLOY_KEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.ACTION_DEPLOY_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n        # set up private key for deploy\n        mkdir -p ~/.ssh/\n        echo \"$ACTION_DEPLOY_KEY\" | tr -d '\\r' > ~/.ssh/id_rsa # 配置秘钥\n        chmod 600 ~/.ssh/id_rsa\n        ssh-keyscan github.com >> ~/.ssh/known_hosts\n        # ssh-keyscan your-server-ip.com >> ~/.ssh/known_hosts # 如果需要 sftp，则还需要注释掉一行\n        # set git infomation\n        git config --global user.name 'lyh543' # 换成你自己的邮箱和名字\n        git config --global user.email 'lxl361429916@live.com'\n        # install dependencies\n        npm i -g hexo-cli # 安装hexo\n        npm i")]),t._v("\n  \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n        # publish\n        hexo generate && hexo deploy # 执行部署程序")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"/images/6424e531366228e82d00d0579d0db7129d60cc576eada70972de6847e4d55e3d.png",alt:"新建 Workflow"}})]),t._v(" "),a("p",[t._v("直接将配置复制覆盖左边的编辑框的内容即可。名称可自取。然后在本地 "),a("code",[t._v("git pull")]),t._v("。")]),t._v(" "),a("p",[t._v("之后就可以在 GitHub Actions 看到这次部署了。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/images/a03c6f1d0b431474f800176df0ee416408687edf4c524b3c459f8888494fce10.png",alt:"GitHub Actions"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);