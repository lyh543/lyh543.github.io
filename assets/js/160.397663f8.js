(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{575:function(e,t,s){"use strict";s.r(t);var a=s(3),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("blockquote",[s("p",[e._v("2020.2.12 更新：相比 Owncloud，NextCloud 貌似更新。所以我转投 NextCloud 了。另外知乎上也有很多人安利 seafile。\n2020.2.27 更新：接触了 Docker 以后，发现使用 Docker 搭建更加方便（可从"),s("a",{attrs:{href:"../docker"}},[e._v("这篇博客")]),e._v("中了解）。于是也花了一点时间钻研，搭建好了 NextCloud 和 Seafile，并把方法一并写在下面。")])]),e._v(" "),s("h2",{attrs:{id:"安装-owncloud"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-owncloud"}},[e._v("#")]),e._v(" 安装 Owncloud")]),e._v(" "),s("p",[e._v("转载链接：https://zhuanlan.zhihu.com/p/28648363")]),e._v(" "),s("p",[e._v("官方教程：https://doc.owncloud.org/server/9.0/admin_manual/installation/linux_installation.html")]),e._v(" "),s("p",[e._v("按照上面无脑配就可以了。不多说。")]),e._v(" "),s("h2",{attrs:{id:"配置-owncloud"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-owncloud"}},[e._v("#")]),e._v(" 配置 Owncloud")]),e._v(" "),s("p",[e._v("按照知乎的链接装完以后")]),e._v(" "),s("ul",[s("li",[e._v("配置文件在 "),s("code",[e._v("/etc/owncloud/config.php")])]),e._v(" "),s("li",[e._v("云盘文件默认在 "),s("code",[e._v("/var/lib/owncloud/data")]),e._v("，可在开始使用，进入管理员账户的时候修改。")])]),e._v(" "),s("p",[e._v("顺便一提，对于 NextCloud，配置文件在 ``，安装文件在 "),s("code",[e._v("/var/www/html/nextcloud/")]),e._v("。")]),e._v(" "),s("p",[e._v("如果需要进行配置，需要用 apache 用户运行 "),s("code",[e._v("/var/www/html/nextcloud/occ")]),e._v(" 命令，还需要给可执行权限。")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("chmod a+x /var/www/html/nextcloud/occ # 给可执行权限\nsudo -u apache /var/www/html/nextcloud/occ --help\n")])])]),s("h2",{attrs:{id:"安装基于-docker-的-nextcloud"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装基于-docker-的-nextcloud"}},[e._v("#")]),e._v(" 安装基于 Docker 的 NextCloud")]),e._v(" "),s("p",[e._v("为什么要用 Docker 呢？这是为了系统的干净吧。不过坏处是，Docker 的 NextCloud 访问宿主机的文件就没那么容易了。当然，两种方法各有所长。")]),e._v(" "),s("p",[e._v("顺便一提，如果使用 Docker 的话，甚至可以在一台 Windows 电脑上部署了，就可以在自己的 Windows 电脑上搭建一个，然后用 "),s("code",[e._v("frp")]),e._v(" 等方式内网穿透到公网了（可参考"),s("a",{attrs:{href:"/Windows/use-remote-desktop-with-frp"}},[e._v("博客")]),e._v("）。")]),e._v(" "),s("p",[e._v("首先要安装 Docker 以及 Docker Compose，可参照"),s("a",{attrs:{href:"../docker"}},[e._v("这篇教程")]),e._v("。")]),e._v(" "),s("p",[e._v("然后需要几个配置文件，我压缩好以后，放在我的网站上，"),s("a",{attrs:{href:"/blob/nextcloud-docker-compose.tar"}},[e._v("链接在这里")]),e._v("，当然也可以通过下面的命令直接从服务器下载：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" https://blog.lyh543.cn/blob/nextcloud-docker-compose.tar\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" -xf nextcloud-docker-compose.tar\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" nextcloud-docker-compose\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" nextcloud\n")])])]),s("p",[e._v("然后一句")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("docker-compose up -d\n")])])]),s("p",[e._v("经过漫长的镜像下载以后，即可在 "),s("code",[e._v("127.0.0.1:7070")]),e._v(" 看到 NextCloud 初始化页面。")]),e._v(" "),s("h3",{attrs:{id:"配置-nextcloud"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-nextcloud"}},[e._v("#")]),e._v(" 配置 Nextcloud")]),e._v(" "),s("p",[e._v("如果需要进入到 "),s("code",[e._v("docker")]),e._v(" 的虚拟机中，可以使用一下命令进入容器的命令行：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("[root@iz2ze nextcloud]# docker exec -it nextcloud_web_1 /bin/sh\n/ #\n")])])]),s("p",[e._v("其中 "),s("code",[e._v("nextcloud_web_1")]),e._v(" 为你的容器名，一般来说就是这个，可以通过 "),s("code",[e._v("docker ps")]),e._v(" 查看。")]),e._v(" "),s("p",[e._v("进入以后，就是 shell 的操作了。Nextcloud 文件的目录在 "),s("code",[e._v("/var/www/html")]),e._v("。")]),e._v(" "),s("h3",{attrs:{id:"添加信任域名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加信任域名"}},[e._v("#")]),e._v(" 添加信任域名")]),e._v(" "),s("p",[e._v("从别的域名访问的时候，NextCloud 会提示：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('通过不被信任的域名访问\n请联系您的管理员。如果您就是管理员，请参照 config.sample.php 中的示例编辑 config/config.php 中的 "trusted_domains" 设置。\n')])])]),s("p",[e._v("我们需要在容器里配置文件添加自己的域名。")]),e._v(" "),s("p",[e._v("首先进入容器的命令行：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# docker exec -it nextcloud_web_1 /bin/sh\n")])])]),s("p",[e._v("然后用 vi 修改配置文件：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# vi config/config.php\n")])])]),s("p",[e._v("然后找到 "),s("code",[e._v("trust_domain")]),e._v(" 部分，我的在 30 行附近。")]),e._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[e._v("  "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[e._v("'trusted_domains'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("array")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[e._v("'example.com:8080'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n")])])]),s("p",[e._v("按 "),s("code",[e._v("i")]),e._v(" 进入编辑模式，然后添加自己的域名。")]),e._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[e._v("  "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[e._v("'trusted_domains'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("array")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[e._v("'example.com:8080'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[e._v("'cloud.example.com'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n")])])]),s("p",[e._v("然后按 "),s("code",[e._v("esc")]),e._v(" 退出编辑模式，再依次按 "),s("code",[e._v(":wq")]),e._v(" 后回车，保存并退出。再输入 "),s("code",[e._v("exit")]),e._v(" 退出 NextCloud 容器的命令行，刷新页面即可。")]),e._v(" "),s("h2",{attrs:{id:"安装基于-docker-的-seafile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装基于-docker-的-seafile"}},[e._v("#")]),e._v(" 安装基于 Docker 的 Seafile")]),e._v(" "),s("p",[e._v("这里我们基于 "),s("a",{attrs:{href:"https://github.com/HumanBrainProject/seafile-compose/",target:"_blank",rel:"noopener noreferrer"}},[e._v("HumanBrainProject/seafile-compose"),s("OutboundLink")],1),e._v(" 来配置 Seafile。")]),e._v(" "),s("p",[e._v("为什么要用 Docker 呢？这是为了系统的干净吧。不过坏处是，Docker 的 NextCloud 访问宿主机的文件就没那么容易了。当然，两种方法各有所长。")]),e._v(" "),s("p",[e._v("顺便一提，如果使用 Docker 的话，甚至可以在一台 Windows 电脑上部署了，就可以在自己的 Windows 电脑上搭建一个，然后用 "),s("code",[e._v("frp")]),e._v(" 等方式内网穿透到公网了（可参考"),s("a",{attrs:{href:"/Windows/use-remote-desktop-with-frp"}},[e._v("博客")]),e._v("）。")]),e._v(" "),s("p",[e._v("首先要安装 Docker 以及 Docker Compose，可参照"),s("a",{attrs:{href:"../docker"}},[e._v("这篇教程")]),e._v("。")]),e._v(" "),s("p",[e._v("然后我们下载前面提到的项目：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 如果还没有安装 git，记得安装")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone https://github.com/HumanBrainProject/seafile-compose\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" seafile-compose\n")])])]),s("p",[e._v("但是！这个模板直接使用貌似会在一个过程中卡住。在修改一个地方以后，我才能够正常的进行部署。")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("nano")]),e._v(" seafile_dev_docker/Dockerfile\n")])])]),s("p",[e._v("在这里，我们修改第三行起的 "),s("code",[e._v("RUN")]),e._v(" 语句，将其拆分为几个 "),s("code",[e._v("RUN")]),e._v(" 语句，顺便也替换了中科大的镜像源。")]),e._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" sed -i "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),e._v(" /etc/apt/sources.list "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    && apt update")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" apt-get install -qq -y --no-install-recommends "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      vim "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      htop "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      net-tools "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      psmisc "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      git "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      wget "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      curl "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      build-essential "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      python-dev "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      python-pip "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      python-setuptools "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      python-wheel "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      libmysqlclient-dev")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" apt-get clean")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" rm -rf /var/lib/apt/lists/*")]),e._v("\n")])])]),s("p",[e._v("所以完整的 "),s("code",[e._v("seafile_dev_docker/Dockerfile")]),e._v(" 应该如下：")]),e._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("FROM")]),e._v(" ubuntu:16.04")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" sed -i "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),e._v(" /etc/apt/sources.list "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    && apt update")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" apt-get install -qq -y --no-install-recommends "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      vim "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      htop "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      net-tools "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      psmisc "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      git "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      wget "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      curl "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      build-essential "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      python-dev "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      python-pip "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      python-setuptools "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      python-wheel "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n      libmysqlclient-dev")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" apt-get clean")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" rm -rf /var/lib/apt/lists/*")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("ENV")]),e._v(" DOCKERIZE_VERSION v0.6.1")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" wget https://github.com/jwilder/dockerize/releases/download/"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$DOCKERIZE_VERSION")]),e._v("/dockerize-linux-amd64-"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$DOCKERIZE_VERSION")]),e._v(".tar.gz "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    && tar -C /usr/local/bin -xzvf dockerize-linux-amd64-"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$DOCKERIZE_VERSION")]),e._v(".tar.gz "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    && rm dockerize-linux-amd64-"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$DOCKERIZE_VERSION")]),e._v(".tar.gz")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("ENV")]),e._v(" SEAFILE_VERSION=6.3.3 SEAFILE_SERVER=seafile-server")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" mkdir -p /opt/seafile/conf && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    mkdir -p /opt/seafile/data && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    mkdir -p /opt/seafile/pids && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    mkdir -p /opt/seafile/ccnet && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    mkdir -p /opt/seafile/sockets && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    mkdir -p /opt/seafile/logs && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    openssl genrsa -out /opt/seafile/ccnet/mykey.peer 4096 && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    touch /opt/seafile/logs/seafile.log && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    touch /opt/seafile/logs/ccnet.log && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    touch /opt/seafile/logs/seahub.log")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" mkdir -p /opt/seafile/ && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    curl -sSL -o - https://download.seadrive.org/seafile-server_"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SEAFILE_VERSION}")]),e._v("_x86-64.tar.gz "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    | tar xzf - -C /opt/seafile/ && "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n    ln -s /opt/seafile/seafile-server-"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SEAFILE_VERSION}")]),e._v(" /opt/seafile/seafile-server-latest")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("ENV")]),e._v(" LD_LIBRARY_PATH=/opt/seafile/seafile-server-latest/seafile/lib:/opt/seafile/seafile-server-latest/seafile/lib64:"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$LD_LIBRARY_PATH")])]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("ENV")]),e._v(" SEAFILE_DATA_DIR=/opt/seafile/data CCNET_CONF_DIR=/opt/seafile/ccnet SEAFILE_CENTRAL_CONF_DIR=/opt/seafile/conf SEAFILE_CONF_DIR=/opt/seafile/seafile-data")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("ENV")]),e._v(" PYTHONPATH=/opt/seafile/seafile-server-"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SEAFILE_VERSION}")]),e._v("/seafile/lib64/python2.7/site-packages:/opt/seafile/seafile-server-6.3.3/seahub:/opt/seafile/seafile-server-6.3.3/seahub/thirdpart:"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$PYTHONPATH")])]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COPY")]),e._v(" ./requirements.txt /tmp/requirements.txt")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("RUN")]),e._v(" pip install --no-cache-dir --disable-pip-version-check "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n                -r /tmp/requirements.txt "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("\\")]),e._v("\n                -r /opt/seafile/seafile-server-"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SEAFILE_VERSION}")]),e._v("/seahub/requirements.txt")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COPY")]),e._v(" config /opt/seafile/conf/")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COPY")]),e._v(" ccnet /opt/seafile/ccnet/")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("COPY")]),e._v(" scripts /opt/seafile")]),e._v("\n")])])]),s("p",[e._v("然后使用该项目提供的命令进行构建：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("docker-compose \\\n  -f docker-compose.yaml \\\n  up \\\n  --force-recreate \\\n  --renew-anon-volumes \\\n  --build\n")])])]),s("p",[e._v("整个过程比较慢，最后如果看到了 "),s("code",[e._v("seahub_1")]),e._v(" 开头的行，应该是配置完毕了。此时访问 "),s("code",[e._v("yourip:8000")]),e._v("，如果出现了 Seafile 登录页面，那么你就成功了 3/4 了。")]),e._v(" "),s("p",[e._v("接下来按 "),s("code",[e._v("Ctrl+C")]),e._v(" 停止，然后重新让他以后台形式运行：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("docker-compose up -d\n")])])]),s("p",[e._v("前面的 "),s("code",[e._v("docker-compose")]),e._v(" 命令只用于第一个构建 Docker，之后就用常规的 "),s("code",[e._v("docker-compose up -d")]),e._v(" 即可。运行完以后可以检查一下 "),s("code",[e._v("8000")]),e._v(" 端口是否正常。")]),e._v(" "),s("p",[e._v("剩下的 1/4 就是注册新账户了。这里 Seafile 不像 NextCloud 在第一次登陆时创建管理员账户，而是需要调用容器内的 Python 脚本。")]),e._v(" "),s("p",[e._v("在宿主机执行以下命令：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("docker-compose exec seahub python /opt/seafile/seafile-server-latest/seahub/manage.py createsuperuser\n")])])]),s("p",[e._v("如果正常，就会出现下面的情况：")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("$ docker-compose "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" seahub python /opt/seafile/seafile-server-latest/seahub/manage.py createsuperuser\n/opt/seafile/seafile-server-6.3.3/seahub/thirdpart/requests/__init__.py:80: RequestsDependencyWarning: urllib3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.19")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" or chardet "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3.0")]),e._v(".4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" doesn't match a supported version"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v("\n  RequestsDependencyWarning"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nE-mail address: lxl361429916@live.com\nPassword:\nPassword "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("again"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(":\nSuperuser created successfully.\n")])])]),s("p",[e._v("前面的 Warning 可以忽略。注册完账户以后，就可以在 "),s("code",[e._v("8000")]),e._v(" 端口登陆了。")]),e._v(" "),s("h3",{attrs:{id:"可能报错及解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可能报错及解决方案"}},[e._v("#")]),e._v(" 可能报错及解决方案")]),e._v(" "),s("h4",{attrs:{id:"第一次配置时卡住"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一次配置时卡住"}},[e._v("#")]),e._v(" 第一次配置时卡住")]),e._v(" "),s("p",[e._v("如果第一次配置的时候卡住，出现了下面的内容：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# docker-compose \\\n>   -f docker-compose.yaml \\\n>   up \\\n>   --force-recreate \\\n>   --renew-anon-volumes \\\n>   --build\nBuilding ccnet\nStep 1/15 : FROM ubuntu:16.04\n ---\x3e 77be327e4b63\nStep 2/15 : RUN apt update     && apt-get install -qq -y --no-install-recommends       vim       htop       net-tools       psmisc       git       wget       curl       build-essential       python-dev       python-pip       python-setuptools       python-wheel       libmysqlclient-dev     && apt-get clean     && rm -rf /var/lib/apt/lists/*\n ---\x3e Running in 379f2d9271b1\n\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\nGet:1 http://archive.ubuntu.com/ubuntu xenial InRelease [247 kB]\nGet:2 http://security.ubuntu.com/ubuntu xenial-security InRelease [109 kB]\nGet:3 http://archive.ubuntu.com/ubuntu xenial-updates InRelease [109 kB]\nGet:4 http://security.ubuntu.com/ubuntu xenial-security/main amd64 Packages [1063 kB]\nGet:5 http://archive.ubuntu.com/ubuntu xenial-backports InRelease [107 kB]\nGet:6 http://archive.ubuntu.com/ubuntu xenial/main amd64 Packages [1558 kB]\nGet:7 http://security.ubuntu.com/ubuntu xenial-security/restricted amd64 Packages [12.7 kB]\nGet:8 http://security.ubuntu.com/ubuntu xenial-security/universe amd64 Packages [620 kB]\nGet:9 http://security.ubuntu.com/ubuntu xenial-security/multiverse amd64 Packages [6280 B]\nGet:10 http://archive.ubuntu.com/ubuntu xenial/restricted amd64 Packages [14.1 kB]\nGet:11 http://archive.ubuntu.com/ubuntu xenial/universe amd64 Packages [9827 kB]\nGet:12 http://archive.ubuntu.com/ubuntu xenial/multiverse amd64 Packages [176 kB]\nGet:13 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 Packages [1432 kB]\nGet:14 http://archive.ubuntu.com/ubuntu xenial-updates/restricted amd64 Packages [13.1 kB]\nGet:15 http://archive.ubuntu.com/ubuntu xenial-updates/universe amd64 Packages [1021 kB]\nGet:16 http://archive.ubuntu.com/ubuntu xenial-updates/multiverse amd64 Packages [19.3 kB]\nGet:17 http://archive.ubuntu.com/ubuntu xenial-backports/main amd64 Packages [7942 B]\nGet:18 http://archive.ubuntu.com/ubuntu xenial-backports/universe amd64 Packages [8807 B]\nFetched 16.4 MB in 1min 46s (153 kB/s)\nReading package lists...\nBuilding dependency tree...\nReading state information...\nAll packages are up to date.\n")])])]),s("p",[e._v("可能是你没有修改 "),s("code",[e._v("Dockerfile")]),e._v("，请按照上面的方法修改 "),s("code",[e._v("Dockerfile")]),e._v("，然后重新 "),s("code",[e._v("docker-compose")])]),e._v(" "),s("h4",{attrs:{id:"设置密码时报错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置密码时报错"}},[e._v("#")]),e._v(" 设置密码时报错")]),e._v(" "),s("p",[e._v("如果设置密码时报错：")]),e._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[e._v("seahub"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("accounts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("DoesNotExist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" User matching query does "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("not")]),e._v(" exits"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\n")])])]),s("p",[e._v("可能是数据库的容器自己退出了。可以用 "),s("code",[e._v("docker ps --all")]),e._v("，然后看 "),s("code",[e._v("seafile-compose_db_1")]),e._v(" 的 "),s("code",[e._v("STATUS")]),e._v(" 是 "),s("code",[e._v("UP")]),e._v(" 还是 "),s("code",[e._v("EXIT")]),e._v("。")]),e._v(" "),s("p",[e._v("如果确实是 "),s("code",[e._v("EXIT")]),e._v(" 退出了，那么 "),s("code",[e._v("docker-compose up -d")]),e._v(" 即可重启。")])])}),[],!1,null,null,null);t.default=n.exports}}]);