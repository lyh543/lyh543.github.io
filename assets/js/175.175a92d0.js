(window.webpackJsonp=window.webpackJsonp||[]).push([[175],{589:function(t,s,a){"use strict";a.r(s);var e=a(3),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("下面记录 Nginx 在使用过程中遇到的“基本”操作。")]),t._v(" "),a("h2",{attrs:{id:"修改配置文件、测试重启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件、测试重启"}},[t._v("#")]),t._v(" 修改配置文件、测试重启")]),t._v(" "),a("p",[t._v("Nginx 首先检查的配置文件在 "),a("code",[t._v("/etc/nginx/nginx.conf")]),t._v("。在这个文件中如果有如下内容：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v(" /etc/nginx/conf.d/*.conf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("那么也会检查 "),a("code",[t._v("/etc/nginx/conf.d/")]),t._v(" 下的所有 "),a("code",[t._v("conf")]),t._v(" 文件。本着干净的原则，我们推荐在 "),a("code",[t._v("nginx.conf")]),t._v(" 加入 "),a("code",[t._v("include")]),t._v(" 语句，然后在 "),a("code",[t._v("conf.d")]),t._v(" 下按域名创建自己的 "),a("code",[t._v("conf")]),t._v(" 配置文件。")]),t._v(" "),a("p",[t._v("修改配置文件以后，Nginx 并不是即时读取配置的，需要使用 reload 命令才能加载配置。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("nginx -s reload\n")])])]),a("p",[t._v("也可以直接重启 Nginx 服务。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("systemctl restart nginx\n")])])]),a("p",[t._v("如果配置有错误，Nginx 就会启动失败，宕机。为了保证 Nginx 服务器能平稳运行，不宕机，我们推荐使用以下命令而不是尝试重启的形式检查错误：")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("nginx -t\n")])])]),a("h2",{attrs:{id:"给全站添加-ssl-证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#给全站添加-ssl-证书"}},[t._v("#")]),t._v(" 给全站添加 SSL 证书")]),t._v(" "),a("p",[t._v("请看"),a("RouterLink",{attrs:{to:"/_posts/build-https-sites-with-nginx/"}},[t._v("另一篇博客")]),t._v("。")],1),t._v(" "),a("h2",{attrs:{id:"网页转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网页转发"}},[t._v("#")]),t._v(" 网页转发")]),t._v(" "),a("h3",{attrs:{id:"隐性转发-反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#隐性转发-反向代理"}},[t._v("#")]),t._v(" 隐性转发/反向代理")]),t._v(" "),a("p",[t._v("这里的情形是：用户访问 "),a("code",[t._v("https://cloud.example.com")]),t._v(" 时，服务器将其跳转到 "),a("code",[t._v("127.0.0.1:8080")]),t._v("，地址栏仍然显示 "),a("code",[t._v("https://cloud.example.com")]),t._v("。")]),t._v(" "),a("p",[t._v("首先要将域名 "),a("code",[t._v("cloud.example.com")]),t._v(" 以 "),a("code",[t._v("A")]),t._v(" 的形式指向你的服务器 ip（也就是 "),a("code",[t._v("example.com")]),t._v(" 的服务器）。")]),t._v(" "),a("p",[t._v("然后在服务器上新建文件 "),a("code",[t._v("\\etc\\nginx\\conf.d\\cloud.example.com")]),t._v("（习惯用网站命名配置文件），然后加入以下内容：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl http2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" cloud.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://127.0.0.1:8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",[a("li",[t._v("这里默认你已经配置好了 "),a("code",[t._v("https")]),t._v(" 以及 "),a("code",[t._v("http")]),t._v(" 转发到 "),a("code",[t._v("https")]),t._v(" 的操作。如果不想使用 https，将第二行修改为 "),a("code",[t._v("listen 80;")]),t._v(" 即可。配置 https 请看"),a("RouterLink",{attrs:{to:"/_posts/build-https-sites-with-nginx/"}},[t._v("另一篇博客")]),t._v("。")],1),t._v(" "),a("li",[t._v("第三行的 "),a("code",[t._v("server_name")]),t._v(" 不限形式，可以使用通配符、正则表达式，还可以使用 "),a("code",[t._v(".example.com")]),t._v(" 的形式匹配 "),a("code",[t._v("example.com")]),t._v(" 及其所有子域名。更多细节可以看 "),a("a",{attrs:{href:"(http://nginx.org/en/docs/http/server_names.html)"}},[t._v("server_name 的官方文档")])]),t._v(" "),a("li"),t._v(" "),a("li",[t._v("也可以转发到别的网址，但是貌似不能转发到 "),a("code",[t._v("https")]),t._v("，并且有些网站可能限制转发。")])]),t._v(" "),a("h3",{attrs:{id:"显性转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显性转发"}},[t._v("#")]),t._v(" 显性转发")]),t._v(" "),a("p",[t._v("这里的情形是：用户访问 "),a("code",[t._v("https://cloud.example.com")]),t._v(" 时，服务器服务器将其跳转到 "),a("code",[t._v("https://baidu.com/")]),t._v("，地址栏显示 "),a("code",[t._v("https://baidu.com/")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl http2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" cloud.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://baidu.com/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这种方法也可以转发到别的网址，无限制。（顺便一说，这也可以在对应网页放一个 html 转发实现，可以不借助 nginx）")]),t._v(" "),a("h4",{attrs:{id:"识别路径和参数并转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#识别路径和参数并转发"}},[t._v("#")]),t._v(" 识别路径和参数并转发")]),t._v(" "),a("p",[t._v("这里我们讨论更复杂的显性转发情况。方便起见，用表格进行说明：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("用户输入的网址")]),t._v(" "),a("th",[t._v("转发后的网址")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("https://www.lyh543.cn/")])]),t._v(" "),a("td",[a("code",[t._v("https://blog.lyh543.cn/")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("https://www.lyh543.cn/git")])]),t._v(" "),a("td",[a("code",[t._v("https://blog.lyh543.cn/Linux/Git/")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("https://www.lyh543.cn/linux")])]),t._v(" "),a("td",[a("code",[t._v("https://blog.lyh543.cn/Linux/linux-daily-command/")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("https://www.lyh543.cn/<其他参数>")])]),t._v(" "),a("td",[a("code",[t._v("https://blog.lyh543.cn/<其他参数>")])])])])]),t._v(" "),a("p",[t._v("我使用的配置文件如下：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl http2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" www.lyh543.cn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" = /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://blog.lyh543.cn/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" = /git")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://blog.lyh543.cn/Linux/Git/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" = /linux")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://blog.lyh543.cn/Linux/linux-daily-command/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://blog.lyh543.cn"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("注意到最后的 "),a("code",[t._v("$request_uri")]),t._v(" 是个很好用的东西。除此之外，我们可以把任意一个 "),a("code",[t._v("url")]),t._v(" 拆分为 "),a("code",[t._v("$scheme://$host$request_uri")]),t._v("。")]),t._v(" "),a("p",[t._v("具体地，对于访问链接 "),a("code",[t._v("https://blog.lyh543.cn/nginx/")]),t._v("，我们有：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名")]),t._v(" "),a("th",[t._v("实际意义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("$scheme")])]),t._v(" "),a("td",[a("code",[t._v("https")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("$host")])]),t._v(" "),a("td",[a("code",[t._v("blog.lyh543.cn")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("$request_uri")])]),t._v(" "),a("td",[a("code",[t._v("/nginx/")])])])])]),t._v(" "),a("p",[t._v("按这种方法，很容易写出 "),a("code",[t._v("http")]),t._v(" 强制跳 "),a("code",[t._v("https")]),t._v(" 的配置文件：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" default_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       [::]:80 default_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  _")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"显示某路径下-index-html"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显示某路径下-index-html"}},[t._v("#")]),t._v(" 显示某路径下 index.html")]),t._v(" "),a("p",[t._v("这里的情形是：用户访问 "),a("code",[t._v("https://example.com/")]),t._v(" 时，服务器显示 "),a("code",[t._v("/path/to/index.html")]),t._v(" 的内容。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl http2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /path/to")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);