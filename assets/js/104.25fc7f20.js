(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{495:function(s,e,t){"use strict";t.r(e);var a=t(3),n=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"修改-ssh-端口的前因后果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改-ssh-端口的前因后果"}},[s._v("#")]),s._v(" 修改 ssh 端口的前因后果")]),s._v(" "),e("p",[s._v("今天用安卓手机 ssh 连接我的服务器的时候，出现了 "),e("code",[s._v("kex_exchange_identification")]),s._v("。又要修 bug 了。")]),s._v(" "),e("p",[s._v("百度了一下，按照 "),e("a",{attrs:{href:"https://www.cnblogs.com/starof/p/4709805.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ssh连接失败，排错经验"),e("OutboundLink")],1),s._v(" 的步骤做了一下，发现 ssh 有时连得上，有时连不上。迷惑行为。")]),s._v(" "),e("p",[s._v("按照他的方法，关闭 ssh 服务，并开始 ssh 的调试模式：")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" sshd stop\n/usr/sbin/sshd -d\n")])])]),e("p",[s._v("打开以后，貌似一切正常。")]),s._v(" "),e("p",[s._v("几秒以后，发现 ssh 显示了很多，然后就直接退出了？？？")]),s._v(" "),e("p",[s._v("粗略看了一下，有一个未知 ip （最后查出来是法国的）在尝试 ssh 连接我的服务器。大概是来搞我的。")]),s._v(" "),e("p",[s._v("于是我就把他放进 ssh 的黑名单了。")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" x.x.x.x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts.allow\n")])])]),e("p",[s._v("重新开启调试模式，发现几秒以后他又关掉了。")]),s._v(" "),e("p",[s._v("这次是江苏的。")]),s._v(" "),e("p",[s._v("重复了一次，发现又有一个北京的。")]),s._v(" "),e("p",[s._v("？？？？")]),s._v(" "),e("p",[s._v("大家都来搞我？？？")]),s._v(" "),e("p",[s._v("ssh 没有仅允许白名单访问的方法，那咋办嘛。")]),s._v(" "),e("p",[s._v("后来突然想到，"),e("strong",[s._v("不应该用默认端口的")]),s._v("，否则他发现端口可用就可以暴力破解了！")]),s._v(" "),e("p",[s._v("于是下面才是正题：如何更改 ssh 的端口。")]),s._v(" "),e("h2",{attrs:{id:"修改方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改方法"}},[s._v("#")]),s._v(" 修改方法")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi /etc/ssh/sshd_config\n")])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# The strategy used for options in the default sshd_config shipped with\n# OpenSSH is to specify options with their default value where\n# possible, but leave them commented.  Uncommented options override the\n# default value.\n\n#Port 22\n#AddressFamily any\n#ListenAddress 0.0.0.0\n#ListenAddress ::\n\n#HostKey /etc/ssh/ssh_host_rsa_key\n#HostKey /etc/ssh/ssh_host_ecdsa_key\n#HostKey /etc/ssh/ssh_host_ed25519_key\n")])])]),e("p",[s._v("现在的端口 "),e("code",[s._v("Port")]),s._v(" 是默认的 22，我们要修改，先要把 "),e("code",[s._v("Port")]),s._v(" 前注释的 "),e("code",[s._v("#")]),s._v(" 去掉，然后把 22 改为自己想要的数字（0-65535 都可，只要不跟自己其他的端口重合）。")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Port 2333\n#AddressFamily any\n")])])]),e("p",[s._v("然后再开调试模式，发现一切都和平了。")]),s._v(" "),e("p",[s._v("以后要 "),e("code",[s._v("ssh")]),s._v(" 远程的时候，就要带一个端口参数了。对于 "),e("code",[s._v("39.1.2.3")]),s._v(" 的服务器的 2333 端口，应该使用")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ssh -p2333 root@39.1.2.3\n")])])]),e("p",[s._v("即可。")])])}),[],!1,null,null,null);e.default=n.exports}}]);