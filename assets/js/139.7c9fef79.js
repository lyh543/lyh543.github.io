(window.webpackJsonp=window.webpackJsonp||[]).push([[139],{493:function(s,_,v){"use strict";v.r(_);var e=v(3),o=Object(e.a)({},(function(){var s=this,_=s.$createElement,v=s._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[v("p",[s._v("和 Linux 一样，Windows 10 （我为 Win 10 1909）上也可以使用 ssh 客户端和服务器。对 Windows 进行 ssh 的效果就是 "),v("code",[s._v("cmd")]),s._v("，当然你也可以在里面输入 "),v("code",[s._v("powershell")]),s._v(" 或 "),v("code",[s._v("wsl")]),s._v(" 使用其他的命令行。")]),s._v(" "),v("p",[v("s",[s._v("这就是这篇文章归类于 Linux 的原因吗")])]),s._v(" "),v("h2",{attrs:{id:"windows-安装-ssh-客户端"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#windows-安装-ssh-客户端"}},[s._v("#")]),s._v(" Windows 安装 ssh 客户端")]),s._v(" "),v("p",[s._v("其实可以直接使用 wsl 的 ssh 客户端的。")]),s._v(" "),v("p",[s._v("但是既然 Windows 提供了这个功能，那就还是提一笔。")]),s._v(" "),v("p",[s._v("在 "),v("code",[s._v("Windows 设置")]),s._v("(按 "),v("code",[s._v("Windows徽标键+I")]),s._v(") 直接搜索 "),v("code",[s._v("添加可选功能")]),s._v(" 并进入。 添加功能，找到 "),v("code",[s._v("OpenSSH 客户端")]),s._v(" 并安装。")]),s._v(" "),v("p",[s._v("安装好以后就可以使用 "),v("code",[s._v("ssh")]),s._v(" "),v("code",[s._v("ssh-keygen")]),s._v(" "),v("code",[s._v("ssh-agent")]),s._v(" "),v("code",[s._v("ssh-add")]),s._v(" "),v("code",[s._v("scp")]),s._v(" 等功能了。")]),s._v(" "),v("h2",{attrs:{id:"windows-安装并配置-ssh-服务器"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#windows-安装并配置-ssh-服务器"}},[s._v("#")]),s._v(" Windows 安装并配置 ssh 服务器")]),s._v(" "),v("p",[s._v("同样是在上面的 "),v("code",[s._v("添加可选功能")]),s._v(" 找到 "),v("code",[s._v("OpenSSH 服务器")]),s._v(" 并安装。")]),s._v(" "),v("p",[s._v("以管理员权限的 Powershell 执行 "),v("code",[s._v("net start sshd")]),s._v(" 即可。")]),s._v(" "),v("p",[s._v("本地测试：在 cmd 执行 "),v("code",[s._v("ssh 微软账户@127.0.0.1")]),s._v("(我的是 "),v("code",[s._v("ssh lxl361429916@live.com@127.0.0.1")]),s._v("，虽然两个 "),v("code",[s._v("@")]),s._v(" 确实有点蠢)，密码是微软账户的密码。"),v("br"),s._v("\n被问及是否要信任的时候选 "),v("code",[s._v("yes")]),s._v("。")]),s._v(" "),v("p",[s._v("如果需要外网链接该服务器，需要有一个公网 ip 或进行内网穿透，可参考 "),v("RouterLink",{attrs:{to:"/notes/microsoft/windows/use-remote-desktop-with-frp.html"}},[s._v("利用内网穿透进行远程桌面访问")]),s._v("。这里就不多说了。")],1),s._v(" "),v("h3",{attrs:{id:"windows-设置-ssh-公钥"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#windows-设置-ssh-公钥"}},[s._v("#")]),s._v(" Windows 设置 ssh 公钥")]),s._v(" "),v("p",[s._v("这个地方倒挺麻烦，如果直接使用 Linux 向 Linux 加入公钥的方式 "),v("code",[s._v("ssh-copy-id")]),s._v("，在 Windows 服务器上是行不通的，会显示没有 "),v("code",[s._v("cat")]),s._v(" 等命令。")]),s._v(" "),v("p",[s._v("直接把客户端的公钥复制到服务器的 "),v("code",[s._v("%USERPROFILE%\\.ssh\\authorized_keys")]),s._v(" 也不能使用。因为权限不对。")]),s._v(" "),v("blockquote",[v("p",[s._v("参考链接："),v("a",{attrs:{href:"https://stackoverflow.com/a/50502015",target:"_blank",rel:"noopener noreferrer"}},[s._v("Setting up OpenSSH for Windows using public key authentication - Stack Overflow"),v("OutboundLink")],1)])]),s._v(" "),v("ol",[v("li",[s._v("首先通过 "),v("RouterLink",{attrs:{to:"/notes/linux/download-file-on-server.html#scp-命令通过-ssh-在服务器和本地互传文件"}},[s._v("scp")]),s._v(" 或其他方式（随便瞎搞，鼠标复制粘贴都行），把客户端的公钥复制到服务器的 "),v("code",[s._v("%USERPROFILE%\\.ssh\\authorized_keys")]),s._v("。")],1),s._v(" "),v("li",[s._v("用文件资源管理器打开 "),v("code",[s._v("%USERPROFILE%\\.ssh\\")]),s._v("。")]),s._v(" "),v("li",[s._v("右键单击 "),v("code",[s._v("authorized_keys")]),s._v("，打开 "),v("code",[s._v("属性 - 安全 -高级")]),s._v("。")]),s._v(" "),v("li",[s._v("点击 "),v("code",[s._v("禁用继承")]),s._v("，并选择 "),v("code",[s._v("将已继承的权限转换为此对象的显式权限")]),s._v("。")]),s._v(" "),v("li",[s._v("最重要的一步，是删除除了 "),v("code",[s._v("SYSTEM")]),s._v(" 和当前账户以外的所有账户的权限（也就是说，最后只能剩这两个账户，"),v("code",[s._v("Administrators")]),s._v(" 什么的都得删）。回答中专门提到，某些使用 "),v("code",[s._v("Repair-AuthorizedKeyPermission $env:USERPROFILE\\.ssh\\authorized_keys")]),s._v(" 的方法会导致增加 "),v("code",[s._v("sshd")]),s._v(" 的权限，最后导致失败，所有不建议这么做。")]),s._v(" "),v("li",[s._v("如果 Windows 版本在 "),v("code",[s._v("1809")]),s._v(" 及以后，还要打开 "),v("code",[s._v("C:\\ProgramData\\ssh\\sshd_config")]),s._v(" 并注释掉以下两行：")])]),s._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[s._v("# Match Group administrators                                                    \n#       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys  \n")])])]),v("p",[s._v("最后以管理员权限重启 "),v("code",[s._v("sshd")]),s._v("：")]),s._v(" "),v("div",{staticClass:"language-batch extra-class"},[v("pre",{pre:!0,attrs:{class:"language-batch"}},[v("code",[v("span",{pre:!0,attrs:{class:"token command"}},[v("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("net")]),s._v(" stop sshd")]),s._v("\n"),v("span",{pre:!0,attrs:{class:"token command"}},[v("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("net")]),s._v(" start sshd")]),s._v("\n")])])]),v("p",[s._v("即可。")]),s._v(" "),v("h2",{attrs:{id:"配置文件目录"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#配置文件目录"}},[s._v("#")]),s._v(" 配置文件目录")]),s._v(" "),v("ul",[v("li",[v("code",[s._v("%USERPROFILE%/.ssh/")]),s._v(" 对应 "),v("code",[s._v("~/.ssh/")])]),s._v(" "),v("li",[v("code",[s._v("%PROGRAMDATA%/ssh/")]),s._v(" 对应 "),v("code",[s._v("/etc/ssh/")])])])])}),[],!1,null,null,null);_.default=o.exports}}]);