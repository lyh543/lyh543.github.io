(window.webpackJsonp=window.webpackJsonp||[]).push([[224],{571:function(e,t,s){"use strict";s.r(t);var a=s(3),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("和其他操作系统一样，Windows 的端口占用问题是老生常谈的话题了。不过，由于 Hyper-V 技术的出现，端口占用的原因也不只一种，导致原来的方法可能不奏效。因此记录一下 Windows 端口占用的两种情况以及对应的解决方法。")]),e._v(" "),s("h2",{attrs:{id:"查询是否被其他应用占用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询是否被其他应用占用"}},[e._v("#")]),e._v(" 查询是否被其他应用占用")]),e._v(" "),s("p",[e._v("在管理员下的 powershell（2202 年了，也该学一下 powershell 了）：")]),e._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 管理员不是必需，但不用管理员可能看不到其他用户的进程？")]),e._v("\nnetstat "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("ano "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Select-String")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"8080"')]),e._v("\n")])])]),s("p",[s("img",{attrs:{src:"/images/923159eedbc4e88c0b0ea00f3dff42e8fc276a44deff0e34eb31c65763757614.png",alt:"查询结果"}})]),e._v(" "),s("p",[e._v("11284 是 Process ID，可以直接 kill 掉，也可以看看是什么。")]),e._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ps")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("PID 11284\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("kill")]),e._v(" 11284\n")])])]),s("p",[s("img",{attrs:{src:"/images/270900e581c26de91ceb751eb13786d759ed1f074b1880dad7a25b8817c49607.png",alt:"查询结果"}})]),e._v(" "),s("h2",{attrs:{id:"查询是否被-hyper-v-占用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询是否被-hyper-v-占用"}},[e._v("#")]),e._v(" 查询是否被 Hyper-V 占用")]),e._v(" "),s("p",[e._v("以前的 Windows 在上面一步基本就能结束了，但现在是 2202 年，Docker 和 WSL 2 大行其道，干开发的应该都用着 Hyper-V。而 Hyper-V 会保留一些端口，其他应用就不能占用了。")]),e._v(" "),s("p",[e._v("使用下面这行命令查询 Hyper-V 占用的端口：")]),e._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[e._v("netsh interface ipv4 show excludedportrange protocol=tcp\n")])])]),s("p",[s("img",{attrs:{src:"/images/c78255c7d83cf302f4b3e12423dfd909c9905273faab77fb0cebf59c5f4435a6.png",alt:"查询 Hyper-V 占用的端口"}})]),e._v(" "),s("p",[e._v("图上没有 "),s("code",[e._v("*")]),e._v(" 的就是 Hyper-V 分配并占用的端口。而加了 "),s("code",[e._v("*")]),e._v(" 的 "),s("code",[e._v("Administered port exclusions")]),e._v(" 就是我们保留的端口， Hyper-V 不会再占用。")]),e._v(" "),s("h3",{attrs:{id:"方法一-改变-hyper-v-的分配范围"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法一-改变-hyper-v-的分配范围"}},[e._v("#")]),e._v(" 方法一：改变 Hyper-V 的分配范围")]),e._v(" "),s("p",[e._v("使用下面这行命令可以查询 Hyper-V 的分配范围：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("netsh int ipv4 show dynamicport tcp\n")])])]),s("p",[e._v("我们将分配范围改为 40000-49999（共 10000 个端口）：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("netsh int ipv4 set dynamicport tcp start=40000 num=10000\n")])])]),s("p",[e._v("然后重启即可。重启以后 Hyper-V 即可从 40000 开始占用。")]),e._v(" "),s("p",[s("img",{attrs:{src:"/images/3a1d0b12735632e26dd11ac27d91019b1d80a448b1b1d7623ce4aaae376df7eb.png",alt:"Hyper-V 从 40000 开始占用端口"}})]),e._v(" "),s("p",[e._v("Windows 限制至少分配 255 个端口，我们当然可以限制它在 255 个端口范围内分配：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("netsh int ipv4 set dynamicport tcp start=40000 num=255\n")])])]),s("p",[e._v("重启后效果如下：")]),e._v(" "),s("p",[s("img",{attrs:{src:"/images/8bfd065d171b4ee8f0800c23579c7103f3ea42b01117ca619c4b125254ca7af8.png",alt:"只给 Hyper-V 255 个端口范围"}})]),e._v(" "),s("h3",{attrs:{id:"方法二-保留某些端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法二-保留某些端口"}},[e._v("#")]),e._v(" 方法二：保留某些端口")]),e._v(" "),s("p",[e._v("如何在已有的分配范围下，保留部分端口呢？在管理员下的 powershell 使用下面这行命令：")]),e._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 保留 7962 开始的 100 个端口（即 7962-8061）")]),e._v("\nnetsh int ipv4 add excludedportrange protocol=tcp startport=7962 numberofports=100\n")])])]),s("p",[s("img",{attrs:{src:"/images/2a17482e2c835c9e3ef8fde3db60c6476f3f10a9dcc75ca76f3e23efe4cb7f3a.png",alt:"7962-8061 已为我们保留"}})]),e._v(" "),s("p",[e._v("如果执行的时候遇到 "),s("code",[e._v("netsh error: The process cannot access the file because it is being used by another process")]),e._v("，可以尝试重启电脑。如果重启也不行，可以试试关掉 Hyper-V、重启、保留完端口再打开 Hyper-V、重启。")]),e._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 关掉 Hyper-V")]),e._v("\ndism"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("Online "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Disable-Feature")]),e._v(":Microsoft"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Hyper"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("V\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 开启 Hyper-V")]),e._v("\ndism"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("Online "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Enable-Feature")]),e._v(":Microsoft"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Hyper"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("V "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("All\n")])])]),s("p",[e._v("Reference:")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://blog.csdn.net/m0_47696151/article/details/117785566",target:"_blank",rel:"noopener noreferrer"}},[e._v("Windows 下显示端口占用，却查不到占用进程_m0_47696151的博客-CSDN博客"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/troubleshoot/windows-server/networking/default-dynamic-port-range-tcpip-chang",target:"_blank",rel:"noopener noreferrer"}},[e._v("TCP/IP 的默认动态端口范围在 Windows 和 Windows Server 2008 中已更改 - Windows Server | Microsoft Docs"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://stackoverflow.com/questions/58216537/what-is-administered-port-exclusions-in-windows-10",target:"_blank",rel:"noopener noreferrer"}},[e._v("What is Administered port exclusions in windows 10? - Stack Overflow"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);