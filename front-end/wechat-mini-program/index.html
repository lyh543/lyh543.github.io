<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>微信小程序开发入门 | 小灰灰灰灰的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="编程语言入门,前端,JavaScript,微信小程序">
    <meta name="description" content="你真的需要微信小程序吗？首先，在入坑微信小程序之前，你需要想清楚这个问题。 微信小程序的优点有：  只需要写前端（Web App 一般需要前、后端），开发周期短 跨 Android&#x2F;iOS 平台 有成熟的 WeUI 框架和控件可以使用，并且微信原生 API 非常多，官方文档为中文且很详尽 能够轻松做到 Serverless 云开发 云服务的各项服务都有免费额度，流量不大的开发者能够白嫖  为数不多">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序开发入门">
<meta property="og:url" content="https://blog.lyh543.cn/front-end/wechat-mini-program/index.html">
<meta property="og:site_name" content="小灰灰灰灰的博客">
<meta property="og:description" content="你真的需要微信小程序吗？首先，在入坑微信小程序之前，你需要想清楚这个问题。 微信小程序的优点有：  只需要写前端（Web App 一般需要前、后端），开发周期短 跨 Android&#x2F;iOS 平台 有成熟的 WeUI 框架和控件可以使用，并且微信原生 API 非常多，官方文档为中文且很详尽 能够轻松做到 Serverless 云开发 云服务的各项服务都有免费额度，流量不大的开发者能够白嫖  为数不多">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.lyh543.cn/images/6b98d05172ac7657ced502f1975d1caeb2a4740a5d5a44444e9780d6bd972271.gif">
<meta property="og:image" content="https://blog.lyh543.cn/images/82bf41eba1cc364c239261d749a57afcaea6cab33cc129d6af6477814fa1482b.png">
<meta property="og:image" content="https://blog.lyh543.cn/images/23ff30264c519ae9fa9c88dece167473e9705c7c7251c73df9474c0f66caa452.png">
<meta property="og:image" content="https://blog.lyh543.cn/images/28db320ceb422490421adc8c9f218d45886343101c10e6294586600501d3f8b2.png">
<meta property="og:image" content="https://blog.lyh543.cn/images/c0b9be7df1f223cf25b7944cf943f407c9f70edaa969b0ae0cf25e23fbef3930.png">
<meta property="og:image" content="https://blog.lyh543.cn/images/a36cc6ef15b86f52a508be3dbd1b65b30a39d9feae8e194689373ded3f2cc154.png">
<meta property="og:image" content="https://blog.lyh543.cn/images/af0f751daa069a5078ca7cb270656bc1a5087ae5b89d2193051bc3eea30cc81a.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/2395166/29502325-ada080f6-8661-11e7-94c2-23d638210f45.jpg">
<meta property="og:image" content="https://blog.lyh543.cn/images/8c92e5b1e7b8cc392d97dff036e5894510ec5831ebc626aa70d3fa1104ef3c89.png">
<meta property="og:image" content="https://blog.lyh543.cn/images/a6baff90b04301112e4473b20bd22b98fcab1a6e467d48ebed951771d4fbf682.png">
<meta property="og:image" content="https://blog.lyh543.cn/images/dbcca983410a5ad593749f1ce3f716c85390b9213a8e17ae6c9dcbcb53a99c39.png">
<meta property="og:image" content="https://blog.lyh543.cn/images/b68bf978e78749e58d4fad0bcba3a98c5da2e3d39f546fe8d9298d00ccb9978c.png">
<meta property="article:published_time" content="2020-07-22T14:04:25.000Z">
<meta property="article:modified_time" content="2021-09-11T12:19:35.107Z">
<meta property="article:author" content="lyh543">
<meta property="article:tag" content="编程语言入门">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="微信小程序">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.lyh543.cn/images/6b98d05172ac7657ced502f1975d1caeb2a4740a5d5a44444e9780d6bd972271.gif">
    
        <link rel="alternate" type="application/atom+xml" title="小灰灰灰灰的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="mdi mdi-close icon-lg"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">lyh543</h5>
          <a href="mailto:lyh543@outlook.com" title="lyh543@outlook.com" class="mail">lyh543@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg mdi mdi-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg mdi mdi-archive"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg mdi mdi-tag-multiple"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg mdi mdi-format-list-bulleted-square"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/lyh543" target="_blank" >
                <i class="icon icon-lg mdi mdi-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg mdi mdi-menu"></i>
        </a>
        <div class="flex-col header-title ellipsis">微信小程序开发入门</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg mdi mdi-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg mdi mdi-magnify"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg mdi mdi-share-variant"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">微信小程序开发入门</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-07-22T14:04:25.000Z" itemprop="datePublished" class="page-time">
  2020-07-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序</a></li></ul></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#你真的需要微信小程序吗？"><span class="post-toc-text">你真的需要微信小程序吗？</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#常用文档链接"><span class="post-toc-text">常用文档链接</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#文件结构和页面组成"><span class="post-toc-text">文件结构和页面组成</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件结构"><span class="post-toc-text">文件结构</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#页面组成"><span class="post-toc-text">页面组成</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#app-json"><span class="post-toc-text">app.json</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#json-基本语法"><span class="post-toc-text">json 基本语法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#app-json-配置"><span class="post-toc-text">app.json 配置</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#wxml-和-wxss"><span class="post-toc-text">wxml 和 wxss</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#wxml"><span class="post-toc-text">wxml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#wxml-模板"><span class="post-toc-text">wxml 模板</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#wxss"><span class="post-toc-text">wxss</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#链接和图片"><span class="post-toc-text">链接和图片</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#链接-navigator"><span class="post-toc-text">链接 navigator</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#图片-image"><span class="post-toc-text">图片 image</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#插入图片"><span class="post-toc-text">插入图片</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#显示模式"><span class="post-toc-text">显示模式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#圆角和阴影"><span class="post-toc-text">圆角和阴影</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#圆形图片"><span class="post-toc-text">圆形图片</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#背景"><span class="post-toc-text">背景</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#卡片风格示例"><span class="post-toc-text">卡片风格示例</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#WeUI-框架"><span class="post-toc-text">WeUI 框架</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#体验-WeUI-小程序"><span class="post-toc-text">体验 WeUI 小程序</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用-WeUI"><span class="post-toc-text">使用 WeUI</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Flex-布局-1"><span class="post-toc-text">Flex 布局(1)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Flex-布局-2"><span class="post-toc-text">Flex 布局(2)</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#JavaScript-数据绑定"><span class="post-toc-text">JavaScript 数据绑定</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#列表渲染和条件渲染"><span class="post-toc-text">列表渲染和条件渲染</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#获取表单内容"><span class="post-toc-text">获取表单内容</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#更多组件：轮播、音频、视频、cover、地图"><span class="post-toc-text">更多组件：轮播、音频、视频、cover、地图</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#JavaScript-微信-API"><span class="post-toc-text">JavaScript 微信 API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取信息"><span class="post-toc-text">获取信息</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#登录"><span class="post-toc-text">登录</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#获取网络状态"><span class="post-toc-text">获取网络状态</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#获取用户信息"><span class="post-toc-text">获取用户信息</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#获取设备信息"><span class="post-toc-text">获取设备信息</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#获取场景值"><span class="post-toc-text">获取场景值</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置当前页面"><span class="post-toc-text">设置当前页面</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#设置页面标题"><span class="post-toc-text">设置页面标题</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#下拉操作"><span class="post-toc-text">下拉操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#图片、缓存和文件"><span class="post-toc-text">图片、缓存和文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#点击事件"><span class="post-toc-text">点击事件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#点击按钮触发页面滚动"><span class="post-toc-text">点击按钮触发页面滚动</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#消息提示框-Toast"><span class="post-toc-text">消息提示框 Toast</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#模态对话框"><span class="post-toc-text">模态对话框</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#手机震动"><span class="post-toc-text">手机震动</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Navigator-组件和页面路由-API"><span class="post-toc-text">Navigator 组件和页面路由 API</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#事件对象"><span class="post-toc-text">事件对象</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#变量传递"><span class="post-toc-text">变量传递</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在链接中携带数据"><span class="post-toc-text">在链接中携带数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#跨页面数据渲染"><span class="post-toc-text">跨页面数据渲染</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#小程序和页面的生命周期"><span class="post-toc-text">小程序和页面的生命周期</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#globalData"><span class="post-toc-text">globalData</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#网络-API"><span class="post-toc-text">网络 API</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#云函数"><span class="post-toc-text">云函数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#wx-cloud"><span class="post-toc-text">wx.cloud</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#开通云开发服务"><span class="post-toc-text">开通云开发服务</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#指定小程序的-ID"><span class="post-toc-text">指定小程序的 ID</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写云函数"><span class="post-toc-text">编写云函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#部署云函数"><span class="post-toc-text">部署云函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写调用云函数的方法"><span class="post-toc-text">编写调用云函数的方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#进阶调试"><span class="post-toc-text">进阶调试</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#云服务选取"><span class="post-toc-text">云服务选取</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#云数据库"><span class="post-toc-text">云数据库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#新增记录"><span class="post-toc-text">新增记录</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查询记录"><span class="post-toc-text">查询记录</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#更新记录"><span class="post-toc-text">更新记录</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除记录"><span class="post-toc-text">删除记录</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-front-end/wechat-mini-program"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">微信小程序开发入门</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-07-22 22:04:25" datetime="2020-07-22T14:04:25.000Z"  itemprop="datePublished">2020-07-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序</a></li></ul></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="你真的需要微信小程序吗？"><a href="#你真的需要微信小程序吗？" class="headerlink" title="你真的需要微信小程序吗？"></a>你真的需要微信小程序吗？</h2><p>首先，在入坑微信小程序之前，你需要想清楚这个问题。</p>
<p>微信小程序的优点有：</p>
<ul>
<li>只需要写前端（Web App 一般需要前、后端），开发周期短</li>
<li>跨 Android/iOS 平台</li>
<li>有成熟的 WeUI 框架和控件可以使用，并且微信原生 API 非常多，官方文档为中文且很详尽</li>
<li>能够轻松做到 Serverless 云开发</li>
<li>云服务的各项服务都有免费额度，流量不大的开发者能够白嫖</li>
</ul>
<p>为数不多但非常致命的缺点是：</p>
<ul>
<li>需要严格审核，甚至于某些功能（如任意用户均可上传的留言板/公开相册/云盘等）无法上架小程序</li>
<li>微信小程序 API 随时可能变化，而小程序必须使用最新的 API（而不像 <code>Pypi</code>、<code>npm</code> 等可以使用指定版本的插件），可能导致原来的程序完全无法工作。如 <code>wx.getUserInfo()</code> 函数改版后，在用户未授权过的情况下调用此接口，将不再出现授权弹窗，会直接进入 <code>fail</code> 回调（详见<a href="https://developers.weixin.qq.com/community/develop/doc/0000a26e1aca6012e896a517556c01" target="_blank" rel="noopener">《公告》</a>)。</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/6b98d05172ac7657ced502f1975d1caeb2a4740a5d5a44444e9780d6bd972271.gif" alt="如图" title="">
                </div>
                <div class="image-caption">如图</div>
            </figure>


<h2 id="常用文档链接"><a href="#常用文档链接" class="headerlink" title="常用文档链接"></a>常用文档链接</h2><ul>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/import.html" target="_blank" rel="noopener">WXML 文档</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html" target="_blank" rel="noopener">WXSS 文档</a></li>
<li><a href="https://www.w3school.com.cn/cssref/index.asp" target="_blank" rel="noopener">CSS 参考手册</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/api.html#API" target="_blank" rel="noopener">JavaScript 微信 API 文档</a></li>
<li><a href="https://github.com/Tencent/weui-wxss" target="_blank" rel="noopener">WeUI 框架代码</a></li>
<li><a href="https://github.com/weui/weui-icon" target="_blank" rel="noopener">WeUI 图标</a></li>
<li><a href="https://cloudbase.net/community/guides/handbook/tcb01.html" target="_blank" rel="noopener">非常详细的官方入门教程</a></li>
</ul>
<p>因为太详尽了，因此本博文很多部分都是直接复制教程。</p>
<h2 id="文件结构和页面组成"><a href="#文件结构和页面组成" class="headerlink" title="文件结构和页面组成"></a>文件结构和页面组成</h2><h3 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h3><p>在开发者工具的编辑器里可以看到小程序源文件的根目录下有 <code>app.js</code>、<code>app.json</code> 和 <code>app.wxss</code></p>
<ul>
<li><code>app.json</code>：小程序的公共设置，可以对小程序进行全局配置，决定页面文件的路径、窗口表现、设置多 tab 等；</li>
<li><code>app.wxss</code>：小程序的公共样式表，可以配置整个小程序的文字的字体、颜色、背景，图片的大小等样式；</li>
<li><code>app.js</code>：小程序的逻辑（这个可以先放着，不用管）</li>
<li><code>pages</code> 文件夹：这里存放着小程序的所有页面，展开 <code>pages</code> 文件夹就可以看到有 <code>index</code> 和 <code>logs</code> 两个页面文件夹；</li>
</ul>
<h3 id="页面组成"><a href="#页面组成" class="headerlink" title="页面组成"></a>页面组成</h3><p>在每一个页面文件夹里都有四个文件，这四个文件的名称都是一样的，它们分别为：</p>
<ul>
<li><code>json</code> 文件，和上面的 <code>app.json</code> 作用基本相同，只是 <code>app.json</code> 控制的是整个小程序的设置，而页面的 <code>json</code> 文件只控制单个页面的配置（因为有时候全局配置就够用了，所以页面配置有时候是空的）；</li>
<li><code>wxml</code> 文件（类似于 <code>xml</code>），小程序的页面结构，文字、图片、音乐、视频、地图、轮播等组件都会放在这里；</li>
<li><code>wxss</code> 文件（类似于 <code>css</code>），小程序的页面样式，和 <code>app.wxss</code> 一样是控制样式，而页面的 <code>wxss</code> 文件是控制单个页面的样式；</li>
<li><code>js</code> 文件，控制小程序页面的逻辑。</li>
</ul>
<h2 id="app-json"><a href="#app-json" class="headerlink" title="app.json"></a>app.json</h2><h3 id="json-基本语法"><a href="#json-基本语法" class="headerlink" title="json 基本语法"></a>json 基本语法</h3><ul>
<li>大括号 <code>{}</code> 保存对象；</li>
<li>中括号 <code>[]</code>保存数组；</li>
<li>各个数据之间由英文字符逗号 <code>,</code> 隔开；</li>
<li>字段名称（属性名）与值之间用 <code>:</code> 隔开，字段名称在前，字段的取值在后；</li>
<li>字段名称用 <code>&quot;&quot;</code> 给包着；</li>
</ul>
<h3 id="app-json-配置"><a href="#app-json-配置" class="headerlink" title="app.json 配置"></a>app.json 配置</h3><p><code>app.json</code> 的配置文档：<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html</a></p>
<p>默认的 <code>app.json</code> 如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"pages"</span>:[</span><br><span class="line">    <span class="string">"pages/index/index"</span>,</span><br><span class="line">    <span class="string">"pages/logs/logs"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"window"</span>:&#123;</span><br><span class="line">    <span class="attr">"backgroundTextStyle"</span>:<span class="string">"light"</span>,</span><br><span class="line">    <span class="attr">"navigationBarBackgroundColor"</span>: <span class="string">"#fff"</span>,</span><br><span class="line">    <span class="attr">"navigationBarTitleText"</span>: <span class="string">"test"</span>,</span><br><span class="line">    <span class="attr">"navigationBarTextStyle"</span>:<span class="string">"black"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"style"</span>: <span class="string">"v2"</span>,</span><br><span class="line">  <span class="attr">"sitemapLocation"</span>: <span class="string">"sitemap.json"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>window</code> 是配置全局的页面设置，见 <a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html%E3%80%82" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html。</a></p>
<p><code>pages</code> 则是小程序的页面。默认展示第一项（这里是 <code>pages/index/index</code>）的内容。在 <code>pages</code> 中新增一项 <code>pages/home/home</code>，编译后会自动创建 <code>pages/home</code> 文件及<a href="#%E9%A1%B5%E9%9D%A2%E7%BB%84%E6%88%90">页面组成</a>中的四个文件。</p>
<h2 id="wxml-和-wxss"><a href="#wxml-和-wxss" class="headerlink" title="wxml 和 wxss"></a>wxml 和 wxss</h2><h3 id="wxml"><a href="#wxml" class="headerlink" title="wxml"></a>wxml</h3><p>刚才创建的 <code>pages/home/home.wxml</code> 的语法类似于 <code>xml</code>。</p>
<ul>
<li><code>&lt;text&gt;pages/home/home.wxml&lt;/text&gt;</code> 被称作组件。</li>
<li><code>&lt;text&gt;</code> 被称为标签。</li>
<li>组件需要被开始标签和闭合标签包含，前面的 <code>&lt;text&gt;</code> 是开始标签，后面的 <code>&lt;/text&gt;</code> 是结束标签。</li>
<li><code>&lt;view&gt;</code> 组件是可以嵌套写的，如：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>WXML 模板<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>从事过网页编程的人知道，网页编程采用的是 HTML + CSS + JS 这样的组合，其中 HTML 是用来描述当前这个页面的结构，CSS 用来描述页面的样子，JS 通常是用来处理这个页面和用户的交互。<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="wxml-模板"><a href="#wxml-模板" class="headerlink" title="wxml 模板"></a>wxml 模板</h3><p>WXML 支持模板，即定义好会复用的 WXML 片段，然后在其他地方调用即可。</p>
<p>教程：<a href="https://cloudbase.net/community/guides/handbook/tcb09.html" target="_blank" rel="noopener">https://cloudbase.net/community/guides/handbook/tcb09.html</a><br>官方文档：<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/import.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/import.html</a></p>
<h3 id="wxss"><a href="#wxss" class="headerlink" title="wxss"></a>wxss</h3><p><code>wxss</code> 的官方文档：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html</a></p>
<p><code>wxss</code> 美化的知识和 <code>css</code> 相同，<code>css</code> 的参考手册：<a href="https://www.w3school.com.cn/cssref/index.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/cssref/index.asp</a></p>
<p>和 CSS 相同的知识就放在 <a href="/css/css">CSS</a> 中了。</p>
<p>较 CSS，WXSS 定义了新的单位：<code>rpx</code>。规定 <code>750rpx</code> 是一屏幕宽。如在 iPhone6（宽度为 375px）上，<code>750rpx = 375px</code>。</p>
<p>对于全局样式和局部样式（<a href="https://cloudbase.net/community/guides/handbook/tcb04.html" target="_blank" rel="noopener">来源</a>）：</p>
<blockquote>
<p>定义在 <code>app.wxss</code> 中的样式为全局样式，作用于每一个页面。在 <code>page</code> 的 <code>wxss</code> 文件中定义的样式为局部样式，只作用在对应的页面，并会覆盖 <code>app.wxss</code> 中相同的选择器。</p>
</blockquote>
<h2 id="链接和图片"><a href="#链接和图片" class="headerlink" title="链接和图片"></a>链接和图片</h2><h3 id="链接-navigator"><a href="#链接-navigator" class="headerlink" title="链接 navigator"></a>链接 navigator</h3><p>将一个小程序页面链接到另一个小程序页面的组件叫 <code>navigator</code>。</p>
<p>我们添加一个页面，路径为 <code>/page/imgshow/imgshow</code>。新的 <code>app.json</code> 部分代码如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"pages":[</span><br><span class="line">  "pages/home/home",</span><br><span class="line">  "pages/index/index",</span><br><span class="line">  "pages/logs/logs",</span><br><span class="line">  "pages/imgshow/imgshow"</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>在 <code>/pages/home/home.wxml</code> 加入以下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"index-link"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">"../imgshow/imgshow"</span> <span class="attr">class</span>=<span class="string">"item-link"</span>&gt;</span>让小程序显示图片<span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>此时编译运行，点击<code>让小程序显示图片</code>即可跳转到 <code>/pages/imgshow/imgshow.wxml</code>。</p>
<p>但是这里的 <code>让小程序显示图片</code> 并没有以超链接的形式给出，可以修改 <code>wxss</code> 以更改其样式。在 <code>/pages/imgshow/imgshow.wxss</code> 中加入以下代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-link</span>&#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding</span>:<span class="number">10px</span> <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#4ea6ec</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译。效果如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/82bf41eba1cc364c239261d749a57afcaea6cab33cc129d6af6477814fa1482b.png" alt="navigator 组件" title="">
                </div>
                <div class="image-caption">navigator 组件</div>
            </figure>

<p>点击蓝色部分即可跳转到对应页面。</p>
<h3 id="图片-image"><a href="#图片-image" class="headerlink" title="图片 image"></a>图片 image</h3><p>对于图片，只需要知道怎么插入图片就行了。其他仅作了解，用到的时候再查。</p>
<h4 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h4><p>先放文档：<a href="https://developers.weixin.qq.com/miniprogram/dev/component/image.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/component/image.html</a></p>
<p>将以下代码复制到 <code>imgshow.wxml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"imglist"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">"imgitem"</span> <span class="attr">src</span>=<span class="string">"https://hackwork.oss-cn-shanghai.aliyuncs.com/lesson/weapp/4/weapp.jpg"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/23ff30264c519ae9fa9c88dece167473e9705c7c7251c73df9474c0f66caa452.png" alt="图片展示" title="">
                </div>
                <div class="image-caption">图片展示</div>
            </figure>

<h4 id="显示模式"><a href="#显示模式" class="headerlink" title="显示模式"></a>显示模式</h4><p>其中，<code>image</code> 组件共有 13 种 <code>mode</code>（其中 5 种缩放、8 种裁剪。参见 <code>image</code> 的文档）。如想“宽度不变，高度自动变化，保持原图宽高比不变”，则可以修改代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"imglist"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">"imgitem"</span> <span class="attr">mode</span>=<span class="string">"widthFix"</span> <span class="attr">src</span>=<span class="string">"https://hackwork.oss-cn-shanghai.aliyuncs.com/lesson/weapp/4/weapp.jpg"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在 <code>imgshow.wxss</code> 给图片添加 <code>wxss</code>，指定宽度为占满屏幕：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.imglist</span> <span class="selector-class">.imgitem</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/28db320ceb422490421adc8c9f218d45886343101c10e6294586600501d3f8b2.png" alt="缩放模式" title="">
                </div>
                <div class="image-caption">缩放模式</div>
            </figure>

<h4 id="圆角和阴影"><a href="#圆角和阴影" class="headerlink" title="圆角和阴影"></a>圆角和阴影</h4><p>还可以给图片添加圆角和阴影。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.imglist</span> <span class="selector-class">.img</span>&#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">5px</span> <span class="number">8px</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">53</span>,<span class="number">178</span>,<span class="number">225</span>,<span class="number">0.26</span>);</span><br><span class="line">  <span class="comment">/* rgba 中的 alpha 为透明度，取值 0~1 之间，越靠近 0 越透明 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/c0b9be7df1f223cf25b7944cf943f407c9f70edaa969b0ae0cf25e23fbef3930.png" alt="圆角和阴影" title="">
                </div>
                <div class="image-caption">圆角和阴影</div>
            </figure>

<h4 id="圆形图片"><a href="#圆形图片" class="headerlink" title="圆形图片"></a>圆形图片</h4><p>示例 XML：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"imglist"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">"circle"</span> <span class="attr">mode</span>=<span class="string">"widthFix"</span> <span class="attr">src</span>=<span class="string">"https://hackwork.oss-cn-shanghai.aliyuncs.com/lesson/weapp/4/logo.jpg"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>示例 CSS：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.imglist</span> <span class="selector-class">.circle</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/a36cc6ef15b86f52a508be3dbd1b65b30a39d9feae8e194689373ded3f2cc154.png" alt="圆形图片" title="">
                </div>
                <div class="image-caption">圆形图片</div>
            </figure>

<h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>此外，还支持修改文字的背景。参见 <a href="/css/css#%E8%83%8C%E6%99%AF%E5%B1%9E%E6%80%A7">CSS</a>。</p>
<h4 id="卡片风格示例"><a href="#卡片风格示例" class="headerlink" title="卡片风格示例"></a>卡片风格示例</h4><p>官方示例，有点好看。<a href="https://cloudbase.net/community/guides/handbook/tcb03.html" target="_blank" rel="noopener">代码见网页最后</a>。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/af0f751daa069a5078ca7cb270656bc1a5087ae5b89d2193051bc3eea30cc81a.png" alt="示例" title="">
                </div>
                <div class="image-caption">示例</div>
            </figure>

<h2 id="WeUI-框架"><a href="#WeUI-框架" class="headerlink" title="WeUI 框架"></a>WeUI 框架</h2><p>WeUI 是一套小程序的 UI 框架，所谓 UI 框架就是一套界面设计方案。</p>
<p>有了组件，我们可以用它来拼接出一个内容丰富的小程序，而有了一个 UI 框架，就能让我们的小程序变得更加美观。</p>
<h3 id="体验-WeUI-小程序"><a href="#体验-WeUI-小程序" class="headerlink" title="体验 WeUI 小程序"></a>体验 WeUI 小程序</h3><p>这是微信发布的基于 WeUI 的模板小程序。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://user-images.githubusercontent.com/2395166/29502325-ada080f6-8661-11e7-94c2-23d638210f45.jpg" alt="微信小程序码" title="">
                </div>
                <div class="image-caption">微信小程序码</div>
            </figure>

<p>代码地址：<a href="https://github.com/Tencent/weui-wxss" target="_blank" rel="noopener">https://github.com/Tencent/weui-wxss</a></p>
<p>下载以后将 <code>dist</code> 文件夹下的代码导入 <code>微信开发者工具</code>，运行，即可得到上述效果。</p>
<p>不过，需要注意的是，WeUI 模板小程序中很多元素是使用 view 组件模拟，其效果不如对应的原生组件（如 <code>button</code> <code>searchbar</code> <code>tabbar</code> 等）。因此，使用模板前可以在<a href="https://developers.weixin.qq.com/miniprogram/dev/extended/weui/" target="_blank" rel="noopener">文档</a>中搜索一下是否有对应的原生组件。</p>
<h3 id="使用-WeUI"><a href="#使用-WeUI" class="headerlink" title="使用 WeUI"></a>使用 WeUI</h3><ol>
<li>在我们的项目的根目录新建 <code>style</code> 文件夹；</li>
<li>将模板中的 <code>/dist/style/weui.wxss</code> 导入我们项目中的 <code>style</code> 文件夹；</li>
<li>在我们项目的 <code>app.wxss</code> 添加一行代码：</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">'style/weui.wxss'</span>;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>按照官方代码的形式编写自己的代码，就能渲染成模板小程序的样子。</li>
</ol>
<p>需要注意的是，这个小程序只使用 <code>view</code> 和 <code>input</code> 控件就渲染了绝大多数页面。包括 <code>button</code> 等也是用 <code>view</code> 渲染的。</p>
<p>不过实际编写中，由于 <code>button</code> 在配合表单等有更多的功能，可以使用 <code>button</code>，然后使用 WeUI 中的 <code>class</code> 作用于 <code>button</code> 之上。</p>
<h3 id="Flex-布局-1"><a href="#Flex-布局-1" class="headerlink" title="Flex 布局(1)"></a>Flex 布局(1)</h3><p>Flex 是 Flexible Box 的缩写，意为”弹性布局”，用来为盒状模型提供最大的灵活性。</p>
<p>官方教程上对示例代码有更加清晰的解释。</p>
<p>WXML：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"flex-box"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'list-item'</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'list-item'</span>&gt;</span>小程序<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'list-item'</span>&gt;</span>网站建设<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>WXSS：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.list-item</span>&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#82c2f7</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#bdd2f8</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>; <span class="comment">/*各版块 1:1 等分*/</span></span><br><span class="line">  <span class="attribute">display</span>: flex; <span class="comment">/*给 list-item 组件添加 display: flex 后，文字呈现水平居中的结构*/</span></span><br><span class="line">  <span class="attribute">align-items</span>:center; <span class="comment">/*垂直居中*/</span></span><br><span class="line">  <span class="attribute">justify-content</span>: center; <span class="comment">/*水平居中*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.flex-box</span>&#123;</span><br><span class="line">   <span class="attribute">display</span>: flex; <span class="comment">/*给 flex-box 组件添加 display: flex 后，三个 item 呈现左右而不是上下结构*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>display: flex;</code> 对于 <code>flex-box</code> 来说，就是让其内容左右分布；对于 <code>list-item</code> 来说，就是让其文字水平居中。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/8c92e5b1e7b8cc392d97dff036e5894510ec5831ebc626aa70d3fa1104ef3c89.png" alt="Flex 布局" title="">
                </div>
                <div class="image-caption">Flex 布局</div>
            </figure>

<h3 id="Flex-布局-2"><a href="#Flex-布局-2" class="headerlink" title="Flex 布局(2)"></a>Flex 布局(2)</h3><p>下面参考官方的 WeUI 小程序中的 Flex 重新编写以上代码。</p>
<p>其中 WXML 和 WXSS 都是参考 <a href="https://github.com/Tencent/weui-wxss/tree/master/dist/example/flex" target="_blank" rel="noopener">Git 仓库</a> 的对应文件进行修改/照搬。</p>
<p>XML：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-flex"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-flex__item"</span>&gt;</span><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">view</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-flex__item"</span>&gt;</span><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span>小程序<span class="tag">&lt;/<span class="name">view</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-flex__item"</span>&gt;</span><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span>网页建设<span class="tag">&lt;/<span class="name">view</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>WXSS 直接复制对应的文件：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.placeholder</span>&#123;<span class="attribute">margin</span>:<span class="number">5px</span>;<span class="attribute">padding</span>:<span class="number">0</span> <span class="number">10px</span>;<span class="attribute">text-align</span>:center;<span class="attribute">background-color</span>:<span class="built_in">var</span>(--weui-BG-<span class="number">1</span>);<span class="attribute">height</span>:<span class="number">2.3em</span>;<span class="attribute">line-height</span>:<span class="number">2.3em</span>;<span class="attribute">color</span>:<span class="built_in">var</span>(--weui-FG-<span class="number">1</span>)&#125;</span><br></pre></td></tr></table></figure>

<p>最后记得在 <code>/app.wxss</code> 中 <code>@import &quot;/style/weui.wxss&quot;;</code>。</p>
<p>编译运行，效果图如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/a6baff90b04301112e4473b20bd22b98fcab1a6e467d48ebed951771d4fbf682.png" alt="Flex 布局" title="">
                </div>
                <div class="image-caption">Flex 布局</div>
            </figure>

<p>这也太香了吧。</p>
<h2 id="JavaScript-数据绑定"><a href="#JavaScript-数据绑定" class="headerlink" title="JavaScript 数据绑定"></a>JavaScript 数据绑定</h2><p><a href="https://cloudbase.net/community/guides/handbook/tcb06.html" target="_blank" rel="noopener">教程</a></p>
<p>什么是数据绑定呢？就是把 WXML 中的一些动态数据分离出来放到对应的 js 文件的 Page 的 <code>data</code> 里。</p>
<p>只需要将 WXML 的代码写成：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;username&#125;&#125;，您已登录，欢迎<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后同名 JS 写成：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    username:<span class="string">"张明"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>即可导入变量。</p>
<p>常用变量类型有：字符串、数字、布尔值、对象、数组。</p>
<p>其中对象类似于 Python 字典的形式，数组类似于 Python 列表的形式（下标从 0 开始）。</p>
<p>在 WXML 中访问对象的方法是 <code>.</code>，访问数组的方法是 <code>[i]</code>。</p>
<p>如下是对象和数组嵌套的一个示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">  movies: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">"肖申克的救赎"</span>,</span><br><span class="line">      englishname: <span class="string">"The Shawshank Redemption"</span>,</span><br><span class="line">      country: <span class="string">"美国"</span>,</span><br><span class="line">      year: <span class="number">1994</span>,</span><br><span class="line">      img: <span class="string">"https://img3.doubanio.com/view/photo/s_ratio_poster/public/p480747492.webp"</span>,</span><br><span class="line">      desc: <span class="string">"有的人的羽翼是如此光辉，即使世界上最黑暗的牢狱，也无法长久地将他围困！"</span>,</span><br><span class="line">      actor: [</span><br><span class="line">        &#123;</span><br><span class="line">          name:<span class="string">"蒂姆·罗宾斯"</span>,</span><br><span class="line">          role:<span class="string">"安迪·杜佛兰"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name:<span class="string">"摩根·弗里曼"</span>,</span><br><span class="line">          role:<span class="string">"艾利斯·波伊德·瑞德"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;movies[<span class="number">0</span>].actor[<span class="number">0</span>].role&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>可以得到 <code>&quot;安迪·杜佛兰&quot;</code>。</p>
<p>由于比较简单就不多说了，详细教程可看本节开头的教程链接。</p>
<h2 id="列表渲染和条件渲染"><a href="#列表渲染和条件渲染" class="headerlink" title="列表渲染和条件渲染"></a>列表渲染和条件渲染</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/list.html" target="_blank" rel="noopener">文档</a></p>
<p>这是 WXML 的功能，可以对 JS 的数据渲染的时候进行 <code>for</code> 遍历和 <code>if</code> 判断。</p>
<p>下面的九九乘法表是一个很好的例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&#125;"</span> <span class="attr">wx:for-item</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&#125;"</span> <span class="attr">wx:for-item</span>=<span class="string">"j"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;i &lt;= j&#125;&#125;"</span>&gt;</span></span><br><span class="line">      &#123;&#123;i&#125;&#125; * &#123;&#123;j&#125;&#125; = &#123;&#123;i * j&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>也可以使用 <code>hidden</code> 代替 <code>if</code> 进行条件渲染：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">hidden</span>=<span class="string">"&#123;&#123;i &gt; j&#125;&#125;"</span>&gt;</span></span><br><span class="line">  &#123;&#123;i&#125;&#125; * &#123;&#123;j&#125;&#125; = &#123;&#123;i * j&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将上述 <code>[1, 2, 3, 4, 5, 6, 7, 8, 9]</code> 放到 js 的 data 中即可实现渲染 js 的数据。</p>
<p>不过，如果 js 的 data 是动态变化的，每次 data 改变就会导致重新渲染列表。解决方法是增加 <code>wx:key</code> 作为列表中 item 的唯一标识符。详见：<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/list.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/list.html</a></p>
<p>如不提供 <code>wx:key</code>，会报一个 <code>warning</code>。但是如果明确知道该列表是静态，或者不必关注其顺序，可以选择忽略。</p>
<p><code>wx:key</code> 可以有两种：</p>
<ul>
<li>如果是 item 本身（如上例），则可以用 <code>wx:key=&quot;*this&quot;</code>；</li>
<li>如果 item 是一个对象，想用其属性如 <code>name</code>，则可以用 <code>wx:key=&quot;name&quot;</code>；</li>
<li>除此之外，还可以用其下标：<code>wx:key=&quot;index&quot;</code>。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&#125;"</span> <span class="attr">wx:for-item</span>=<span class="string">"i"</span> <span class="attr">wx:key</span>=<span class="string">"*this"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&#125;"</span> <span class="attr">wx:for-item</span>=<span class="string">"j"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;i &lt;= j&#125;&#125;"</span>&gt;</span></span><br><span class="line">      &#123;&#123;i&#125;&#125; * &#123;&#123;j&#125;&#125; = &#123;&#123;i * j&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="获取表单内容"><a href="#获取表单内容" class="headerlink" title="获取表单内容"></a>获取表单内容</h2><p>WeUI 小程序提供了表单，但是没有提供 JS。而按照这个小程序的写法，是不能在点击按钮触发的 <code>bindtap</code> 函数中获取表单的信息的。因此，对于表单，更推荐另一种写法：<a href="https://cloudbase.net/community/guides/handbook/tcb15.html" target="_blank" rel="noopener">链接</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;form bindsubmit=<span class="string">"formSubmit"</span> bindrest=<span class="string">"formReset"</span>&gt;</span><br><span class="line">    &lt;view&gt;开关选择器按钮&lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">    &lt;switch name="switch"/</span>&gt;</span><br><span class="line">    &lt;view&gt;滑动选择器按钮slider&lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">    &lt;slider name="process" show-value &gt;&lt;/</span>slider&gt;</span><br><span class="line">    &lt;view&gt;文本输入框&lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">    &lt;input name="textinput" placeholder="要输入的文本" /</span>&gt;</span><br><span class="line">    &lt;view&gt;单选按钮radio&lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">    &lt;radio-group name="sex"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;label&gt;&lt;radio value="male"/</span>&gt;男&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;label&gt;&lt;radio value="female"/</span>&gt;女&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>radio-group&gt;</span><br><span class="line">    &lt;view&gt;多选按钮checkbox&lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">    &lt;checkbox-group name="gamecheck"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;label&gt;&lt;checkbox value="game1"/</span>&gt;王者荣耀&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;label&gt;&lt;checkbox value="game2"/</span>&gt;欢乐斗地主&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;label&gt;&lt;checkbox value="game3"/</span>&gt;连连看&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;label&gt;&lt;checkbox value="game4"/</span>&gt;刺激战场&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;label&gt;&lt;checkbox value="game5"/</span>&gt;穿越火线&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;label&gt;&lt;checkbox value="game6"/</span>&gt;天天酷跑&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>checkbox-group&gt;</span><br><span class="line">    &lt;button form-type=<span class="string">"submit"</span>&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button form-type="reset"&gt;重置&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/form&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里需要重点注意的是 <code>form</code> 和 <code>button</code> 控件。<code>form</code> 的 <code>bindsubmit</code> 配合 <code>&lt;button form-type=&quot;submit&quot;&gt;</code>，可以使得在按下这个 button 的时候，<code>form</code> 将表单中的内容作为参数，调用 <code>bindsubmit</code> 函数。</p>
<p>不过需要注意的是，组件中的 <code>name</code> 项必须写，否则是不会记录其内容的。</p>
<h2 id="更多组件：轮播、音频、视频、cover、地图"><a href="#更多组件：轮播、音频、视频、cover、地图" class="headerlink" title="更多组件：轮播、音频、视频、cover、地图"></a>更多组件：轮播、音频、视频、cover、地图</h2><p><a href="https://cloudbase.net/community/guides/handbook/tcb08.html" target="_blank" rel="noopener">教程链接</a></p>
<p>如果没有需要则可以跳过。</p>
<h2 id="JavaScript-微信-API"><a href="#JavaScript-微信-API" class="headerlink" title="JavaScript 微信 API"></a>JavaScript 微信 API</h2><p>JavaScript 入门知识就放在<a href="../javascript">另一篇博客</a>了。</p>
<p><code>wx</code> 是小程序的全局对象，用于承载小程序能力相关 API。</p>
<p>小程序开发框架提供丰富的微信原生 API，可以方便的调起微信提供的能力，如获取用户信息，了解网络状态等。</p>
<p>可以在微信开发者工具的控制台 Console 里输入 wx，了 解 一 下 这 个 对 象（共 700+ 个成员函数）。</p>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/api.html#API" target="_blank" rel="noopener">文档</a></p>
<h3 id="获取信息"><a href="#获取信息" class="headerlink" title="获取信息"></a>获取信息</h3><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><h4 id="获取网络状态"><a href="#获取网络状态" class="headerlink" title="获取网络状态"></a>获取网络状态</h4><p>下面列举的代码，可以直接在微信开发者工具的调试器中的 Console 输入。在电脑模拟器和真机调试的输出也会不同。</p>
<p>文档就不给出了，随手百度/谷歌，第一个就是。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wx.getNetworkType(&#123;</span><br><span class="line">      success(res) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="获取用户信息"><a href="#获取用户信息" class="headerlink" title="获取用户信息"></a>获取用户信息</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wx.getUserInfo(&#123;</span><br><span class="line">  success(res) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="获取设备信息"><a href="#获取设备信息" class="headerlink" title="获取设备信息"></a>获取设备信息</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wx.getSystemInfo(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.model)</span><br><span class="line">    <span class="built_in">console</span>.log(res.pixelRatio)</span><br><span class="line">    <span class="built_in">console</span>.log(res.windowWidth)</span><br><span class="line">    <span class="built_in">console</span>.log(res.windowHeight)</span><br><span class="line">    <span class="built_in">console</span>.log(res.language)</span><br><span class="line">    <span class="built_in">console</span>.log(res.version)</span><br><span class="line">    <span class="built_in">console</span>.log(res.platform)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="获取场景值"><a href="#获取场景值" class="headerlink" title="获取场景值"></a>获取场景值</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/scene-list.html" target="_blank" rel="noopener">文档</a></p>
<p>场景值用来描述用户进入小程序的路径。如扫二维码、搜索等。场景值获取方式和对应含义可见文档。</p>
<h3 id="设置当前页面"><a href="#设置当前页面" class="headerlink" title="设置当前页面"></a>设置当前页面</h3><h4 id="设置页面标题"><a href="#设置页面标题" class="headerlink" title="设置页面标题"></a>设置页面标题</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.setNavigationBarTitle(&#123;</span><br><span class="line">  title: <span class="string">'控制台更新的标题'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="下拉操作"><a href="#下拉操作" class="headerlink" title="下拉操作"></a>下拉操作</h4><p>需要在 <code>app.json</code> 或页面对应的 <code>json</code> 设置 <code>&quot;enablePullDownRefresh&quot;: true</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  onPullDownRefresh: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">//下拉时触发的函数</span></span><br><span class="line">    <span class="keyword">this</span>.onShow();                 <span class="comment">// 触发 onShow 函数，可根据需要改为其他代码</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sleep</span> (<span class="params">time</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> setTimeout(resolve, time));</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">500</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;        <span class="comment">//睡眠 500ms</span></span><br><span class="line">      wx.stopPullDownRefresh()     <span class="comment">//停止下拉的状态</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="图片、缓存和文件"><a href="#图片、缓存和文件" class="headerlink" title="图片、缓存和文件"></a>图片、缓存和文件</h3><p><a href="https://cloudbase.net/community/guides/handbook/tcb16.html" target="_blank" rel="noopener">教程</a></p>
<h3 id="点击事件"><a href="#点击事件" class="headerlink" title="点击事件"></a>点击事件</h3><blockquote>
<p>事件是视图层到逻辑层的通信方式，当我们点击 <code>tap</code>、触摸 <code>touch</code>、长按 <code>longpress</code> 小程序绑定了事件的组件时，就会触发事件，执行逻辑层中对应的事件处理函数。  </p>
</blockquote>
<blockquote>
<p>小程序框架的<strong>视图层</strong>由 WXML 与 WXSS 来编写的，由组件来进行展示。<br><strong>将逻辑层的数据反应成视图，同时将视图层的事件发送给逻辑层。</strong><br><strong>逻辑层</strong>将数据进行处理后发送给视图层，同时接受视图层的事件反馈。</p>
</blockquote>
<h4 id="点击按钮触发页面滚动"><a href="#点击按钮触发页面滚动" class="headerlink" title="点击按钮触发页面滚动"></a>点击按钮触发页面滚动</h4><p>首先在测试页面的 WXML 首尾增加两个 <code>button</code>（两个 <code>button</code> 之间沿用九九乘法表的代码）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"scrollToPosition"</span>&gt;</span>滚动到指定位置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"pagetop"</span> <span class="attr">style</span>=<span class="string">"background-color:#333;width:100%;height:400px"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&#125;"</span> <span class="attr">wx:for-item</span>=<span class="string">"i"</span> <span class="attr">wx:key</span>=<span class="string">"*this"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&#125;"</span> <span class="attr">wx:for-item</span>=<span class="string">"j"</span> <span class="attr">wx:key</span>=<span class="string">"*this"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;i &lt;= j&#125;&#125;"</span>&gt;</span></span><br><span class="line">      &#123;&#123;i&#125;&#125; * &#123;&#123;j&#125;&#125; = &#123;&#123;i * j&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"scrollToTop"</span>&gt;</span>滚动到页面顶部<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">id</span>=<span class="string">"pageblock"</span> <span class="attr">style</span>=<span class="string">"background-color:#333;width:100%;height:400px"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意 <code>button</code> 属性里有一个 <code>bindtap</code>，它的值对应的 js 函数就是当按钮按下时调用的函数。</p>
<p>于是我们在同名 JS 下写两个函数调用 <code>wx.pageScrollTo</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  scrollToTop() &#123;</span><br><span class="line">    wx.pageScrollTo(&#123;</span><br><span class="line">      scrollTop: <span class="number">0</span>,</span><br><span class="line">      duration: <span class="number">300</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  scrollToPosition() &#123;</span><br><span class="line">    wx.pageScrollTo(&#123;</span><br><span class="line">      scrollTop: <span class="number">6000</span>,</span><br><span class="line">      duration: <span class="number">300</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>然后编译。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/dbcca983410a5ad593749f1ce3f716c85390b9213a8e17ae6c9dcbcb53a99c39.png" alt="按钮" title="">
                </div>
                <div class="image-caption">按钮</div>
            </figure>

<p>点击“滚动到指定位置”可以滚到 6000px 的位置（由于总长没有 6000，因此就是滚到末尾）；点击“滚动到页面顶部”可以滚动到顶部。</p>
<p>也可以滚动到指定 XML 选择器的位置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">scrollToTop() &#123;</span><br><span class="line">  wx.pageScrollTo(&#123;</span><br><span class="line">    duration: <span class="number">3000</span>,</span><br><span class="line">    selector:<span class="string">".pagetop"</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">scrollToPosition() &#123;</span><br><span class="line">  wx.pageScrollTo(&#123;</span><br><span class="line">    duration: <span class="number">300</span>,</span><br><span class="line">    selector:<span class="string">"#pageblock"</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="消息提示框-Toast"><a href="#消息提示框-Toast" class="headerlink" title="消息提示框 Toast"></a>消息提示框 Toast</h4><p>依旧是 <code>button</code> 通过 <code>bindtap</code> 绑定到调用 <code>wx.showToast</code> 的函数。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"toastTap"</span>&gt;</span>点击弹出消息对话框<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">toastTap() &#123;</span><br><span class="line">  wx.showToast(&#123;</span><br><span class="line">    title: <span class="string">'购买成功'</span>,</span><br><span class="line">    icon: <span class="string">'success'</span>,</span><br><span class="line">    duration: <span class="number">2000</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="模态对话框"><a href="#模态对话框" class="headerlink" title="模态对话框"></a>模态对话框</h4><p>依旧是 <code>button</code> 通过 <code>bindtap</code> 绑定到调用 <code>wx.showModel</code> 的函数。不过这里增加了用户的两个选项。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"modalTap"</span>&gt;</span>显示模态对话框<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">modalTap() &#123;</span><br><span class="line">  wx.showModal(&#123;</span><br><span class="line">    title: <span class="string">'学习声明'</span>,</span><br><span class="line">    content: <span class="string">'学习小程序的开发是一件有意思的事情，我决定每天打卡学习'</span>,</span><br><span class="line">    showCancel: <span class="literal">true</span>,</span><br><span class="line">    confirmText: <span class="string">'确定'</span>,</span><br><span class="line">    success(res) &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.confirm) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'用户点击了确定'</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.cancel) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'用户点击了取消'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/b68bf978e78749e58d4fad0bcba3a98c5da2e3d39f546fe8d9298d00ccb9978c.png" alt="模态对话框" title="">
                </div>
                <div class="image-caption">模态对话框</div>
            </figure>

<h4 id="手机震动"><a href="#手机震动" class="headerlink" title="手机震动"></a>手机震动</h4><p>一样的套路，把函数改为 <code>wx.vibrateLong()</code> 即可。</p>
<h3 id="Navigator-组件和页面路由-API"><a href="#Navigator-组件和页面路由-API" class="headerlink" title="Navigator 组件和页面路由 API"></a>Navigator 组件和页面路由 API</h3><p><code>Navigator</code> 组件可以做到的事情，使用 JavaScript 调用小程序也能路由 API 也可以做到。<code>Navigator</code> 组件的内容是写死的，而 JavaScript 则可以提供动态的数据。</p>
<table>
<thead>
<tr>
<th>页面路由 API</th>
<th>Navigator open-type 值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>wx.redirectTo</code></td>
<td>redirect</td>
<td>关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。</td>
</tr>
<tr>
<td><code>wx.navigateTo</code></td>
<td>navigate</td>
<td>保留当前页面，跳转到应用内的某个页面。但是不能跳到 tabbar 页面。</td>
</tr>
<tr>
<td><code>wx.navigateBack</code></td>
<td>navigateBack</td>
<td>关闭当前页面，返回上一页面或多级页面。</td>
</tr>
<tr>
<td><code>wx.switchTab</code></td>
<td>switchTab</td>
<td>跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面</td>
</tr>
<tr>
<td><code>wx.reLaunch</code></td>
<td>reLaunch</td>
<td>关闭所有页面，打开到应用内的某个页面</td>
</tr>
</tbody></table>
<h3 id="事件对象"><a href="#事件对象" class="headerlink" title="事件对象"></a>事件对象</h3><p><a href="https://cloudbase.net/community/guides/handbook/tcb13.html" target="_blank" rel="noopener">教程链接</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#currenttarget" target="_blank" rel="noopener">事件 文档</a></p>
<blockquote>
<p>在前面的列表渲染里，我们知道点击电影列表里的某一部电影，要进行页面跳转显示该电影的详情，我们需要给该电影创建一个页面，那如果要显示数千部的电影的详情，一一创建电影详情页显然不合适，毕竟所有电影的详情页都是同一一个结构，有没有办法所有电影详情都共用一个页面，但是根据点击的链接的不同，渲染相应的数据？答案是肯定的，要解决这个问题，首先我们要了解链接组件的点击信息。</p>
<blockquote>
<p>当点击组件触发事件时，逻辑层绑定该事件的处理函数会收到一个事件对象，通过 <code>event</code> 对象可以获取事件触发时候的一些信息，比如时间戳、 <code>detail</code> 以及当前组件的一些属性值集合，尤其是事件源组件的 <code>id</code>。</p>
</blockquote>
</blockquote>
<p>如，在 WXML 中有一个按钮如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">id</span>=<span class="string">"tapTest"</span> <span class="attr">data-hi</span>=<span class="string">"Weixin"</span> <span class="attr">bindtap</span>=<span class="string">"tapName"</span>&gt;</span> Click me! <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 JS 中定义一个 <code>tapName</code> 函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  tapName: <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>点击按钮可以看到以下信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"type"</span>:<span class="string">"tap"</span>,</span><br><span class="line">  <span class="string">"timeStamp"</span>:<span class="number">895</span>,</span><br><span class="line">  <span class="string">"target"</span>: &#123;</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"tapTest"</span>,</span><br><span class="line">    <span class="string">"dataset"</span>:  &#123;</span><br><span class="line">      <span class="string">"hi"</span>:<span class="string">"Weixin"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"currentTarget"</span>:  &#123;</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"tapTest"</span>,</span><br><span class="line">    <span class="string">"dataset"</span>: &#123;</span><br><span class="line">      <span class="string">"hi"</span>:<span class="string">"Weixin"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"detail"</span>: &#123;</span><br><span class="line">    <span class="string">"x"</span>:<span class="number">53</span>,</span><br><span class="line">    <span class="string">"y"</span>:<span class="number">14</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"touches"</span>:[&#123;</span><br><span class="line">    <span class="string">"identifier"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="string">"pageX"</span>:<span class="number">53</span>,</span><br><span class="line">    <span class="string">"pageY"</span>:<span class="number">14</span>,</span><br><span class="line">    <span class="string">"clientX"</span>:<span class="number">53</span>,</span><br><span class="line">    <span class="string">"clientY"</span>:<span class="number">14</span></span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="string">"changedTouches"</span>:[&#123;</span><br><span class="line">    <span class="string">"identifier"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="string">"pageX"</span>:<span class="number">53</span>,</span><br><span class="line">    <span class="string">"pageY"</span>:<span class="number">14</span>,</span><br><span class="line">    <span class="string">"clientX"</span>:<span class="number">53</span>,</span><br><span class="line">    <span class="string">"clientY"</span>:<span class="number">14</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对比 WXML 可以注意到：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">id</span>=<span class="string">"tapTest"</span> <span class="attr">data-hi</span>=<span class="string">"Weixin"</span> <span class="attr">bindtap</span>=<span class="string">"tapName"</span>&gt;</span> Click me! <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>event.currentTarget.id</code> 对应 WXML 中的 <code>id</code>；</li>
<li><code>event.currentTarget.dataset.hi</code> 对应 <code>data-hi</code>；事实上，在 WXML 中，这些自定义数据以 <code>data-</code> 开头，多个单词由连字符 <code>-</code> 连接。在 JS 中，连字符写法会转换成驼峰写法，而大写字符会自动转成小写字符。<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#dataset" target="_blank" rel="noopener">参考</a></li>
</ul>
<p>这样就可以访问 <code>event.currentTarget.id</code> 或 <code>event.currentTarget.dataset.hi</code> 来实现传递按钮的参数了。</p>
<p>还注意到，在本例中，<code>currentTarget</code> 和 <code>target</code> 是一样的。  </p>
<p>但是，如果在多个组件中触发了 <code>bindtap</code>（如外层的 <code>view</code> 和内层的 <code>image</code> 组件都有 <code>bindtap</code>，点击了图片，则两个 <code>bindtap</code> 对应的函数都会被触发）。  </p>
<blockquote>
<p>我们点击的是图片 image 组件，却分别触发了绑定在 image 组件以及 image 的父级（上一级）组件 view 的事件处理函数，我们称这为<strong>事件冒泡</strong>。</p>
</blockquote>
<p>此时，两个函数中的 <code>currentTarget</code> 都对应 <code>image</code> 组件的信息，而 <code>target</code> 对应的是本身组件（<code>view</code> 或 <code>image</code>）的信息。</p>
<h2 id="变量传递"><a href="#变量传递" class="headerlink" title="变量传递"></a>变量传递</h2><blockquote>
<p>这节讲的是组件是如何携带数据的，事件对象数据的作用以及数据如何跨页面渲染。</p>
</blockquote>
<h3 id="在链接中携带数据"><a href="#在链接中携带数据" class="headerlink" title="在链接中携带数据"></a>在链接中携带数据</h3><p>最简单的就是在链接中携带数据。</p>
<p>如，新建两个页面：<code>pages/home/detail/detail</code> 和 <code>pages/lifecyle/lifecycle</code>。</p>
<p>在 <code>pages/lifecyle/lifecycle.wxml</code> 中写一个跳转组件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">id</span>=<span class="string">"detailshow"</span> <span class="attr">url</span>=<span class="string">"./../home/detail/detail?id=lesson&amp;uid=tcb&amp;key=tap&amp;ENV=weapp&amp;frompage=lifecycle"</span> <span class="attr">class</span>=<span class="string">"item-link"</span>&gt;</span>点击链接看控制台<span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>点击即可跳转到 <code>pages/home/detail/detail</code>。那，如何在 <code>detail</code> 获取数据呢？</p>
<p>在 <code>detail.js</code> 写一个 <code>onLoad</code> 函数即可（这个 <code>onLoad</code> 函数和 <code>data</code> 平级）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(options)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>显示 <code>{id: &quot;lesson&quot;, uid: &quot;tcb&quot;, key: &quot;tap&quot;, ENV: &quot;weapp&quot;, frompage: &quot;lifecycle&quot;}</code>。即，参数被解析为了一个 JS 对象，就可以用 <code>options.id</code> 访问数据。</p>
<h3 id="跨页面数据渲染"><a href="#跨页面数据渲染" class="headerlink" title="跨页面数据渲染"></a>跨页面数据渲染</h3><p>讲到这里，其实就已经可以实现了。流程如下：</p>
<ol>
<li>在 <code>detail.js</code> 中的 <code>data</code> 添加一个 <code>detail</code> 对象，如下：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">detail:&#123;</span><br><span class="line">  name:<span class="string">""</span>,</span><br><span class="line">  img:<span class="string">""</span>,</span><br><span class="line">  desc:<span class="string">""</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>detail.js</code> 的 <code>onload</code> 函数中，将参数值赋给 <code>detail</code>。</li>
<li>在 <code>detail.wxml</code> 中使用 <code></code> 等进行渲染。</li>
</ol>
<h3 id="小程序和页面的生命周期"><a href="#小程序和页面的生命周期" class="headerlink" title="小程序和页面的生命周期"></a>小程序和页面的生命周期</h3><blockquote>
<p><code>App()</code> 函数注册小程序，<code>Page()</code> 函数注册小程序中的一个页面，他们都接受的是对象 <code>Object</code> 类型的参数，包含一些生命周期函数和事件处理函数。<code>App()</code> 必须在 <code>app.js</code> 中调用，必须调用且只能调用一次。开发者可以添加任意的函数或数据变量到 <code>Object</code> 参数中，用 <code>this</code> 可以访问。</p>
</blockquote>
<p>App.js 中的函数及触发时刻如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">onLaunch(opts) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'onLaunch监听小程序初始化。'</span>,opts)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">onShow(opts) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'onShow监听小程序启动或切前台'</span>,opts)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">onHide() &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'onHide监听小程序切后台'</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>onLaunch</code> 是监听小程序的初始化，初始化完成时触发，全局只会触发一次，所以在这里我们可以用来执行获取用户登录信息的函数等一些非常核心的数据，如果 <code>onLaunch</code> 的函数过多，会影响小程序的启动速度。<br><code>onShow</code> 是在小程序启动，或从后台进入前台显示时触发，也就是它会触发很多次，在这里就不大适合放获取用户登录信息的函数啦。这两者的区别要注意。</p>
</blockquote>
<p>每个页面的 JS 中的函数及触发时刻如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">onLoad: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onLoad监听页面加载"</span>,options)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">onReady: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onReady监听页面初次渲染完成"</span>)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">onShow: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onShow监听页面显示"</span>)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">onHide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onHide监听页面隐藏"</span>)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">onUnload: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"onUnload监听页面卸载"</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>推荐自己测试一下。</p>
<h3 id="globalData"><a href="#globalData" class="headerlink" title="globalData"></a>globalData</h3><p><code>app.js</code> 中还有一个 <code>globalData</code>，顾名思义就是全局数据。</p>
<p>可以直接在 <code>app.js</code> 中定义 <code>globalData</code> 的参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">  globalData: &#123;</span><br><span class="line">    userInfo: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>可以在 <code>app.js</code> 的其他函数中修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">  onLaunch: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">    wx.getUserInfo(&#123;</span><br><span class="line">      success(res)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"wx.getUserInfo得到的数据"</span>,res)</span><br><span class="line">        that.globalData.userInfo = res.userInfo</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在其他页面中访问全局变量可以使用 <code>getApp()</code>（<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/getApp.html" target="_blank" rel="noopener">文档</a>）:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> app = getApp()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'user页面打印的app'</span>, app)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'user页面打印的globalData'</span>, app.globalData.userInfo)</span><br></pre></td></tr></table></figure>

<h2 id="网络-API"><a href="#网络-API" class="headerlink" title="网络 API"></a>网络 API</h2><p><a href="https://cloudbase.net/community/guides/handbook/tcb17.html" target="_blank" rel="noopener">教程</a></p>
<h2 id="云函数"><a href="#云函数" class="headerlink" title="云函数"></a>云函数</h2><p>云函数即在云端（腾讯提供的临时服务器）执行的 JavaScript 函数。</p>
<p>某些函数需要调用 npm 包，但我们不能在每台手机上安装所有 npm 组件。<br>因此，我们将 npm 包和需要这些包的函数部署在云上，手机上只需要调用这些云函数即可。</p>
<p><a href="https://cloudbase.net/community/guides/handbook/tcb21.html" target="_blank" rel="noopener">教程</a></p>
<h3 id="wx-cloud"><a href="#wx-cloud" class="headerlink" title="wx.cloud"></a>wx.cloud</h3><p><code>wx.cloud</code> 对象有以下成员。云函数、云数据库、云存储都是通过这个对象进行使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CloudID: ƒ () <span class="comment">//用于云调用获取开放数据</span></span><br><span class="line">callFunction: ƒ () <span class="comment">//调用云函数</span></span><br><span class="line">database: ƒ () <span class="comment">//获取数据库的引用</span></span><br><span class="line">deleteFile: ƒ () <span class="comment">//从云存储空间删除文件</span></span><br><span class="line">downloadFile: ƒ () <span class="comment">//从云存储空间下载文件</span></span><br><span class="line">getTempFileURL: ƒ () <span class="comment">//用云文件 ID 换取真实链接</span></span><br><span class="line">init: ƒ ()  <span class="comment">//初始化云开发能力</span></span><br><span class="line">uploadFile: ƒ () <span class="comment">//上传文件至云存储空间</span></span><br></pre></td></tr></table></figure>

<h3 id="开通云开发服务"><a href="#开通云开发服务" class="headerlink" title="开通云开发服务"></a>开通云开发服务</h3><p>见上教程。需要记住环境 ID。环境即是云函数、数据库等需要上传的一个地方。</p>
<h3 id="指定小程序的-ID"><a href="#指定小程序的-ID" class="headerlink" title="指定小程序的 ID"></a>指定小程序的 ID</h3><p>以云开发的形式创建项目，然后在 <code>app.js</code> 可以看到：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">  onLaunch: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!wx.cloud) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'请使用 2.2.3 或以上的基础库以使用云能力'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      wx.cloud.init(&#123;</span><br><span class="line">        <span class="comment">// env 参数说明：</span></span><br><span class="line">        <span class="comment">//   env 参数决定接下来小程序发起的云开发调用（wx.cloud.xxx）会默认请求到哪个云环境的资源</span></span><br><span class="line">        <span class="comment">//   此处请填入环境 ID, 环境 ID 可打开云控制台查看</span></span><br><span class="line">        <span class="comment">//   如不填则使用默认环境（第一个创建的环境）</span></span><br><span class="line">        <span class="comment">// env: 'my-env-id',</span></span><br><span class="line">        traceUser: <span class="literal">true</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.globalData = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>取消注释第 12 行，并且修改为自己的环境 ID。</p>
<h3 id="编写云函数"><a href="#编写云函数" class="headerlink" title="编写云函数"></a>编写云函数</h3><p>在 <code>cloudfunctions</code> 目录下，每个文件夹都对应一个云函数。</p>
<p>我们关注 <code>login</code> 函数。打开 <code>cloudfunctions/login/index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 云函数模板</span></span><br><span class="line"><span class="comment">// 部署：在 cloud-functions/login 文件夹右击选择 “上传并部署”</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cloud = <span class="built_in">require</span>(<span class="string">'wx-server-sdk'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化 cloud</span></span><br><span class="line">cloud.init(&#123;</span><br><span class="line">  <span class="comment">// API 调用都保持和云函数当前所在环境一致</span></span><br><span class="line">  env: cloud.DYNAMIC_CURRENT_ENV</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个示例将经自动鉴权过的小程序用户 openid 返回给小程序端</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * event 参数包含小程序端调用传入的 data</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'服务端打印的event'</span>,event)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'服务端打印的context'</span>,context)</span><br><span class="line">  <span class="comment">// 可执行其他自定义逻辑</span></span><br><span class="line">  <span class="comment">// console.log 的内容可以在云开发云函数调用日志查看</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取 WX Context (微信调用上下文)，包括 OPENID、APPID、及 UNIONID（需满足 UNIONID 获取条件）等信息</span></span><br><span class="line">  <span class="keyword">const</span> wxContext = cloud.getWXContext()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    event,</span><br><span class="line">    openid: wxContext.OPENID,</span><br><span class="line">    appid: wxContext.APPID,</span><br><span class="line">    unionid: wxContext.UNIONID,</span><br><span class="line">    env: wxContext.ENV,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>1-10 行初始化云环境；</li>
<li>18-35 行则导出了一个叫做 <code>main</code> 的箭头函数，其接受两个参数 <code>event</code> 和 <code>context</code>，可通过 <code>console.log</code> 查看：<ul>
<li><code>event</code> 包含用户的 <code>openid</code> 和小程序的 <code>appid</code>， openid 就相当于用户的身份证，我们可以根据 <code>openid</code> 获取到用户的昵称、头像等信息；</li>
<li><code>context</code> 对象则是云函数的调用信息和运行状态。</li>
</ul>
</li>
<li>这段函数执行过程只是调用 <code>cloud.getWXContext()</code> 并返回其结果，在调用云函数的地方可以接收。</li>
</ul>
<p>需要强调的是，云函数的 <code>console.log</code> 的返回结果是在<strong>云开发控制台</strong>而不是开发者工具的控制台里。</p>
<h3 id="部署云函数"><a href="#部署云函数" class="headerlink" title="部署云函数"></a>部署云函数</h3><ol>
<li>右键云函数目录，选择在终端中打开，输入 <code>npm install</code> 命令下载依赖文件；</li>
<li>然后再右键云函数目录，点击“创建并部署：所有文件”；</li>
<li>在云开发控制台–云函数–云函数列表查看云函数是否部署成功。</li>
</ol>
<h3 id="编写调用云函数的方法"><a href="#编写调用云函数的方法" class="headerlink" title="编写调用云函数的方法"></a>编写调用云函数的方法</h3><p>现在将目光转向 <code>pages/index/index.js</code>。这是云开发小程序模板的首页的 JS 文件。其中有一个函数 <code>onGetOpenid</code> 是首页中“获取 openid” 按钮通过 <code>tapbind</code> 绑定的函数。这个函数调用了云函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">onGetOpenid: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 调用云函数</span></span><br><span class="line">  wx.cloud.callFunction(&#123;</span><br><span class="line">    name: <span class="string">'login'</span>,</span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">    success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'[云函数] [login] user openid: '</span>, res.result.openid)</span><br><span class="line">      app.globalData.openid = res.result.openid</span><br><span class="line">      wx.navigateTo(&#123;</span><br><span class="line">        url: <span class="string">'../userConsole/userConsole'</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'[云函数] [login] 调用失败'</span>, err)</span><br><span class="line">      wx.navigateTo(&#123;</span><br><span class="line">        url: <span class="string">'../deployFunctions/deployFunctions'</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>可见，调用云函数是通过 <code>wx.cloud.callFunction</code> 函数，再通过参数指定是哪个函数、参数和成功/失败的回调函数。</p>
<h3 id="进阶调试"><a href="#进阶调试" class="headerlink" title="进阶调试"></a>进阶调试</h3><p><a href="https://cloudbase.net/community/guides/handbook/tcb22.html" target="_blank" rel="noopener">教程</a></p>
<h3 id="云服务选取"><a href="#云服务选取" class="headerlink" title="云服务选取"></a>云服务选取</h3><h2 id="云数据库"><a href="#云数据库" class="headerlink" title="云数据库"></a>云数据库</h2><p><a href="https://cloudbase.net/community/guides/handbook/tcb21.html" target="_blank" rel="noopener">教程</a></p>
<p><a href="https://developers.weixin.qq.com/minigame/dev/wxcloud/guide/database.html" target="_blank" rel="noopener">文档</a></p>
<p>微信给的云数据库是 JSON 数据库，也就是每条记录以 JSON 的形式上传。这点类似于 MongoDB，甚至某些查询语句也和 MongoDB 类似。</p>
<p>创建项目时，以云开发的形式创建项目，然后在 <code>/pages/databaseGuide/databaseGuide.js</code> 可以看到如何操作数据库。首先需要手动在云开发-数据库页面新增集合（类似于 MySQL 的表）。</p>
<p>云数据库使用有以下注意事项：</p>
<ul>
<li>小程序一次获取的记录数不能超过 20 条，云函数不能超过 100 条。必要时可通过<a href="https://developers.weixin.qq.com/minigame/dev/wxcloud/guide/database/read.html" target="_blank" rel="noopener">文档</a> 给出的示例代码进行多次获取然后拼接；</li>
<li>小程序不支持数据批量更新（即 <code>db.collection().where().update()</code>），仅云函数支持；</li>
<li>云函数不兼容回调函数风格（即 <code>.get({success, fail, complete})</code>），仅支持 Promise 风格（即 <code>.get().then().catch()</code>）；</li>
<li>并不是每次云函数执行都会在新的环境开始执行，连续执行云函数也可能在上一次的环境下执行，因此变量初始化一定要在 main 函数里完成，才能保证变量每次被初始化了。</li>
</ul>
<h3 id="新增记录"><a href="#新增记录" class="headerlink" title="新增记录"></a>新增记录</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">onAdd: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> db = wx.cloud.database()</span><br><span class="line">  db.collection(<span class="string">'counters'</span>).add(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      count: <span class="number">1</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 在返回结果中会包含新创建的记录的 _id</span></span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        counterId: res._id,</span><br><span class="line">        count: <span class="number">1</span></span><br><span class="line">      &#125;)</span><br><span class="line">      wx.showToast(&#123;</span><br><span class="line">        title: <span class="string">'新增记录成功'</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'[数据库] [新增记录] 成功，记录 _id: '</span>, res._id)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      wx.showToast(&#123;</span><br><span class="line">        icon: <span class="string">'none'</span>,</span><br><span class="line">        title: <span class="string">'新增记录失败'</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'[数据库] [新增记录] 失败：'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="查询记录"><a href="#查询记录" class="headerlink" title="查询记录"></a>查询记录</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">onQuery: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> db = wx.cloud.database()</span><br><span class="line">  <span class="comment">// 查询当前用户所有的 counters</span></span><br><span class="line">  db.collection(<span class="string">'counters'</span>).where(&#123;</span><br><span class="line">    _openid: <span class="keyword">this</span>.data.openid</span><br><span class="line">  &#125;).get(&#123;</span><br><span class="line">    success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        queryResult: <span class="built_in">JSON</span>.stringify(res.data, <span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'[数据库] [查询记录] 成功: '</span>, res)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      wx.showToast(&#123;</span><br><span class="line">        icon: <span class="string">'none'</span>,</span><br><span class="line">        title: <span class="string">'查询记录失败'</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'[数据库] [查询记录] 失败：'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>更多的查询语法见<a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/read.html" target="_blank" rel="noopener">链接</a></p>
<h3 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">onCounterInc: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> db = wx.cloud.database()</span><br><span class="line">  <span class="keyword">const</span> newCount = <span class="keyword">this</span>.data.count + <span class="number">1</span></span><br><span class="line">  db.collection(<span class="string">'counters'</span>).doc(<span class="keyword">this</span>.data.counterId).update(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      count: newCount</span><br><span class="line">    &#125;,</span><br><span class="line">    success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        count: newCount</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      icon: <span class="string">'none'</span>,</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'[数据库] [更新记录] 失败：'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>需要注意的是，小程序端为了避免批量更新，不允许对查询的数据进行更新。</p>
<ul>
<li>如果查询的数据只有一项，可以通过查询获取其 <code>id</code>，再对 <code>id</code> 更新；</li>
<li>如果需要更新很多项，可以考虑使用云函数。</li>
</ul>
<h3 id="删除记录"><a href="#删除记录" class="headerlink" title="删除记录"></a>删除记录</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">onRemove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.data.counterId) &#123;</span><br><span class="line">    <span class="keyword">const</span> db = wx.cloud.database()</span><br><span class="line">    db.collection(<span class="string">'counters'</span>).doc(<span class="keyword">this</span>.data.counterId).remove(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">          title: <span class="string">'删除成功'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          counterId: <span class="string">''</span>,</span><br><span class="line">          count: <span class="literal">null</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">          icon: <span class="string">'none'</span>,</span><br><span class="line">          title: <span class="string">'删除失败'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">'[数据库] [删除记录] 失败：'</span>, err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    wx.showToast(&#123;</span><br><span class="line">      title: <span class="string">'无记录可删，请见创建一个记录'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2021-09-11T12:19:35.107Z" itemprop="dateUpdated">2021-09-11 20:19:35</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://blog.lyh543.cn">
            <img src="/img/avatar.png" alt="lyh543">
            lyh543
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">微信小程序</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8/" rel="tag">编程语言入门</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.lyh543.cn/front-end/wechat-mini-program/&title=《微信小程序开发入门》 — 小灰灰灰灰的博客&pic=https://blog.lyh543.cn/img/avatar.png" data-title="微博">
          <i class="icon mdi mdi-sina-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.lyh543.cn/front-end/wechat-mini-program/&title=《微信小程序开发入门》 — 小灰灰灰灰的博客&source=" data-title=" QQ">
          <i class="icon mdi mdi-qqchat"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.lyh543.cn/front-end/wechat-mini-program/" data-title=" Facebook">
          <i class="icon mdi mdi-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《微信小程序开发入门》 — 小灰灰灰灰的博客&url=https://blog.lyh543.cn/front-end/wechat-mini-program/&via=https://blog.lyh543.cn" data-title=" Twitter">
          <i class="icon mdi mdi-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.lyh543.cn/front-end/wechat-mini-program/" data-title=" Google+">
          <i class="icon mdi mdi-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-lg mdi mdi-share-variant"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/front-end/css/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon mdi mdi-chevron-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">CSS（萌新向）</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/others/resume-and-interview/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-lg icon-pl mdi mdi-chevron-right"></i></div>
        <h4 class="title">面试和简历</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'ec7daa4e047c3c30570d',
          clientSecret: '025a9e40a1d101f28fd1a945d286a819e9fa1c3d',
          repo: 'lyh543.github.io',
          owner: 'lyh543',
          admin: ['lyh543'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg mdi mdi-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>lyh543 &copy; 2019 - 2021</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">蜀ICP备19034464号</a><br>
                
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg mdi mdi-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.lyh543.cn/front-end/wechat-mini-program/&title=《微信小程序开发入门》 — 小灰灰灰灰的博客&pic=https://blog.lyh543.cn/img/avatar.png" data-title="微博">
          <i class="icon mdi mdi-sina-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.lyh543.cn/front-end/wechat-mini-program/&title=《微信小程序开发入门》 — 小灰灰灰灰的博客&source=" data-title=" QQ">
          <i class="icon mdi mdi-qqchat"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.lyh543.cn/front-end/wechat-mini-program/" data-title=" Facebook">
          <i class="icon mdi mdi-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《微信小程序开发入门》 — 小灰灰灰灰的博客&url=https://blog.lyh543.cn/front-end/wechat-mini-program/&via=https://blog.lyh543.cn" data-title=" Twitter">
          <i class="icon mdi mdi-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.lyh543.cn/front-end/wechat-mini-program/" data-title=" Google+">
          <i class="icon mdi mdi-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJElEQVR42u3aS07DQBAFQO5/6bBGws570wYpMzUr5Bg7lUWrf19f8XldnOTT5JlXVx4+GBgYH8t43Z7kngSQfHr1d/QWDAyMAxj5o/Mr94F1ficGBgZGEgTzcHx1Z/vzYWBgYLQBN3nlU2kiBgYGRhIoW1LeSlsrnjEwMM5h5CHy///+k/kGBgbGRzHm7f4JdVIS//gvDAyMrRl5gMsTxzYRjArU5AkYGBiHMdZK2bz1nwfuIlnEwMA4kjEPkcnwMrkefU8MDIxNGfeBrF2MWGuWJeVrHWoxMDA2ZbRhd76WmqydRT8TBgbG1oy2oF37uvN3LQ41MTAwtmDkBeT83AfQtZ/mchKLgYGxHSNP/tqEsl3daEtlDAwMjLa71TbvJoljsWaBgYGxESMJjnkIboNy/vw3M1gMDIxNGWsttnx1LB8AtIH+l1ocAwNjO0Y+mFy7UrTMBokmBgbGaYx28WIyVWyL2DdUDAyMwxjJK3NYm4CulbUYGBgnMCaDgSSk5tfbRTQMDIxzGPNH5+VoO0iI0kcMDIwDGEnAbVv8a2lf3mLDwMA4gfEqz6SVNhltFo02DAyM7Rj5WWvJrS2wrqWYGBgYezPakjUJrFGDrBx/FvMNDAyMTRnFWsPSstdTqd7lnRgYGBgPNf3nqxi1DwMD43hGnhQmX6Vt1V3ONzAwMDZlTAaQawVtC3hzPwYGxtaMtdJxrcU/WeyYLJBhYGB8LOMbqEC8Kqd6Yb4AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>










</body>
</html>
